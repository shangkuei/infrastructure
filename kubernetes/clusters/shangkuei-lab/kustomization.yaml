---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Cluster: shangkuei-lab
# Organization: Application-based resource management
# Note: flux-system is managed by flux-operator (Helm-based)

# Dependency order:
# 1. gateway-api: CRDs (no dependencies)
# 2. cilium: CNI (depends on gateway-api, implements Gateway API)
# 3. cert-manager: Certificates (depends on gateway-api for HTTP01/TLS challenges)
# 4. openebs: Storage (depends on cilium)
# 5. seaweedfs-operator: Operator + CRDs (depends on cilium)
# 6. seaweedfs-cluster: S3 object storage cluster (depends on operator + openebs)
# 7. kube-prometheus-stack: Monitoring (depends on openebs for persistent storage)
# 8. flux-operator: Foundation (depends on cilium, installed via Helm)
# 9. flux-instance: Core Flux components (depends on flux-operator)

resources:
  # Namespace configuration (kube-system with pod security labels for CSI)
  - namespace-kube-system.yaml

  # Source repositories (must be created before Kustomizations that use them)
  - ../../base/gateway-api

  # Gateway API CRDs (standard + experimental)
  - kustomization-gateway-api-standard.yaml
  - kustomization-gateway-api-experimental.yaml

  # CNI and certificate management (depend on Gateway API)
  - kustomization-cilium.yaml
  - kustomization-cert-manager.yaml

  # Storage (depends on Cilium CNI)
  - kustomization-openebs.yaml

  # S3 Object Storage - Operator (depends on Cilium for networking)
  - kustomization-seaweedfs-operator.yaml
  # S3 Object Storage - Cluster (depends on operator + OpenEBS)
  - kustomization-seaweedfs-cluster.yaml

  # Monitoring (depends on Storage for persistent volumes)
  - kustomization-kube-prometheus-stack.yaml

  # Infrastructure applications (Flux Kustomization CRs)
  # Flux foundation (installed via Helm)
  - kustomization-flux-operator.yaml
  - kustomization-flux-instance.yaml
