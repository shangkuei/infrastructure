---
# Default ProxyClass for Tailscale service proxies
#
# Uses userspace networking mode (TS_USERSPACE=true) to avoid routing conflicts
# between Tailscale's WireGuard kernel routing and the cluster's use of
# Tailscale IPs (100.x.x.x) as node InternalIPs.
#
# Without userspace mode, tailscaled in kernel mode intercepts traffic to
# 100.x.x.x addresses, breaking TCP connections to the Kubernetes API
# which runs on control plane at its Tailscale IP.
#
# Note: Container resources are intentionally omitted due to Tailscale operator
# v1.92.5 K8s 1.34 incompatibility - the operator sets hardcoded pod-level
# resources (1m/1Mi) that conflict with any container resources specified here.
# See: https://github.com/tailscale/tailscale/issues/new
apiVersion: tailscale.com/v1alpha1
kind: ProxyClass
metadata:
  name: default
  namespace: tailscale
spec:
  statefulSet:
    pod:
      tailscaleContainer:
        env:
          - name: TS_USERSPACE
            value: "true"
