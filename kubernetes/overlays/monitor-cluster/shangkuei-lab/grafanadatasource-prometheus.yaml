---
# Prometheus datasource for Grafana (grafana-operator managed)
# Connects to kube-prometheus-stack Prometheus instance
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDatasource
metadata:
  name: prometheus
  namespace: monitoring
spec:
  # Target Grafana instance by label
  instanceSelector:
    matchLabels:
      datasources: grafana

  # Allow this datasource to be referenced by Grafana instance
  allowCrossNamespaceImport: true

  datasource:
    name: Prometheus
    uid: prometheus
    type: prometheus
    access: proxy
    url: http://prometheus.monitoring.svc.cluster.local:9090
    isDefault: true
    editable: false
    jsonData:
      # Time interval for scraping
      timeInterval: "30s"
      # Enable exemplars for trace correlation
      exemplarTraceIdDestinations:
        - name: traceID
          datasourceUid: tempo
      # Link to Loki for log volume correlation
      lokiDatasourceUid: loki
      # Query timeout
      httpMethod: POST
      # Prometheus type (version auto-detected)
      prometheusType: Prometheus
