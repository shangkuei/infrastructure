---
# Grafana Dashboards from kube-prometheus jsonnet
# Auto-generated by: make build
# Source: https://github.com/prometheus-operator/kube-prometheus
# Do not edit manually - regenerate with 'make build'

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-alertmanager-overview
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Prometheus"
  resyncPeriod: 24h
  json: |
    {
        "graphTooltip": 1,
        "panels": [
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "panels": [

                ],
                "title": "Alerts",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "description": "current set of alerts stored in the Alertmanager",
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "none"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 1
                },
                "id": 2,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "sum(alertmanager_alerts{namespace=~\"$namespace\",service=~\"$service\"}) by (namespace,service,instance)",
                        "intervalFactor": 2,
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "Alerts",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "description": "rate of successful and invalid alerts received by the Alertmanager",
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 1
                },
                "id": 3,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "sum(rate(alertmanager_alerts_received_total{namespace=~\"$namespace\",service=~\"$service\"}[$__rate_interval])) by (namespace,service,instance)",
                        "intervalFactor": 2,
                        "legendFormat": "{{instance}} Received"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "sum(rate(alertmanager_alerts_invalid_total{namespace=~\"$namespace\",service=~\"$service\"}[$__rate_interval])) by (namespace,service,instance)",
                        "intervalFactor": 2,
                        "legendFormat": "{{instance}} Invalid"
                    }
                ],
                "title": "Alerts receive rate",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 8
                },
                "id": 4,
                "panels": [

                ],
                "title": "Notifications",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "description": "rate of successful and invalid notifications sent by the Alertmanager",
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 9
                },
                "id": 5,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "repeat": "integration",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "sum(rate(alertmanager_notifications_total{namespace=~\"$namespace\",service=~\"$service\", integration=\"$integration\"}[$__rate_interval])) by (integration,namespace,service,instance)",
                        "intervalFactor": 2,
                        "legendFormat": "{{instance}} Total"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "sum(rate(alertmanager_notifications_failed_total{namespace=~\"$namespace\",service=~\"$service\", integration=\"$integration\"}[$__rate_interval])) by (integration,namespace,service,instance)",
                        "intervalFactor": 2,
                        "legendFormat": "{{instance}} Failed"
                    }
                ],
                "title": "$integration: Notifications Send Rate",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "description": "latency of notifications sent by the Alertmanager",
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 9
                },
                "id": 6,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "repeat": "integration",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "histogram_quantile(0.99,\n  sum(rate(alertmanager_notification_latency_seconds_bucket{namespace=~\"$namespace\",service=~\"$service\", integration=\"$integration\"}[$__rate_interval])) by (le,namespace,service,instance)\n)\n",
                        "intervalFactor": 2,
                        "legendFormat": "{{instance}} 99th Percentile"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "histogram_quantile(0.50,\n  sum(rate(alertmanager_notification_latency_seconds_bucket{namespace=~\"$namespace\",service=~\"$service\", integration=\"$integration\"}[$__rate_interval])) by (le,namespace,service,instance)\n)\n",
                        "intervalFactor": 2,
                        "legendFormat": "{{instance}} Median"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "sum(rate(alertmanager_notification_latency_seconds_sum{namespace=~\"$namespace\",service=~\"$service\", integration=\"$integration\"}[$__rate_interval])) by (namespace,service,instance)\n/\nsum(rate(alertmanager_notification_latency_seconds_count{namespace=~\"$namespace\",service=~\"$service\", integration=\"$integration\"}[$__rate_interval])) by (namespace,service,instance)\n",
                        "intervalFactor": 2,
                        "legendFormat": "{{instance}} Average"
                    }
                ],
                "title": "$integration: Notification Duration",
                "type": "timeseries"
            }
        ],
        "schemaVersion": 39,
        "tags": [
            "alertmanager-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": false,
                        "text": "Prometheus",
                        "value": "Prometheus"
                    },
                    "hide": 0,
                    "label": "Data Source",
                    "name": "datasource",
                    "query": "prometheus",
                    "type": "datasource"
                },
                {
                    "current": {
                        "selected": false,
                        "text": "",
                        "value": ""
                    },
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "includeAll": false,
                    "label": "namespace",
                    "name": "namespace",
                    "query": "label_values(alertmanager_alerts, namespace)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "current": {
                        "selected": false,
                        "text": "",
                        "value": ""
                    },
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "includeAll": false,
                    "label": "service",
                    "name": "service",
                    "query": "label_values(alertmanager_alerts, service)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "current": {
                        "selected": false,
                        "text": "$__all",
                        "value": "$__all"
                    },
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 2,
                    "includeAll": true,
                    "name": "integration",
                    "query": "label_values(alertmanager_notifications_total{integration=~\".*\"}, integration)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timepicker": {
            "refresh_intervals": [
                "30s"
            ]
        },
        "timezone": "utc",
        "title": "Alertmanager / Overview",
        "uid": "alertmanager-overview"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-apiserver
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "description": "The SLO (service level objective) and other metrics displayed on this dashboard are for informational purposes only.",
                "gridPos": {
                    "h": 2,
                    "w": 24,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "options": {
                    "content": "The SLO (service level objective) and other metrics displayed on this dashboard are for informational purposes only."
                },
                "pluginVersion": "v11.4.0",
                "title": "Notice",
                "type": "text"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "description": "How many percent of requests (both read and write) in 30 days have been answered successfully and fast enough?",
                "fieldConfig": {
                    "defaults": {
                        "decimals": 3,
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 0,
                    "y": 2
                },
                "id": 2,
                "interval": "1m",
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "apiserver_request:availability30d{verb=\"all\", cluster=\"$cluster\"}"
                    }
                ],
                "title": "Availability (30d) > 99.000%",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "description": "How much error budget is left looking at our 0.990% availability guarantees?",
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100
                        },
                        "decimals": 3,
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 16,
                    "x": 8,
                    "y": 2
                },
                "id": 3,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "100 * (apiserver_request:availability30d{verb=\"all\", cluster=\"$cluster\"} - 0.990000)",
                        "legendFormat": "errorbudget"
                    }
                ],
                "title": "ErrorBudget (30d) > 99.000%",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "description": "How many percent of read requests (LIST,GET) in 30 days have been answered successfully and fast enough?",
                "fieldConfig": {
                    "defaults": {
                        "decimals": 3,
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 6,
                    "x": 0,
                    "y": 9
                },
                "id": 4,
                "interval": "1m",
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "apiserver_request:availability30d{verb=\"read\", cluster=\"$cluster\"}"
                    }
                ],
                "title": "Read Availability (30d)",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "description": "How many read requests (LIST,GET) per second do the apiservers get by code?",
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "reqps"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/2../i"
                            },
                            "properties": [
                                {
                                    "id": "color",
                                    "value": "#56A64B"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/3../i"
                            },
                            "properties": [
                                {
                                    "id": "color",
                                    "value": "#F2CC0C"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/4../i"
                            },
                            "properties": [
                                {
                                    "id": "color",
                                    "value": "#3274D9"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/5../i"
                            },
                            "properties": [
                                {
                                    "id": "color",
                                    "value": "#E02F44"
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 6,
                    "x": 6,
                    "y": 9
                },
                "id": 5,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (code) (code_resource:apiserver_request_total:rate5m{verb=\"read\", cluster=\"$cluster\"})",
                        "legendFormat": "{{ code }}"
                    }
                ],
                "title": "Read SLI - Requests",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "description": "How many percent of read requests (LIST,GET) per second are returned with errors (5xx)?",
                "fieldConfig": {
                    "defaults": {
                        "min": 0,
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 6,
                    "x": 12,
                    "y": 9
                },
                "id": 6,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (resource) (code_resource:apiserver_request_total:rate5m{verb=\"read\",code=~\"5..\", cluster=\"$cluster\"}) / sum by (resource) (code_resource:apiserver_request_total:rate5m{verb=\"read\", cluster=\"$cluster\"})",
                        "legendFormat": "{{ resource }}"
                    }
                ],
                "title": "Read SLI - Errors",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "description": "How many seconds is the 99th percentile for reading (LIST|GET) a given resource?",
                "fieldConfig": {
                    "defaults": {
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 6,
                    "x": 18,
                    "y": 9
                },
                "id": 7,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "cluster_quantile:apiserver_request_sli_duration_seconds:histogram_quantile{verb=\"read\", cluster=\"$cluster\"}",
                        "legendFormat": "{{ resource }}"
                    }
                ],
                "title": "Read SLI - Duration",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "description": "How many percent of write requests (POST|PUT|PATCH|DELETE) in 30 days have been answered successfully and fast enough?",
                "fieldConfig": {
                    "defaults": {
                        "decimals": 3,
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 6,
                    "x": 0,
                    "y": 16
                },
                "id": 8,
                "interval": "1m",
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "apiserver_request:availability30d{verb=\"write\", cluster=\"$cluster\"}"
                    }
                ],
                "title": "Write Availability (30d)",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "description": "How many write requests (POST|PUT|PATCH|DELETE) per second do the apiservers get by code?",
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "reqps"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/2../i"
                            },
                            "properties": [
                                {
                                    "id": "color",
                                    "value": "#56A64B"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/3../i"
                            },
                            "properties": [
                                {
                                    "id": "color",
                                    "value": "#F2CC0C"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/4../i"
                            },
                            "properties": [
                                {
                                    "id": "color",
                                    "value": "#3274D9"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/5../i"
                            },
                            "properties": [
                                {
                                    "id": "color",
                                    "value": "#E02F44"
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 6,
                    "x": 6,
                    "y": 16
                },
                "id": 9,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (code) (code_resource:apiserver_request_total:rate5m{verb=\"write\", cluster=\"$cluster\"})",
                        "legendFormat": "{{ code }}"
                    }
                ],
                "title": "Write SLI - Requests",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "description": "How many percent of write requests (POST|PUT|PATCH|DELETE) per second are returned with errors (5xx)?",
                "fieldConfig": {
                    "defaults": {
                        "min": 0,
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 6,
                    "x": 12,
                    "y": 16
                },
                "id": 10,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (resource) (code_resource:apiserver_request_total:rate5m{verb=\"write\",code=~\"5..\", cluster=\"$cluster\"}) / sum by (resource) (code_resource:apiserver_request_total:rate5m{verb=\"write\", cluster=\"$cluster\"})",
                        "legendFormat": "{{ resource }}"
                    }
                ],
                "title": "Write SLI - Errors",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "description": "How many seconds is the 99th percentile for writing (POST|PUT|PATCH|DELETE) a given resource?",
                "fieldConfig": {
                    "defaults": {
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 6,
                    "x": 18,
                    "y": 16
                },
                "id": 11,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "cluster_quantile:apiserver_request_sli_duration_seconds:histogram_quantile{verb=\"write\", cluster=\"$cluster\"}",
                        "legendFormat": "{{ resource }}"
                    }
                ],
                "title": "Write SLI - Duration",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "min": 0,
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 23
                },
                "id": 12,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "placement": "right",
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(workqueue_adds_total{job=\"apiserver\", instance=~\"$instance\", cluster=\"$cluster\"}[$__rate_interval])) by (instance, name)",
                        "legendFormat": "{{instance}} {{name}}"
                    }
                ],
                "title": "Work Queue Add Rate",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "min": 0,
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 23
                },
                "id": 13,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "placement": "right",
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(workqueue_depth{job=\"apiserver\", instance=~\"$instance\", cluster=\"$cluster\"}[$__rate_interval])) by (instance, name)",
                        "legendFormat": "{{instance}} {{name}}"
                    }
                ],
                "title": "Work Queue Depth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "min": 0,
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 30
                },
                "id": 14,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(workqueue_queue_duration_seconds_bucket{job=\"apiserver\", instance=~\"$instance\", cluster=\"$cluster\"}[$__rate_interval])) by (instance, name, le))",
                        "legendFormat": "{{instance}} {{name}}"
                    }
                ],
                "title": "Work Queue Latency",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "bytes"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 0,
                    "y": 37
                },
                "id": 15,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "process_resident_memory_bytes{job=\"apiserver\",instance=~\"$instance\", cluster=\"$cluster\"}",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "Memory",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "min": 0,
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 8,
                    "y": 37
                },
                "id": 16,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "rate(process_cpu_seconds_total{job=\"apiserver\",instance=~\"$instance\", cluster=\"$cluster\"}[$__rate_interval])",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "CPU usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 16,
                    "y": 37
                },
                "id": 17,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "go_goroutines{job=\"apiserver\",instance=~\"$instance\", cluster=\"$cluster\"}",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "Goroutines",
                "type": "timeseries"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(up{job=\"apiserver\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "includeAll": true,
                    "name": "instance",
                    "query": "label_values(up{job=\"apiserver\", cluster=\"$cluster\"}, instance)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / API server",
        "uid": "09ec8aa1e996d6ffcd6817bbaff4db1b"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-cluster-total
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (namespace) (\n    rate(container_network_receive_bytes_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Current Rate of Bytes Received",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 0
                },
                "id": 2,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (namespace) (\n    rate(container_network_transmit_bytes_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Current Rate of Bytes Transmitted",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Bytes/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "bps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Packets/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "pps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Namespace"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down",
                                            "url": "/d/8b7a8b326d7a6f1f04244066368c67af/kubernetes-networking-namespace-pods?${datasource:queryparam}&var-cluster=${cluster}&var-namespace=${__data.fields.Namespace}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 9,
                    "w": 24,
                    "x": 0,
                    "y": 9
                },
                "id": 3,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (namespace) (\n    rate(container_network_receive_bytes_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (namespace) (\n    rate(container_network_transmit_bytes_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "avg by (namespace) (\n    rate(container_network_receive_bytes_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "avg by (namespace) (\n    rate(container_network_transmit_bytes_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (namespace) (\n    rate(container_network_receive_packets_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (namespace) (\n    rate(container_network_transmit_packets_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (namespace) (\n    rate(container_network_receive_packets_dropped_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (namespace) (\n    rate(container_network_transmit_packets_dropped_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Current Status",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "namespace",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true,
                                "Time 7": true,
                                "Time 8": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Time 7": 6,
                                "Time 8": 7,
                                "Value #A": 9,
                                "Value #B": 10,
                                "Value #C": 11,
                                "Value #D": 12,
                                "Value #E": 13,
                                "Value #F": 14,
                                "Value #G": 15,
                                "Value #H": 16,
                                "namespace": 8
                            },
                            "renameByName": {
                                "Value #A": "Rx Bytes",
                                "Value #B": "Tx Bytes",
                                "Value #C": "Rx Bytes (Avg)",
                                "Value #D": "Tx Bytes (Avg)",
                                "Value #E": "Rx Packets",
                                "Value #F": "Tx Packets",
                                "Value #G": "Rx Packets Dropped",
                                "Value #H": "Tx Packets Dropped",
                                "namespace": "Namespace"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 18
                },
                "id": 4,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "avg by (namespace) (\n    rate(container_network_receive_bytes_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Average Rate of Bytes Received",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 18
                },
                "id": 5,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "avg by (namespace) (\n    rate(container_network_transmit_bytes_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Average Rate of Bytes Transmitted",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 27
                },
                "id": 6,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (namespace) (\n    rate(container_network_receive_bytes_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Receive Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 27
                },
                "id": 7,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (namespace) (\n    rate(container_network_transmit_bytes_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Transmit Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 36
                },
                "id": 8,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (namespace) (\n    rate(container_network_receive_packets_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 36
                },
                "id": 9,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (namespace) (\n    rate(container_network_transmit_packets_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 45
                },
                "id": 10,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (namespace) (\n    rate(container_network_receive_packets_dropped_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets Dropped",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 45
                },
                "id": 11,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (namespace) (\n    rate(container_network_transmit_packets_dropped_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\",cluster=\"$cluster\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets Dropped",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 54
                },
                "id": 12,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (instance) (\n    rate(node_netstat_Tcp_RetransSegs{cluster=\"$cluster\"}[$__rate_interval]) / rate(node_netstat_Tcp_OutSegs{cluster=\"$cluster\"}[$__rate_interval])\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of TCP Retransmits out of all sent segments",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 54
                },
                "id": 13,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (instance) (\n    rate(node_netstat_TcpExt_TCPSynRetrans{cluster=\"$cluster\"}[$__rate_interval]) / rate(node_netstat_Tcp_RetransSegs{cluster=\"$cluster\"}[$__rate_interval])\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of TCP SYN Retransmits out of all retransmits",
                "type": "timeseries"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(up{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Networking / Cluster",
        "uid": "ff635a025bcfea7bc3dd4f508990a3e9"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-controller-manager
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "none"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 4,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(up{cluster=\"$cluster\", job=\"kube-controller-manager\"})",
                        "instant": true
                    }
                ],
                "title": "Up",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 20,
                    "x": 4,
                    "y": 0
                },
                "id": 2,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(workqueue_adds_total{cluster=\"$cluster\", job=\"kube-controller-manager\", instance=~\"$instance\"}[$__rate_interval])) by (cluster, instance, name)",
                        "legendFormat": "{{cluster}} {{instance}} {{name}}"
                    }
                ],
                "title": "Work Queue Add Rate",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 7
                },
                "id": 3,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(workqueue_depth{cluster=\"$cluster\", job=\"kube-controller-manager\", instance=~\"$instance\"}[$__rate_interval])) by (cluster, instance, name)",
                        "legendFormat": "{{cluster}} {{instance}} {{name}}"
                    }
                ],
                "title": "Work Queue Depth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 14
                },
                "id": 4,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(workqueue_queue_duration_seconds_bucket{cluster=\"$cluster\", job=\"kube-controller-manager\", instance=~\"$instance\"}[$__rate_interval])) by (cluster, instance, name, le))",
                        "legendFormat": "{{cluster}} {{instance}} {{name}}"
                    }
                ],
                "title": "Work Queue Latency",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 0,
                    "y": 21
                },
                "id": 5,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(rest_client_requests_total{job=\"kube-controller-manager\", instance=~\"$instance\",code=~\"2..\"}[$__rate_interval]))",
                        "legendFormat": "2xx"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(rest_client_requests_total{job=\"kube-controller-manager\", instance=~\"$instance\",code=~\"3..\"}[$__rate_interval]))",
                        "legendFormat": "3xx"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(rest_client_requests_total{job=\"kube-controller-manager\", instance=~\"$instance\",code=~\"4..\"}[$__rate_interval]))",
                        "legendFormat": "4xx"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(rest_client_requests_total{job=\"kube-controller-manager\", instance=~\"$instance\",code=~\"5..\"}[$__rate_interval]))",
                        "legendFormat": "5xx"
                    }
                ],
                "title": "Kube API Request Rate",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 16,
                    "x": 8,
                    "y": 21
                },
                "id": 6,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(rest_client_request_duration_seconds_bucket{cluster=\"$cluster\", job=\"kube-controller-manager\", instance=~\"$instance\", verb=\"POST\"}[$__rate_interval])) by (verb, le))",
                        "legendFormat": "{{verb}}"
                    }
                ],
                "title": "Post Request Latency 99th Quantile",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 28
                },
                "id": 7,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(rest_client_request_duration_seconds_bucket{cluster=\"$cluster\", job=\"kube-controller-manager\", instance=~\"$instance\", verb=\"GET\"}[$__rate_interval])) by (verb, le))",
                        "legendFormat": "{{verb}}"
                    }
                ],
                "title": "Get Request Latency 99th Quantile",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bytes"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 0,
                    "y": 35
                },
                "id": 8,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "process_resident_memory_bytes{cluster=\"$cluster\", job=\"kube-controller-manager\",instance=~\"$instance\"}",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "Memory",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 8,
                    "y": 35
                },
                "id": 9,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "rate(process_cpu_seconds_total{cluster=\"$cluster\", job=\"kube-controller-manager\",instance=~\"$instance\"}[$__rate_interval])",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "CPU usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 16,
                    "y": 35
                },
                "id": 10,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "go_goroutines{cluster=\"$cluster\", job=\"kube-controller-manager\",instance=~\"$instance\"}",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "Goroutines",
                "type": "timeseries"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(up{job=\"kube-controller-manager\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "includeAll": true,
                    "label": "instance",
                    "name": "instance",
                    "query": "label_values(up{cluster=\"$cluster\", job=\"kube-controller-manager\"}, instance)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Controller Manager",
        "uid": "72e0e05bef5099e5f049b05fdc429ed4"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-coredns
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
      "__inputs": [],
      "__requires": [],
      "annotations": {
        "list": []
      },
      "editable": false,
      "gnetId": null,
      "graphTooltip": 0,
      "hideControls": false,
      "id": null,
      "links": [],
      "refresh": "10s",
      "rows": [
        {
          "collapse": false,
          "collapsed": false,
          "panels": [
            {
              "cacheTimeout": null,
              "colorBackground": false,
              "colorValue": false,
              "colors": [
                "#299c46",
                "rgba(237, 129, 40, 0.89)",
                "#d44a3a"
              ],
              "datasource": "$datasource",
              "format": "none",
              "gauge": {
                "maxValue": 100,
                "minValue": 0,
                "show": false,
                "thresholdLabels": false,
                "thresholdMarkers": true
              },
              "gridPos": {},
              "id": 2,
              "interval": null,
              "links": [],
              "mappingType": 1,
              "mappingTypes": [
                {
                  "name": "value to text",
                  "value": 1
                },
                {
                  "name": "range to text",
                  "value": 2
                }
              ],
              "maxDataPoints": 100,
              "nullPointMode": "connected",
              "nullText": null,
              "postfix": "",
              "postfixFontSize": "50%",
              "prefix": "",
              "prefixFontSize": "50%",
              "rangeMaps": [
                {
                  "from": "null",
                  "text": "N/A",
                  "to": "null"
                }
              ],
              "span": 1,
              "sparkline": {
                "fillColor": "rgba(31, 118, 189, 0.18)",
                "full": false,
                "lineColor": "rgb(31, 120, 193)",
                "show": false
              },
              "tableColumn": "",
              "targets": [
                {
                  "expr": "sum(up{job=\"kube-dns\"})",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "",
                  "refId": "A"
                }
              ],
              "thresholds": "",
              "title": "Up",
              "type": "singlestat",
              "valueFontSize": "80%",
              "valueMaps": [
                {
                  "op": "=",
                  "text": "N/A",
                  "value": "null"
                }
              ],
              "valueName": "min"
            },
            {
              "cacheTimeout": null,
              "colorBackground": false,
              "colorValue": false,
              "colors": [
                "#299c46",
                "rgba(237, 129, 40, 0.89)",
                "#d44a3a"
              ],
              "datasource": "$datasource",
              "format": "none",
              "gauge": {
                "maxValue": 100,
                "minValue": 0,
                "show": false,
                "thresholdLabels": false,
                "thresholdMarkers": true
              },
              "gridPos": {},
              "id": 3,
              "interval": null,
              "links": [],
              "mappingType": 1,
              "mappingTypes": [
                {
                  "name": "value to text",
                  "value": 1
                },
                {
                  "name": "range to text",
                  "value": 2
                }
              ],
              "maxDataPoints": 100,
              "nullPointMode": "connected",
              "nullText": null,
              "postfix": "",
              "postfixFontSize": "50%",
              "prefix": "",
              "prefixFontSize": "50%",
              "rangeMaps": [
                {
                  "from": "null",
                  "text": "N/A",
                  "to": "null"
                }
              ],
              "span": 1,
              "sparkline": {
                "fillColor": "rgba(31, 118, 189, 0.18)",
                "full": false,
                "lineColor": "rgb(31, 120, 193)",
                "show": false
              },
              "tableColumn": "",
              "targets": [
                {
                  "expr": "sum(coredns_panics_total{job=\"kube-dns\"})",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "",
                  "refId": "A"
                }
              ],
              "thresholds": "",
              "title": "Panics",
              "type": "singlestat",
              "valueFontSize": "80%",
              "valueMaps": [
                {
                  "op": "=",
                  "text": "N/A",
                  "value": "null"
                }
              ],
              "valueName": "max"
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {},
              "id": 4,
              "legend": {
                "alignAsTable": false,
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "rightSide": false,
                "show": true,
                "sideWidth": null,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "repeat": null,
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 5,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate(coredns_dns_responses_total{job=\"kube-dns\",pod=~\"$instance\"}[5m])) by (rcode)",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "{{rcode}}",
                  "refId": "A"
                },
                {
                  "expr": "sum(rate(coredns_forward_responses_total{job=\"kube-dns\",pod=~\"$instance\"}[5m])) by (rcode)",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "forward {{rcode}}",
                  "refId": "B"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "RPC Rate",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "ops",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "ops",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                }
              ]
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {},
              "id": 5,
              "legend": {
                "alignAsTable": true,
                "avg": false,
                "current": true,
                "max": false,
                "min": false,
                "rightSide": true,
                "show": true,
                "sideWidth": null,
                "total": false,
                "values": true
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "repeat": null,
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 5,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "histogram_quantile(0.99, sum(rate(coredns_dns_request_duration_seconds_bucket{job=\"kube-dns\",pod=~\"$instance\"}[5m])) by (server, zone, le))",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "{{server}} {{zone}}",
                  "refId": "A"
                },
                {
                  "expr": "histogram_quantile(0.99, sum(rate(coredns_forward_request_duration_seconds_bucket{job=\"kube-dns\",pod=~\"$instance\"}[5m])) by (to, le))",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "forward {{to}}",
                  "refId": "B"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Request duration 99th quantile",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "s",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "s",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                }
              ]
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": false,
          "title": "Dashboard Row",
          "titleSize": "h6",
          "type": "row"
        },
        {
          "collapse": false,
          "collapsed": false,
          "panels": [
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {},
              "id": 6,
              "legend": {
                "alignAsTable": false,
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "rightSide": false,
                "show": true,
                "sideWidth": null,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "repeat": null,
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 4,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate(coredns_dns_requests_total{job=\"kube-dns\",pod=~\"$instance\"}[5m])) by (type)",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "{{type}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Requests (by qtype)",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "ops",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "ops",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                }
              ]
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {},
              "id": 7,
              "legend": {
                "alignAsTable": false,
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "rightSide": false,
                "show": true,
                "sideWidth": null,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "repeat": null,
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 4,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate(coredns_dns_requests_total{job=\"kube-dns\",pod=~\"$instance\"}[5m])) by (zone)",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "{{zone}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Requests (by zone)",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "ops",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "ops",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                }
              ]
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {},
              "id": 8,
              "legend": {
                "alignAsTable": false,
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "rightSide": false,
                "show": true,
                "sideWidth": null,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "repeat": null,
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 4,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate(coredns_forward_requests_total{job=\"kube-dns\",pod=~\"$instance\"}[5m])) by (to)",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "{{to}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Forward Requests (by to)",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "ops",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "ops",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                }
              ]
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": false,
          "title": "Dashboard Row",
          "titleSize": "h6",
          "type": "row"
        },
        {
          "collapse": false,
          "collapsed": false,
          "panels": [
            {
              "cacheTimeout": null,
              "colorBackground": false,
              "colorValue": false,
              "colors": [
                "#299c46",
                "rgba(237, 129, 40, 0.89)",
                "#d44a3a"
              ],
              "datasource": "$datasource",
              "format": "percentunit",
              "gauge": {
                "maxValue": 100,
                "minValue": 0,
                "show": false,
                "thresholdLabels": false,
                "thresholdMarkers": true
              },
              "gridPos": {},
              "id": 9,
              "interval": null,
              "links": [],
              "mappingType": 1,
              "mappingTypes": [
                {
                  "name": "value to text",
                  "value": 1
                },
                {
                  "name": "range to text",
                  "value": 2
                }
              ],
              "maxDataPoints": 100,
              "nullPointMode": "connected",
              "nullText": null,
              "postfix": "",
              "postfixFontSize": "50%",
              "prefix": "",
              "prefixFontSize": "50%",
              "rangeMaps": [
                {
                  "from": "null",
                  "text": "N/A",
                  "to": "null"
                }
              ],
              "span": 2,
              "sparkline": {
                "fillColor": "rgba(31, 118, 189, 0.18)",
                "full": false,
                "lineColor": "rgb(31, 120, 193)",
                "show": false
              },
              "tableColumn": "",
              "targets": [
                {
                  "expr": "sum(coredns_cache_hits_total{job=\"kube-dns\",pod=~\"$instance\"}) / (sum(coredns_cache_misses_total{job=\"kube-dns\",pod=~\"$instance\"}) + sum(coredns_cache_hits_total{job=\"kube-dns\",pod=~\"$instance\"}))",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "",
                  "refId": "A"
                }
              ],
              "thresholds": "",
              "title": "Cached",
              "type": "singlestat",
              "valueFontSize": "80%",
              "valueMaps": [
                {
                  "op": "=",
                  "text": "N/A",
                  "value": "null"
                }
              ],
              "valueName": "min"
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {},
              "id": 10,
              "legend": {
                "alignAsTable": false,
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "rightSide": false,
                "show": true,
                "sideWidth": null,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "repeat": null,
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 5,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate(coredns_cache_hits_total{job=\"kube-dns\",pod=~\"$instance\"}[5m])) by (type)",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "{{type}}",
                  "refId": "A"
                },
                {
                  "expr": "sum(rate(coredns_cache_misses_total{job=\"kube-dns\",pod=~\"$instance\"}[5m]))",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "misses",
                  "refId": "B"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Cache hit Rate",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "ops",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "ops",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                }
              ]
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {},
              "id": 11,
              "legend": {
                "alignAsTable": false,
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "rightSide": false,
                "show": true,
                "sideWidth": null,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "repeat": null,
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 5,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(coredns_cache_entries{job=\"kube-dns\",pod=~\"$instance\"}) by (type)",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "{{type}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Cache Size",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                }
              ]
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": false,
          "title": "Dashboard Row",
          "titleSize": "h6",
          "type": "row"
        },
        {
          "collapse": false,
          "collapsed": false,
          "panels": [
            {
              "cacheTimeout": null,
              "colorBackground": false,
              "colorValue": false,
              "colors": [
                "#299c46",
                "rgba(237, 129, 40, 0.89)",
                "#d44a3a"
              ],
              "datasource": "$datasource",
              "format": "none",
              "gauge": {
                "maxValue": 100,
                "minValue": 0,
                "show": false,
                "thresholdLabels": false,
                "thresholdMarkers": true
              },
              "gridPos": {},
              "id": 12,
              "interval": null,
              "links": [],
              "mappingType": 1,
              "mappingTypes": [
                {
                  "name": "value to text",
                  "value": 1
                },
                {
                  "name": "range to text",
                  "value": 2
                }
              ],
              "maxDataPoints": 100,
              "nullPointMode": "connected",
              "nullText": null,
              "postfix": "",
              "postfixFontSize": "50%",
              "prefix": "",
              "prefixFontSize": "50%",
              "rangeMaps": [
                {
                  "from": "null",
                  "text": "N/A",
                  "to": "null"
                }
              ],
              "span": 2,
              "sparkline": {
                "fillColor": "rgba(31, 118, 189, 0.18)",
                "full": false,
                "lineColor": "rgb(31, 120, 193)",
                "show": false
              },
              "tableColumn": "",
              "targets": [
                {
                  "expr": "count(sum(coredns_plugin_enabled{job=\"kube-dns\",pod=~\"$instance\"}) by (name))",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "",
                  "refId": "A"
                }
              ],
              "thresholds": "",
              "title": "Plugins Enabled",
              "type": "singlestat",
              "valueFontSize": "80%",
              "valueMaps": [
                {
                  "op": "=",
                  "text": "N/A",
                  "value": "null"
                }
              ],
              "valueName": "min"
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {},
              "id": 13,
              "legend": {
                "alignAsTable": false,
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "rightSide": false,
                "show": true,
                "sideWidth": null,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "repeat": null,
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 5,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "histogram_quantile(0.99, sum(rate(coredns_dns_request_size_bytes_bucket{job=\"kube-dns\",pod=~\"$instance\"}[5m])) by (server, zone, proto, le))",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "99th {{server}} {{zone}} {{proto}}",
                  "refId": "A"
                },
                {
                  "expr": "histogram_quantile(0.50, sum(rate(coredns_dns_request_size_bytes_bucket{job=\"kube-dns\",pod=~\"$instance\"}[5m])) by (server, zone, proto, le))",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "50th {{server}} {{zone}} {{proto}}",
                  "refId": "B"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Request size",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "bytes",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "bytes",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                }
              ]
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {},
              "id": 14,
              "legend": {
                "alignAsTable": false,
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "rightSide": false,
                "show": true,
                "sideWidth": null,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "repeat": null,
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 5,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "histogram_quantile(0.99, sum(rate(coredns_dns_response_size_bytes_bucket{job=\"kube-dns\",pod=~\"$instance\"}[5m])) by (server, zone, proto, le))",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "99th {{server}} {{zone}} {{proto}}",
                  "refId": "A"
                },
                {
                  "expr": "histogram_quantile(0.50, sum(rate(coredns_dns_response_size_bytes_bucket{job=\"kube-dns\",pod=~\"$instance\"}[5m])) by (server, zone, proto, le))",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "50th {{server}} {{zone}} {{proto}}",
                  "refId": "B"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Response size",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "bytes",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "bytes",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                }
              ]
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": false,
          "title": "Dashboard Row",
          "titleSize": "h6",
          "type": "row"
        },
        {
          "collapse": false,
          "collapsed": false,
          "panels": [
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {},
              "id": 15,
              "legend": {
                "alignAsTable": false,
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "rightSide": false,
                "show": true,
                "sideWidth": null,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "repeat": null,
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 4,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "process_resident_memory_bytes{job=\"kube-dns\",pod=~\"$instance\"}",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "{{pod}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Memory",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "bytes",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "bytes",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                }
              ]
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {},
              "id": 16,
              "legend": {
                "alignAsTable": false,
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "rightSide": false,
                "show": true,
                "sideWidth": null,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "repeat": null,
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 4,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "rate(process_cpu_seconds_total{job=\"kube-dns\",pod=~\"$instance\"}[5m])",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "{{pod}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "CPU usage",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                }
              ]
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {},
              "id": 17,
              "legend": {
                "alignAsTable": false,
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "rightSide": false,
                "show": true,
                "sideWidth": null,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "repeat": null,
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 4,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "go_goroutines{job=\"kube-dns\",pod=~\"$instance\"}",
                  "format": "time_series",
                  "intervalFactor": 2,
                  "legendFormat": "{{pod}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Goroutines",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "graph",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                }
              ]
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": false,
          "title": "Dashboard Row",
          "titleSize": "h6",
          "type": "row"
        }
      ],
      "schemaVersion": 14,
      "style": "dark",
      "tags": [
        "coredns-mixin"
      ],
      "templating": {
        "list": [
          {
            "current": {
              "text": "default",
              "value": "default"
            },
            "hide": 0,
            "label": "Data Source",
            "name": "datasource",
            "options": [],
            "query": "prometheus",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
          },
          {
            "allValue": null,
            "current": {},
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": true,
            "label": null,
            "multi": false,
            "name": "instance",
            "options": [],
            "query": "label_values(coredns_build_info{job=\"kube-dns\"}, pod)",
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          }
        ]
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "browser",
      "title": "CoreDNS",
      "uid": "thael1rie7ohG6OY3eMeisahtee2iGoo1gooGhuu",
      "version": 0
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-grafana-overview
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Grafana"
  resyncPeriod: 24h
  json: |
    {
        "annotations": {
            "list": [
                {
                    "builtIn": 1,
                    "datasource": {
                        "type": "datasource",
                        "uid": "grafana"
                    },
                    "enable": true,
                    "hide": true,
                    "iconColor": "rgba(0, 211, 255, 1)",
                    "name": "Annotations & Alerts",
                    "target": {
                        "limit": 100,
                        "matchAny": false,
                        "tags": [

                        ],
                        "type": "dashboard"
                    },
                    "type": "dashboard"
                }
            ]
        },
        "editable": false,
        "fiscalYearStartMonth": 0,
        "graphTooltip": 0,
        "id": 23,
        "links": [

        ],
        "panels": [
            {
                "datasource": {
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "mappings": [

                        ],
                        "noValue": "0",
                        "thresholds": {
                            "mode": "absolute",
                            "steps": [
                                {
                                    "color": "green"
                                },
                                {
                                    "color": "red",
                                    "value": 80
                                }
                            ]
                        }
                    },
                    "overrides": [

                    ]
                },
                "gridPos": {
                    "h": 5,
                    "w": 6,
                    "x": 0,
                    "y": 0
                },
                "id": 6,
                "options": {
                    "colorMode": "value",
                    "graphMode": "area",
                    "justifyMode": "auto",
                    "orientation": "auto",
                    "percentChangeColorMode": "standard",
                    "reduceOptions": {
                        "calcs": [
                            "mean"
                        ],
                        "fields": "",
                        "values": false
                    },
                    "showPercentChange": false,
                    "text": {

                    },
                    "textMode": "auto",
                    "wideLayout": true
                },
                "pluginVersion": "12.0.2",
                "targets": [
                    {
                        "datasource": {
                            "uid": "$datasource"
                        },
                        "expr": "grafana_alerting_result_total{job=~\"$job\", instance=~\"$instance\", state=\"alerting\"}",
                        "instant": true,
                        "interval": "1m",
                        "legendFormat": "",
                        "refId": "A"
                    }
                ],
                "title": "Firing Alerts",
                "type": "stat"
            },
            {
                "datasource": {
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "mappings": [

                        ],
                        "thresholds": {
                            "mode": "absolute",
                            "steps": [
                                {
                                    "color": "green"
                                },
                                {
                                    "color": "red",
                                    "value": 80
                                }
                            ]
                        }
                    },
                    "overrides": [

                    ]
                },
                "gridPos": {
                    "h": 5,
                    "w": 6,
                    "x": 6,
                    "y": 0
                },
                "id": 8,
                "options": {
                    "colorMode": "value",
                    "graphMode": "area",
                    "justifyMode": "auto",
                    "orientation": "auto",
                    "percentChangeColorMode": "standard",
                    "reduceOptions": {
                        "calcs": [
                            "mean"
                        ],
                        "fields": "",
                        "values": false
                    },
                    "showPercentChange": false,
                    "text": {

                    },
                    "textMode": "auto",
                    "wideLayout": true
                },
                "pluginVersion": "12.0.2",
                "targets": [
                    {
                        "datasource": {
                            "uid": "$datasource"
                        },
                        "expr": "sum(grafana_stat_totals_dashboard{job=~\"$job\", instance=~\"$instance\"})",
                        "interval": "1m",
                        "legendFormat": "",
                        "refId": "A"
                    }
                ],
                "title": "Dashboards",
                "type": "stat"
            },
            {
                "datasource": {
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "cellOptions": {
                                "type": "auto"
                            },
                            "inspect": false
                        },
                        "mappings": [

                        ],
                        "thresholds": {
                            "mode": "absolute",
                            "steps": [
                                {
                                    "color": "green"
                                },
                                {
                                    "color": "red",
                                    "value": 80
                                }
                            ]
                        }
                    },
                    "overrides": [

                    ]
                },
                "gridPos": {
                    "h": 5,
                    "w": 12,
                    "x": 12,
                    "y": 0
                },
                "id": 10,
                "options": {
                    "cellHeight": "sm",
                    "footer": {
                        "countRows": false,
                        "fields": "",
                        "reducer": [
                            "sum"
                        ],
                        "show": false
                    },
                    "showHeader": true
                },
                "pluginVersion": "12.0.2",
                "targets": [
                    {
                        "datasource": {
                            "uid": "$datasource"
                        },
                        "expr": "grafana_build_info{job=~\"$job\", instance=~\"$instance\"}",
                        "instant": true,
                        "interval": "1m",
                        "legendFormat": "",
                        "refId": "A"
                    }
                ],
                "title": "Build Info",
                "transformations": [
                    {
                        "id": "labelsToFields",
                        "options": {

                        }
                    },
                    {
                        "id": "merge",
                        "options": {

                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Value": true,
                                "branch": true,
                                "container": true,
                                "goversion": true,
                                "namespace": true,
                                "pod": true,
                                "revision": true
                            },
                            "indexByName": {
                                "Time": 7,
                                "Value": 11,
                                "branch": 4,
                                "container": 8,
                                "edition": 2,
                                "goversion": 6,
                                "instance": 1,
                                "job": 0,
                                "namespace": 9,
                                "pod": 10,
                                "revision": 5,
                                "version": 3
                            },
                            "renameByName": {

                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "color": {
                            "mode": "palette-classic"
                        },
                        "custom": {
                            "axisBorderShow": false,
                            "axisCenteredZero": false,
                            "axisColorMode": "text",
                            "axisLabel": "",
                            "axisPlacement": "auto",
                            "barAlignment": 0,
                            "barWidthFactor": 0.59999999999999998,
                            "drawStyle": "line",
                            "fillOpacity": 10,
                            "gradientMode": "none",
                            "hideFrom": {
                                "legend": false,
                                "tooltip": false,
                                "viz": false
                            },
                            "insertNulls": false,
                            "lineInterpolation": "linear",
                            "lineWidth": 1,
                            "pointSize": 5,
                            "scaleDistribution": {
                                "type": "linear"
                            },
                            "showPoints": "never",
                            "spanNulls": false,
                            "stacking": {
                                "group": "A",
                                "mode": "normal"
                            },
                            "thresholdsStyle": {
                                "mode": "off"
                            }
                        },
                        "links": [

                        ],
                        "mappings": [

                        ],
                        "thresholds": {
                            "mode": "absolute",
                            "steps": [
                                {
                                    "color": "green"
                                },
                                {
                                    "color": "red",
                                    "value": 80
                                }
                            ]
                        },
                        "unit": "reqps"
                    },
                    "overrides": [

                    ]
                },
                "gridPos": {
                    "h": 8,
                    "w": 12,
                    "x": 0,
                    "y": 5
                },
                "id": 2,
                "options": {
                    "alertThreshold": true,
                    "legend": {
                        "calcs": [

                        ],
                        "displayMode": "list",
                        "placement": "bottom",
                        "showLegend": true
                    },
                    "tooltip": {
                        "hideZeros": false,
                        "mode": "multi",
                        "sort": "none"
                    }
                },
                "pluginVersion": "12.0.2",
                "targets": [
                    {
                        "datasource": {
                            "uid": "$datasource"
                        },
                        "expr": "sum by (status_code) (irate(grafana_http_request_duration_seconds_count{job=~\"$job\", instance=~\"$instance\"}[1m])) ",
                        "interval": "1m",
                        "legendFormat": "{{status_code}}",
                        "refId": "A"
                    }
                ],
                "title": "RPS",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "color": {
                            "mode": "palette-classic"
                        },
                        "custom": {
                            "axisBorderShow": false,
                            "axisCenteredZero": false,
                            "axisColorMode": "text",
                            "axisLabel": "",
                            "axisPlacement": "auto",
                            "barAlignment": 0,
                            "barWidthFactor": 0.59999999999999998,
                            "drawStyle": "line",
                            "fillOpacity": 10,
                            "gradientMode": "none",
                            "hideFrom": {
                                "legend": false,
                                "tooltip": false,
                                "viz": false
                            },
                            "insertNulls": false,
                            "lineInterpolation": "linear",
                            "lineWidth": 1,
                            "pointSize": 5,
                            "scaleDistribution": {
                                "type": "linear"
                            },
                            "showPoints": "never",
                            "spanNulls": false,
                            "stacking": {
                                "group": "A",
                                "mode": "none"
                            },
                            "thresholdsStyle": {
                                "mode": "off"
                            }
                        },
                        "links": [

                        ],
                        "mappings": [

                        ],
                        "thresholds": {
                            "mode": "absolute",
                            "steps": [
                                {
                                    "color": "green"
                                },
                                {
                                    "color": "red",
                                    "value": 80
                                }
                            ]
                        },
                        "unit": "ms"
                    },
                    "overrides": [

                    ]
                },
                "gridPos": {
                    "h": 8,
                    "w": 12,
                    "x": 12,
                    "y": 5
                },
                "id": 4,
                "options": {
                    "alertThreshold": true,
                    "legend": {
                        "calcs": [

                        ],
                        "displayMode": "list",
                        "placement": "bottom",
                        "showLegend": true
                    },
                    "tooltip": {
                        "hideZeros": false,
                        "mode": "multi",
                        "sort": "none"
                    }
                },
                "pluginVersion": "12.0.2",
                "targets": [
                    {
                        "datasource": {
                            "uid": "$datasource"
                        },
                        "exemplar": true,
                        "expr": "histogram_quantile(0.99, sum(irate(grafana_http_request_duration_seconds_bucket{instance=~\"$instance\", job=~\"$job\"}[$__rate_interval])) by (le)) * 1",
                        "interval": "1m",
                        "legendFormat": "99th Percentile",
                        "refId": "A"
                    },
                    {
                        "datasource": {
                            "uid": "$datasource"
                        },
                        "exemplar": true,
                        "expr": "histogram_quantile(0.50, sum(irate(grafana_http_request_duration_seconds_bucket{instance=~\"$instance\", job=~\"$job\"}[$__rate_interval])) by (le)) * 1",
                        "interval": "1m",
                        "legendFormat": "50th Percentile",
                        "refId": "B"
                    },
                    {
                        "datasource": {
                            "uid": "$datasource"
                        },
                        "exemplar": true,
                        "expr": "sum(irate(grafana_http_request_duration_seconds_sum{instance=~\"$instance\", job=~\"$job\"}[$__rate_interval])) * 1 / sum(irate(grafana_http_request_duration_seconds_count{instance=~\"$instance\", job=~\"$job\"}[$__rate_interval]))",
                        "interval": "1m",
                        "legendFormat": "Average",
                        "refId": "C"
                    }
                ],
                "title": "Request Latency",
                "type": "timeseries"
            }
        ],
        "preload": false,
        "refresh": "",
        "schemaVersion": 41,
        "tags": [

        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "text": "Prometheus",
                        "value": "prometheus"
                    },
                    "includeAll": false,
                    "name": "datasource",
                    "options": [

                    ],
                    "query": "prometheus",
                    "refresh": 1,
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "allValue": ".*",
                    "current": {
                        "text": "All",
                        "value": [
                            "$__all"
                        ]
                    },
                    "datasource": "$datasource",
                    "definition": "label_values(grafana_build_info, job)",
                    "includeAll": true,
                    "multi": true,
                    "name": "job",
                    "options": [

                    ],
                    "query": {
                        "query": "label_values(grafana_build_info, job)",
                        "refId": "Billing Admin-job-Variable-Query"
                    },
                    "refresh": 1,
                    "regex": "",
                    "type": "query"
                },
                {
                    "allValue": ".*",
                    "current": {
                        "text": "All",
                        "value": "$__all"
                    },
                    "datasource": "$datasource",
                    "definition": "label_values(grafana_build_info, instance)",
                    "includeAll": true,
                    "multi": true,
                    "name": "instance",
                    "options": [

                    ],
                    "query": {
                        "query": "label_values(grafana_build_info, instance)",
                        "refId": "Billing Admin-instance-Variable-Query"
                    },
                    "refresh": 1,
                    "regex": "",
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-6h",
            "to": "now"
        },
        "timepicker": {
            "refresh_intervals": [
                "10s",
                "30s",
                "1m",
                "5m",
                "15m",
                "30m",
                "1h",
                "2h",
                "1d"
            ]
        },
        "timezone": "utc",
        "title": "Grafana Overview",
        "uid": "6be0s85Mk",
        "version": 1
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-k8s-resources-cluster
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 4,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "cluster:node_cpu:ratio_rate5m{cluster=\"$cluster\"}",
                        "instant": true
                    }
                ],
                "title": "CPU Utilisation",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 4,
                    "x": 4,
                    "y": 0
                },
                "id": 2,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(namespace_cpu:kube_pod_container_resource_requests:sum{cluster=\"$cluster\"}) / sum(kube_node_status_allocatable{job=\"kube-state-metrics\",resource=\"cpu\",cluster=\"$cluster\"})",
                        "instant": true
                    }
                ],
                "title": "CPU Requests Commitment",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 4,
                    "x": 8,
                    "y": 0
                },
                "id": 3,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(namespace_cpu:kube_pod_container_resource_limits:sum{cluster=\"$cluster\"}) / sum(kube_node_status_allocatable{job=\"kube-state-metrics\",resource=\"cpu\",cluster=\"$cluster\"})",
                        "instant": true
                    }
                ],
                "title": "CPU Limits Commitment",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 4,
                    "x": 12,
                    "y": 0
                },
                "id": 4,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "1 - sum(:node_memory_MemAvailable_bytes:sum{cluster=\"$cluster\"}) / sum(node_memory_MemTotal_bytes{job=\"node-exporter\",cluster=\"$cluster\"})",
                        "instant": true
                    }
                ],
                "title": "Memory Utilisation",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 4,
                    "x": 16,
                    "y": 0
                },
                "id": 5,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(namespace_memory:kube_pod_container_resource_requests:sum{cluster=\"$cluster\"}) / sum(kube_node_status_allocatable{job=\"kube-state-metrics\",resource=\"memory\",cluster=\"$cluster\"})",
                        "instant": true
                    }
                ],
                "title": "Memory Requests Commitment",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 4,
                    "x": 20,
                    "y": 0
                },
                "id": 6,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(namespace_memory:kube_pod_container_resource_limits:sum{cluster=\"$cluster\"}) / sum(kube_node_status_allocatable{job=\"kube-state-metrics\",resource=\"memory\",cluster=\"$cluster\"})",
                        "instant": true
                    }
                ],
                "title": "Memory Limits Commitment",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        }
                    }
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 6
                },
                "id": 7,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\"})) by (namespace)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "CPU Usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/%/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Namespace"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to pods",
                                            "url": "/d/85a562078cdf77779eaa1add43ccec1e/k8s-resources-namespace?${datasource:queryparam}&var-cluster=$cluster&var-namespace=${__data.fields.Namespace}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 12
                },
                "id": 8,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_pod_owner{job=\"kube-state-metrics\", cluster=\"$cluster\"}) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "count(avg(namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\"}) by (workload, namespace)) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\"})) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(namespace_cpu:kube_pod_container_resource_requests:sum{cluster=\"$cluster\"}) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\"})) by (namespace) / sum(namespace_cpu:kube_pod_container_resource_requests:sum{cluster=\"$cluster\"}) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(namespace_cpu:kube_pod_container_resource_limits:sum{cluster=\"$cluster\"}) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\"})) by (namespace) / sum(namespace_cpu:kube_pod_container_resource_limits:sum{cluster=\"$cluster\"}) by (namespace)",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "CPU Quota",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "namespace",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true,
                                "Time 7": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Time 7": 6,
                                "Value #A": 8,
                                "Value #B": 9,
                                "Value #C": 10,
                                "Value #D": 11,
                                "Value #E": 12,
                                "Value #F": 13,
                                "Value #G": 14,
                                "namespace": 7
                            },
                            "renameByName": {
                                "Value #A": "Pods",
                                "Value #B": "Workloads",
                                "Value #C": "CPU Usage",
                                "Value #D": "CPU Requests",
                                "Value #E": "CPU Requests %",
                                "Value #F": "CPU Limits",
                                "Value #G": "CPU Limits %",
                                "namespace": "Namespace"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bytes"
                    }
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 18
                },
                "id": 9,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_rss{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", container!=\"\"})) by (namespace)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Memory",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/%/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Memory Usage"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "bytes"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Memory Requests"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "bytes"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Memory Limits"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "bytes"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Namespace"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to pods",
                                            "url": "/d/85a562078cdf77779eaa1add43ccec1e/k8s-resources-namespace?${datasource:queryparam}&var-cluster=$cluster&var-namespace=${__data.fields.Namespace}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 24
                },
                "id": 10,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_pod_owner{job=\"kube-state-metrics\", cluster=\"$cluster\"}) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "count(avg(namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\"}) by (workload, namespace)) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_rss{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", container!=\"\"})) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(namespace_memory:kube_pod_container_resource_requests:sum{cluster=\"$cluster\"}) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_rss{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", container!=\"\"})) by (namespace) / sum(namespace_memory:kube_pod_container_resource_requests:sum{cluster=\"$cluster\"}) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(namespace_memory:kube_pod_container_resource_limits:sum{cluster=\"$cluster\"}) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_rss{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", container!=\"\"})) by (namespace) / sum(namespace_memory:kube_pod_container_resource_limits:sum{cluster=\"$cluster\"}) by (namespace)",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Memory Requests by Namespace",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "namespace",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true,
                                "Time 7": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Time 7": 6,
                                "Value #A": 8,
                                "Value #B": 9,
                                "Value #C": 10,
                                "Value #D": 11,
                                "Value #E": 12,
                                "Value #F": 13,
                                "Value #G": 14,
                                "namespace": 7
                            },
                            "renameByName": {
                                "Value #A": "Pods",
                                "Value #B": "Workloads",
                                "Value #C": "Memory Usage",
                                "Value #D": "Memory Requests",
                                "Value #E": "Memory Requests %",
                                "Value #F": "Memory Limits",
                                "Value #G": "Memory Limits %",
                                "namespace": "Namespace"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Bandwidth/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "bps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Packets/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "pps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Namespace"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to pods",
                                            "url": "/d/85a562078cdf77779eaa1add43ccec1e/k8s-resources-namespace?${datasource:queryparam}&var-cluster=$cluster&var-namespace=${__data.fields.Namespace}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 30
                },
                "id": 11,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=~\".+\"}[$__rate_interval])) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=~\".+\"}[$__rate_interval])) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=~\".+\"}[$__rate_interval])) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=~\".+\"}[$__rate_interval])) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=~\".+\"}[$__rate_interval])) by (namespace)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=~\".+\"}[$__rate_interval])) by (namespace)",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Current Network Usage",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "namespace",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Value #A": 7,
                                "Value #B": 8,
                                "Value #C": 9,
                                "Value #D": 10,
                                "Value #E": 11,
                                "Value #F": 12,
                                "namespace": 6
                            },
                            "renameByName": {
                                "Value #A": "Current Receive Bandwidth",
                                "Value #B": "Current Transmit Bandwidth",
                                "Value #C": "Rate of Received Packets",
                                "Value #D": "Rate of Transmitted Packets",
                                "Value #E": "Rate of Received Packets Dropped",
                                "Value #F": "Rate of Transmitted Packets Dropped",
                                "namespace": "Namespace"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 36
                },
                "id": 12,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=~\".+\"}[$__rate_interval])) by (namespace)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Receive Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 42
                },
                "id": 13,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=~\".+\"}[$__rate_interval])) by (namespace)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Transmit Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 48
                },
                "id": 14,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "avg(rate(container_network_receive_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=~\".+\"}[$__rate_interval])) by (namespace)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Average Container Bandwidth by Namespace: Received",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 54
                },
                "id": 15,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "avg(rate(container_network_transmit_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=~\".+\"}[$__rate_interval])) by (namespace)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Average Container Bandwidth by Namespace: Transmitted",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 60
                },
                "id": 16,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=~\".+\"}[$__rate_interval])) by (namespace)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 66
                },
                "id": 17,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=~\".+\"}[$__rate_interval])) by (namespace)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 72
                },
                "id": 18,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=~\".+\"}[$__rate_interval])) by (namespace)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets Dropped",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 78
                },
                "id": 19,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=~\".+\"}[$__rate_interval])) by (namespace)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets Dropped",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "iops"
                    }
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 84
                },
                "id": 20,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "ceil(sum by(namespace) (rate(container_fs_reads_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", container!=\"\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", cluster=\"$cluster\", namespace!=\"\"}[$__rate_interval]) + rate(container_fs_writes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", container!=\"\", cluster=\"$cluster\", namespace!=\"\"}[$__rate_interval])))",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "IOPS(Reads+Writes)",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "Bps"
                    }
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 90
                },
                "id": 21,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(namespace) (rate(container_fs_reads_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", container!=\"\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", cluster=\"$cluster\", namespace!=\"\"}[$__rate_interval]) + rate(container_fs_writes_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", container!=\"\", cluster=\"$cluster\", namespace!=\"\"}[$__rate_interval]))",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "ThroughPut(Read+Write)",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/IOPS/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "iops"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Throughput/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "bps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Namespace"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to pods",
                                            "url": "/d/85a562078cdf77779eaa1add43ccec1e/k8s-resources-namespace?${datasource:queryparam}&var-cluster=$cluster&var-namespace=${__data.fields.Namespace}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 96
                },
                "id": 22,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(namespace) (rate(container_fs_reads_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace!=\"\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(namespace) (rate(container_fs_writes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace!=\"\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(namespace) (rate(container_fs_reads_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace!=\"\"}[$__rate_interval]) + rate(container_fs_writes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace!=\"\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(namespace) (rate(container_fs_reads_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace!=\"\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(namespace) (rate(container_fs_writes_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace!=\"\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(namespace) (rate(container_fs_reads_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace!=\"\"}[$__rate_interval]) + rate(container_fs_writes_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace!=\"\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Current Storage IO",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "namespace",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Value #A": 7,
                                "Value #B": 8,
                                "Value #C": 9,
                                "Value #D": 10,
                                "Value #E": 11,
                                "Value #F": 12,
                                "namespace": 6
                            },
                            "renameByName": {
                                "Value #A": "IOPS(Reads)",
                                "Value #B": "IOPS(Writes)",
                                "Value #C": "IOPS(Reads + Writes)",
                                "Value #D": "Throughput(Read)",
                                "Value #E": "Throughput(Write)",
                                "Value #F": "Throughput(Read + Write)",
                                "namespace": "Namespace"
                            }
                        }
                    }
                ],
                "type": "table"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(up{job=\"kube-state-metrics\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Compute Resources / Cluster",
        "uid": "efa86fd1d0c121a26444b636a3f509a8"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-k8s-resources-multicluster
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "none"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 4,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(cluster:node_cpu:ratio_rate5m) / count(cluster:node_cpu:ratio_rate5m)",
                        "instant": true
                    }
                ],
                "title": "CPU Utilisation",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 4,
                    "x": 4,
                    "y": 0
                },
                "id": 2,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_pod_container_resource_requests{job=\"kube-state-metrics\", resource=\"cpu\"}) / sum(kube_node_status_allocatable{job=\"kube-state-metrics\", resource=\"cpu\"})",
                        "instant": true
                    }
                ],
                "title": "CPU Requests Commitment",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 4,
                    "x": 8,
                    "y": 0
                },
                "id": 3,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_pod_container_resource_limits{job=\"kube-state-metrics\", resource=\"cpu\"}) / sum(kube_node_status_allocatable{job=\"kube-state-metrics\", resource=\"cpu\"})",
                        "instant": true
                    }
                ],
                "title": "CPU Limits Commitment",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 4,
                    "x": 12,
                    "y": 0
                },
                "id": 4,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "1 - sum(:node_memory_MemAvailable_bytes:sum) / sum(node_memory_MemTotal_bytes{job=\"node-exporter\"})",
                        "instant": true
                    }
                ],
                "title": "Memory Utilisation",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 4,
                    "x": 16,
                    "y": 0
                },
                "id": 5,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_pod_container_resource_requests{job=\"kube-state-metrics\", resource=\"memory\"}) / sum(kube_node_status_allocatable{job=\"kube-state-metrics\", resource=\"memory\"})",
                        "instant": true
                    }
                ],
                "title": "Memory Requests Commitment",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 4,
                    "x": 20,
                    "y": 0
                },
                "id": 6,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_pod_container_resource_limits{job=\"kube-state-metrics\", resource=\"memory\"}) / sum(kube_node_status_allocatable{job=\"kube-state-metrics\", resource=\"memory\"})",
                        "instant": true
                    }
                ],
                "title": "Memory Limits Commitment",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        }
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 1
                },
                "id": 7,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m)) by (cluster)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "CPU Usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/%/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Cluster"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down",
                                            "url": "/d/efa86fd1d0c121a26444b636a3f509a8/kubernetes-compute-resources-cluster?${datasource:queryparam}&var-cluster=${__data.fields.Cluster}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 2
                },
                "id": 8,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m)) by (cluster)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_pod_container_resource_requests{job=\"kube-state-metrics\", resource=\"cpu\"}) by (cluster)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m)) by (cluster) / sum(kube_pod_container_resource_requests{job=\"kube-state-metrics\", resource=\"cpu\"}) by (cluster)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_pod_container_resource_limits{job=\"kube-state-metrics\", resource=\"cpu\"}) by (cluster)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m)) by (cluster) / sum(kube_pod_container_resource_limits{job=\"kube-state-metrics\", resource=\"cpu\"}) by (cluster)",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "CPU Quota",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "cluster",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Value #A": 6,
                                "Value #B": 7,
                                "Value #C": 8,
                                "Value #D": 9,
                                "Value #E": 10,
                                "cluster": 5
                            },
                            "renameByName": {
                                "Value #A": "CPU Usage",
                                "Value #B": "CPU Requests",
                                "Value #C": "CPU Requests %",
                                "Value #D": "CPU Limits",
                                "Value #E": "CPU Limits %",
                                "cluster": "Cluster"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "bytes"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 3
                },
                "id": 9,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_rss{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", container!=\"\"})) by (cluster)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Memory Usage (w/o cache)",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "bytes"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/%/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Cluster"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down",
                                            "url": "/d/efa86fd1d0c121a26444b636a3f509a8/kubernetes-compute-resources-cluster?${datasource:queryparam}&var-cluster=${__data.fields.Cluster}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 4
                },
                "id": 10,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_rss{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", container!=\"\"})) by (cluster)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_pod_container_resource_requests{job=\"kube-state-metrics\", resource=\"memory\"}) by (cluster)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_rss{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", container!=\"\"})) by (cluster) / sum(kube_pod_container_resource_requests{job=\"kube-state-metrics\", resource=\"memory\"}) by (cluster)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_pod_container_resource_limits{job=\"kube-state-metrics\", resource=\"memory\"}) by (cluster)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_rss{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", container!=\"\"})) by (cluster) / sum(kube_pod_container_resource_limits{job=\"kube-state-metrics\", resource=\"memory\"}) by (cluster)",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Memory Requests by Cluster",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "cluster",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Value #A": 6,
                                "Value #B": 7,
                                "Value #C": 8,
                                "Value #D": 9,
                                "Value #E": 10,
                                "cluster": 5
                            },
                            "renameByName": {
                                "Value #A": "Memory Usage",
                                "Value #B": "Memory Requests",
                                "Value #C": "Memory Requests %",
                                "Value #D": "Memory Limits",
                                "Value #E": "Memory Limits %",
                                "cluster": "Cluster"
                            }
                        }
                    }
                ],
                "type": "table"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Compute Resources /  Multi-Cluster",
        "uid": "b59e6c9f2fcbe2e16d77fc492374cc4f"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-k8s-resources-namespace
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 6,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\"})) / sum(kube_pod_container_resource_requests{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"cpu\"})",
                        "instant": true
                    }
                ],
                "title": "CPU Utilisation (from requests)",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 6,
                    "x": 6,
                    "y": 0
                },
                "id": 2,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\"})) / sum(kube_pod_container_resource_limits{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"cpu\"})",
                        "instant": true
                    }
                ],
                "title": "CPU Utilisation (from limits)",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 6,
                    "x": 12,
                    "y": 0
                },
                "id": 3,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\",container!=\"\", image!=\"\"})) / sum(kube_pod_container_resource_requests{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"memory\"})",
                        "instant": true
                    }
                ],
                "title": "Memory Utilisation (from requests)",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 3,
                    "w": 6,
                    "x": 18,
                    "y": 0
                },
                "id": 4,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\",container!=\"\", image!=\"\"})) / sum(kube_pod_container_resource_limits{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"memory\"})",
                        "instant": true
                    }
                ],
                "title": "Memory Utilisation (from limits)",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        }
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byFrameRefID",
                                "options": "B"
                            },
                            "properties": [
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "fill": "dash"
                                    }
                                },
                                {
                                    "id": "custom.lineWidth",
                                    "value": 2
                                },
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "red",
                                        "mode": "fixed"
                                    }
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byFrameRefID",
                                "options": "C"
                            },
                            "properties": [
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "fill": "dash"
                                    }
                                },
                                {
                                    "id": "custom.lineWidth",
                                    "value": 2
                                },
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "orange",
                                        "mode": "fixed"
                                    }
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 7
                },
                "id": 5,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\"})) by (pod)",
                        "legendFormat": "__auto"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "scalar(max(kube_resourcequota{cluster=\"$cluster\", namespace=\"$namespace\", type=\"hard\",resource=\"requests.cpu\"}))",
                        "legendFormat": "quota - requests"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "scalar(max(kube_resourcequota{cluster=\"$cluster\", namespace=\"$namespace\", type=\"hard\",resource=\"limits.cpu\"}))",
                        "legendFormat": "quota - limits"
                    }
                ],
                "title": "CPU Usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/%/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Pod"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to pods",
                                            "url": "/d/6581e46e4e5c7ba40a07646395ef7b23/k8s-resources-pod?${datasource:queryparam}&var-cluster=$cluster&var-namespace=$namespace&var-pod=${__data.fields.Pod}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 14
                },
                "id": 6,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests{cluster=\"$cluster\", namespace=\"$namespace\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\"})) by (pod) / sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests{cluster=\"$cluster\", namespace=\"$namespace\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_cpu:active:kube_pod_container_resource_limits{cluster=\"$cluster\", namespace=\"$namespace\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\"})) by (pod) / sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_cpu:active:kube_pod_container_resource_limits{cluster=\"$cluster\", namespace=\"$namespace\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "CPU Quota",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "pod",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Value #A": 6,
                                "Value #B": 7,
                                "Value #C": 8,
                                "Value #D": 9,
                                "Value #E": 10,
                                "pod": 5
                            },
                            "renameByName": {
                                "Value #A": "CPU Usage",
                                "Value #B": "CPU Requests",
                                "Value #C": "CPU Requests %",
                                "Value #D": "CPU Limits",
                                "Value #E": "CPU Limits %",
                                "pod": "Pod"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bytes"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byFrameRefID",
                                "options": "B"
                            },
                            "properties": [
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "fill": "dash"
                                    }
                                },
                                {
                                    "id": "custom.lineWidth",
                                    "value": 2
                                },
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "red",
                                        "mode": "fixed"
                                    }
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byFrameRefID",
                                "options": "C"
                            },
                            "properties": [
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "fill": "dash"
                                    }
                                },
                                {
                                    "id": "custom.lineWidth",
                                    "value": 2
                                },
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "orange",
                                        "mode": "fixed"
                                    }
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 21
                },
                "id": 7,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", container!=\"\", image!=\"\"})) by (pod)",
                        "legendFormat": "__auto"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "scalar(max(kube_resourcequota{cluster=\"$cluster\", namespace=\"$namespace\", type=\"hard\",resource=\"requests.memory\"}))",
                        "legendFormat": "quota - requests"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "scalar(max(kube_resourcequota{cluster=\"$cluster\", namespace=\"$namespace\", type=\"hard\",resource=\"limits.memory\"}))",
                        "legendFormat": "quota - limits"
                    }
                ],
                "title": "Memory Usage (w/o cache)",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "bytes"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/%/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Pod"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to pods",
                                            "url": "/d/6581e46e4e5c7ba40a07646395ef7b23/k8s-resources-pod?${datasource:queryparam}&var-cluster=$cluster&var-namespace=$namespace&var-pod=${__data.fields.Pod}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 28
                },
                "id": 8,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", container!=\"\", image!=\"\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_memory:active:kube_pod_container_resource_requests{cluster=\"$cluster\", namespace=\"$namespace\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\",container!=\"\", image!=\"\"})) by (pod) / sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_memory:active:kube_pod_container_resource_requests{cluster=\"$cluster\", namespace=\"$namespace\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_memory:active:kube_pod_container_resource_limits{cluster=\"$cluster\", namespace=\"$namespace\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\",container!=\"\", image!=\"\"})) by (pod) / sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_memory:active:kube_pod_container_resource_limits{cluster=\"$cluster\", namespace=\"$namespace\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_rss{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\",container!=\"\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_cache{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\",container!=\"\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_swap{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\",container!=\"\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Memory Quota",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "pod",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true,
                                "Time 7": true,
                                "Time 8": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Time 7": 6,
                                "Time 8": 7,
                                "Value #A": 9,
                                "Value #B": 10,
                                "Value #C": 11,
                                "Value #D": 12,
                                "Value #E": 13,
                                "Value #F": 14,
                                "Value #G": 15,
                                "Value #H": 16,
                                "pod": 8
                            },
                            "renameByName": {
                                "Value #A": "Memory Usage",
                                "Value #B": "Memory Requests",
                                "Value #C": "Memory Requests %",
                                "Value #D": "Memory Limits",
                                "Value #E": "Memory Limits %",
                                "Value #F": "Memory Usage (RSS)",
                                "Value #G": "Memory Usage (Cache)",
                                "Value #H": "Memory Usage (Swap)",
                                "pod": "Pod"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Bandwidth/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "bps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Packets/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "pps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Pod"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to pods",
                                            "url": "/d/6581e46e4e5c7ba40a07646395ef7b23/k8s-resources-pod?${datasource:queryparam}&var-cluster=$cluster&var-namespace=$namespace&var-pod=${__data.fields.Pod}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 35
                },
                "id": 9,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (pod)",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Current Network Usage",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "pod",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Value #A": 7,
                                "Value #B": 8,
                                "Value #C": 9,
                                "Value #D": 10,
                                "Value #E": 11,
                                "Value #F": 12,
                                "pod": 6
                            },
                            "renameByName": {
                                "Value #A": "Current Receive Bandwidth",
                                "Value #B": "Current Transmit Bandwidth",
                                "Value #C": "Rate of Received Packets",
                                "Value #D": "Rate of Transmitted Packets",
                                "Value #E": "Rate of Received Packets Dropped",
                                "Value #F": "Rate of Transmitted Packets Dropped",
                                "pod": "Pod"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 42
                },
                "id": 10,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_bytes_total{cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Receive Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 42
                },
                "id": 11,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_bytes_total{cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Transmit Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 49
                },
                "id": 12,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 49
                },
                "id": 13,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 56
                },
                "id": 14,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets Dropped",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 56
                },
                "id": 15,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets Dropped",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "iops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 63
                },
                "id": 16,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "ceil(sum by(pod) (rate(container_fs_reads_total{container!=\"\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval]) + rate(container_fs_writes_total{container!=\"\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])))",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "IOPS(Reads+Writes)",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "Bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 63
                },
                "id": 17,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(pod) (rate(container_fs_reads_bytes_total{container!=\"\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval]) + rate(container_fs_writes_bytes_total{container!=\"\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval]))",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "ThroughPut(Read+Write)",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/IOPS/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "iops"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Throughput/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "bps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Pod"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to pods",
                                            "url": "/d/6581e46e4e5c7ba40a07646395ef7b23/k8s-resources-pod?${datasource:queryparam}&var-cluster=$cluster&var-namespace=$namespace&var-pod=${__data.fields.Pod}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 70
                },
                "id": 18,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(pod) (rate(container_fs_reads_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(pod) (rate(container_fs_writes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(pod) (rate(container_fs_reads_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval]) + rate(container_fs_writes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(pod) (rate(container_fs_reads_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(pod) (rate(container_fs_writes_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(pod) (rate(container_fs_reads_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval]) + rate(container_fs_writes_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Current Storage IO",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "pod",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Value #A": 7,
                                "Value #B": 8,
                                "Value #C": 9,
                                "Value #D": 10,
                                "Value #E": 11,
                                "Value #F": 12,
                                "pod": 6
                            },
                            "renameByName": {
                                "Value #A": "IOPS(Reads)",
                                "Value #B": "IOPS(Writes)",
                                "Value #C": "IOPS(Reads + Writes)",
                                "Value #D": "Throughput(Read)",
                                "Value #E": "Throughput(Write)",
                                "Value #F": "Throughput(Read + Write)",
                                "pod": "Pod"
                            }
                        }
                    }
                ],
                "type": "table"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(up{job=\"kube-state-metrics\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "namespace",
                    "name": "namespace",
                    "query": "label_values(kube_namespace_status_phase{job=\"kube-state-metrics\", cluster=\"$cluster\"}, namespace)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Compute Resources / Namespace (Pods)",
        "uid": "85a562078cdf77779eaa1add43ccec1e"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-k8s-resources-node
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true,
                            "stacking": {
                                "mode": "normal"
                            }
                        }
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "max capacity"
                            },
                            "properties": [
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "red",
                                        "mode": "fixed"
                                    }
                                },
                                {
                                    "id": "custom.stacking",
                                    "value": {
                                        "mode": "none"
                                    }
                                },
                                {
                                    "id": "custom.hideFrom",
                                    "value": {
                                        "legend": false,
                                        "tooltip": true,
                                        "viz": false
                                    }
                                },
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "dash": [
                                            10,
                                            10
                                        ],
                                        "fill": "dash"
                                    }
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "max allocatable"
                            },
                            "properties": [
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "super-light-red",
                                        "mode": "fixed"
                                    }
                                },
                                {
                                    "id": "custom.stacking",
                                    "value": {
                                        "mode": "none"
                                    }
                                },
                                {
                                    "id": "custom.hideFrom",
                                    "value": {
                                        "legend": false,
                                        "tooltip": true,
                                        "viz": false
                                    }
                                },
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "dash": [
                                            10,
                                            10
                                        ],
                                        "fill": "dash"
                                    }
                                },
                                {
                                    "id": "custom.fillOpacity",
                                    "value": 0
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_node_status_capacity{cluster=\"$cluster\", job=\"kube-state-metrics\", node=~\"$node\", resource=\"cpu\"})",
                        "legendFormat": "max capacity"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_node_status_allocatable{cluster=\"$cluster\", job=\"kube-state-metrics\", node=~\"$node\", resource=\"cpu\"})",
                        "legendFormat": "max allocatable"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", node=~\"$node\"})) by (pod)",
                        "legendFormat": "{{pod}}"
                    }
                ],
                "title": "CPU Usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/%/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Pod"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to pods",
                                            "url": "/d/6581e46e4e5c7ba40a07646395ef7b23/k8s-resources-pod?${datasource:queryparam}&var-cluster=$cluster&var-namespace=$namespace&var-pod=${__data.fields.Pod}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 6
                },
                "id": 2,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", node=~\"$node\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests{cluster=\"$cluster\", node=~\"$node\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", node=~\"$node\"})) by (pod) / sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests{cluster=\"$cluster\", node=~\"$node\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_cpu:active:kube_pod_container_resource_limits{cluster=\"$cluster\", node=~\"$node\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", node=~\"$node\"})) by (pod) / sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_cpu:active:kube_pod_container_resource_limits{cluster=\"$cluster\", node=~\"$node\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "CPU Quota",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "pod",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true
                            },
                            "renameByName": {
                                "Value #A": "CPU Usage",
                                "Value #B": "CPU Requests",
                                "Value #C": "CPU Requests %",
                                "Value #D": "CPU Limits",
                                "Value #E": "CPU Limits %",
                                "pod": "Pod"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true,
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "bytes"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "max capacity"
                            },
                            "properties": [
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "red",
                                        "mode": "fixed"
                                    }
                                },
                                {
                                    "id": "custom.stacking",
                                    "value": {
                                        "mode": "none"
                                    }
                                },
                                {
                                    "id": "custom.hideFrom",
                                    "value": {
                                        "legend": false,
                                        "tooltip": true,
                                        "viz": false
                                    }
                                },
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "dash": [
                                            10,
                                            10
                                        ],
                                        "fill": "dash"
                                    }
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "max allocatable"
                            },
                            "properties": [
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "super-light-red",
                                        "mode": "fixed"
                                    }
                                },
                                {
                                    "id": "custom.stacking",
                                    "value": {
                                        "mode": "none"
                                    }
                                },
                                {
                                    "id": "custom.hideFrom",
                                    "value": {
                                        "legend": false,
                                        "tooltip": true,
                                        "viz": false
                                    }
                                },
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "dash": [
                                            10,
                                            10
                                        ],
                                        "fill": "dash"
                                    }
                                },
                                {
                                    "id": "custom.fillOpacity",
                                    "value": 0
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 12
                },
                "id": 3,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_node_status_capacity{cluster=\"$cluster\", job=\"kube-state-metrics\", node=~\"$node\", resource=\"memory\"})",
                        "legendFormat": "max capacity"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_node_status_allocatable{cluster=\"$cluster\", job=\"kube-state-metrics\", node=~\"$node\", resource=\"memory\"})",
                        "legendFormat": "max allocatable"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_memory_working_set_bytes{cluster=\"$cluster\", node=~\"$node\", container!=\"\"})) by (pod)",
                        "legendFormat": "{{pod}}"
                    }
                ],
                "title": "Memory Usage (w/cache)",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true,
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "bytes"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "max capacity"
                            },
                            "properties": [
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "red",
                                        "mode": "fixed"
                                    }
                                },
                                {
                                    "id": "custom.stacking",
                                    "value": {
                                        "mode": "none"
                                    }
                                },
                                {
                                    "id": "custom.hideFrom",
                                    "value": {
                                        "legend": false,
                                        "tooltip": true,
                                        "viz": false
                                    }
                                },
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "dash": [
                                            10,
                                            10
                                        ],
                                        "fill": "dash"
                                    }
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "max allocatable"
                            },
                            "properties": [
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "super-light-red",
                                        "mode": "fixed"
                                    }
                                },
                                {
                                    "id": "custom.stacking",
                                    "value": {
                                        "mode": "none"
                                    }
                                },
                                {
                                    "id": "custom.hideFrom",
                                    "value": {
                                        "legend": false,
                                        "tooltip": true,
                                        "viz": false
                                    }
                                },
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "dash": [
                                            10,
                                            10
                                        ],
                                        "fill": "dash"
                                    }
                                },
                                {
                                    "id": "custom.fillOpacity",
                                    "value": 0
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 18
                },
                "id": 4,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_node_status_capacity{cluster=\"$cluster\", job=\"kube-state-metrics\", node=~\"$node\", resource=\"memory\"})",
                        "legendFormat": "max capacity"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kube_node_status_allocatable{cluster=\"$cluster\", job=\"kube-state-metrics\", node=~\"$node\", resource=\"memory\"})",
                        "legendFormat": "max allocatable"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_memory_rss{cluster=\"$cluster\", node=~\"$node\", container!=\"\"})) by (pod)",
                        "legendFormat": "{{pod}}"
                    }
                ],
                "title": "Memory Usage (w/o cache)",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "bytes"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/%/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Pod"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to pods",
                                            "url": "/d/6581e46e4e5c7ba40a07646395ef7b23/k8s-resources-pod?${datasource:queryparam}&var-cluster=$cluster&var-namespace=$namespace&var-pod=${__data.fields.Pod}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 6,
                    "w": 24,
                    "x": 0,
                    "y": 24
                },
                "id": 5,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_memory_working_set_bytes{cluster=\"$cluster\", node=~\"$node\",container!=\"\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_memory:active:kube_pod_container_resource_requests{cluster=\"$cluster\", node=~\"$node\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_memory_working_set_bytes{cluster=\"$cluster\", node=~\"$node\",container!=\"\"})) by (pod) / sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_memory:active:kube_pod_container_resource_requests{cluster=\"$cluster\", node=~\"$node\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_memory:active:kube_pod_container_resource_limits{cluster=\"$cluster\", node=~\"$node\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_memory_working_set_bytes{cluster=\"$cluster\", node=~\"$node\",container!=\"\"})) by (pod) / sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_memory:active:kube_pod_container_resource_limits{cluster=\"$cluster\", node=~\"$node\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_memory_rss{cluster=\"$cluster\", node=~\"$node\",container!=\"\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_memory_cache{cluster=\"$cluster\", node=~\"$node\",container!=\"\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_memory_swap{cluster=\"$cluster\", node=~\"$node\",container!=\"\"})) by (pod)",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Memory Quota",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "pod",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true,
                                "Time 7": true,
                                "Time 8": true
                            },
                            "renameByName": {
                                "Value #A": "Memory Usage",
                                "Value #B": "Memory Requests",
                                "Value #C": "Memory Requests %",
                                "Value #D": "Memory Limits",
                                "Value #E": "Memory Limits %",
                                "Value #F": "Memory Usage (RSS)",
                                "Value #G": "Memory Usage (Cache)",
                                "Value #H": "Memory Usage (Swap)",
                                "pod": "Pod"
                            }
                        }
                    }
                ],
                "type": "table"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(up{job=\"kube-state-metrics\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "node",
                    "multi": true,
                    "name": "node",
                    "query": "label_values(kube_node_info{cluster=\"$cluster\"}, node)",
                    "refresh": 2,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Compute Resources / Node (Pods)",
        "uid": "200ac8fdbfbb74b39aff88118e4d1c2c"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-k8s-resources-pod
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        }
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byFrameRefID",
                                "options": "B"
                            },
                            "properties": [
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "fill": "dash"
                                    }
                                },
                                {
                                    "id": "custom.lineWidth",
                                    "value": 2
                                },
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "red",
                                        "mode": "fixed"
                                    }
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byFrameRefID",
                                "options": "C"
                            },
                            "properties": [
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "fill": "dash"
                                    }
                                },
                                {
                                    "id": "custom.lineWidth",
                                    "value": 2
                                },
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "orange",
                                        "mode": "fixed"
                                    }
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{namespace=\"$namespace\", pod=\"$pod\", cluster=\"$cluster\", container!=\"\"})) by (container)",
                        "legendFormat": "__auto"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    kube_pod_container_resource_requests{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", resource=\"cpu\"}\n)\n",
                        "legendFormat": "requests"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    kube_pod_container_resource_limits{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", resource=\"cpu\"}\n)\n",
                        "legendFormat": "limits"
                    }
                ],
                "title": "CPU Usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "axisColorMode": "thresholds",
                            "axisSoftMax": 1,
                            "axisSoftMin": 0,
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true,
                            "thresholdsStyle": {
                                "mode": "dashed+area"
                            }
                        },
                        "unit": "percentunit"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byFrameRefID",
                                "options": "A"
                            },
                            "properties": [
                                {
                                    "id": "thresholds",
                                    "value": {
                                        "mode": "absolute",
                                        "steps": [
                                            {
                                                "color": "green",
                                                "value": null
                                            },
                                            {
                                                "color": "red",
                                                "value": 0.25
                                            }
                                        ]
                                    }
                                },
                                {
                                    "id": "color",
                                    "value": {
                                        "mode": "thresholds",
                                        "seriesBy": "lastNotNull"
                                    }
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 7
                },
                "id": 2,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(increase(container_cpu_cfs_throttled_periods_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", namespace=\"$namespace\", pod=\"$pod\", container!=\"\", cluster=\"$cluster\"}[$__rate_interval])) by (container) /sum(increase(container_cpu_cfs_periods_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", namespace=\"$namespace\", pod=\"$pod\", container!=\"\", cluster=\"$cluster\"}[$__rate_interval])) by (container)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "CPU Throttling",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/%/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 14
                },
                "id": 3,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{namespace=\"$namespace\", pod=\"$pod\", cluster=\"$cluster\", container!=\"\"})) by (container)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests{cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", container!=\"\"})) by (container)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", container!=\"\"})) by (container) / sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests{cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", container!=\"\"})) by (container)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_cpu:active:kube_pod_container_resource_limits{cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", container!=\"\"})) by (container)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", container!=\"\"})) by (container) / sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_cpu:active:kube_pod_container_resource_limits{cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", container!=\"\"})) by (container)",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "CPU Quota",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "container",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Value #A": 6,
                                "Value #B": 7,
                                "Value #C": 8,
                                "Value #D": 9,
                                "Value #E": 10,
                                "container": 5
                            },
                            "renameByName": {
                                "Value #A": "CPU Usage",
                                "Value #B": "CPU Requests",
                                "Value #C": "CPU Requests %",
                                "Value #D": "CPU Limits",
                                "Value #E": "CPU Limits %",
                                "container": "Container"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bytes"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byFrameRefID",
                                "options": "B"
                            },
                            "properties": [
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "fill": "dash"
                                    }
                                },
                                {
                                    "id": "custom.lineWidth",
                                    "value": 2
                                },
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "red",
                                        "mode": "fixed"
                                    }
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byFrameRefID",
                                "options": "C"
                            },
                            "properties": [
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "fill": "dash"
                                    }
                                },
                                {
                                    "id": "custom.lineWidth",
                                    "value": 2
                                },
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "orange",
                                        "mode": "fixed"
                                    }
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 21
                },
                "id": 4,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", container!=\"\", image!=\"\"})) by (container)",
                        "legendFormat": "__auto"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    kube_pod_container_resource_requests{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", resource=\"memory\"}\n)\n",
                        "legendFormat": "requests"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    kube_pod_container_resource_limits{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", resource=\"memory\"}\n)\n",
                        "legendFormat": "limits"
                    }
                ],
                "title": "Memory Usage (WSS)",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "bytes"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/%/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 28
                },
                "id": 5,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", container!=\"\", image!=\"\"})) by (container)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_memory:active:kube_pod_container_resource_requests{cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"})) by (container)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", image!=\"\"})) by (container) / sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_memory:active:kube_pod_container_resource_requests{cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"})) by (container)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_memory:active:kube_pod_container_resource_limits{cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"})) by (container)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", container!=\"\", image!=\"\"})) by (container) / sum(max by (cluster, namespace, pod, container)(cluster:namespace:pod_memory:active:kube_pod_container_resource_limits{cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"})) by (container)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_rss{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", container != \"\", container != \"POD\"})) by (container)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_cache{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", container != \"\", container != \"POD\"})) by (container)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(max by (cluster, namespace, pod, container)(container_memory_swap{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\", container != \"\", container != \"POD\"})) by (container)",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Memory Quota",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "container",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true,
                                "Time 7": true,
                                "Time 8": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Time 7": 6,
                                "Time 8": 7,
                                "Value #A": 9,
                                "Value #B": 10,
                                "Value #C": 11,
                                "Value #D": 12,
                                "Value #E": 13,
                                "Value #F": 14,
                                "Value #G": 15,
                                "Value #H": 16,
                                "container": 8
                            },
                            "renameByName": {
                                "Value #A": "Memory Usage",
                                "Value #B": "Memory Requests",
                                "Value #C": "Memory Requests %",
                                "Value #D": "Memory Limits",
                                "Value #E": "Memory Limits %",
                                "Value #F": "Memory Usage (RSS)",
                                "Value #G": "Memory Usage (Cache)",
                                "Value #H": "Memory Usage (Swap)",
                                "container": "Container"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 35
                },
                "id": 6,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(irate(container_network_receive_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Receive Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 35
                },
                "id": 7,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Transmit Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 42
                },
                "id": 8,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 42
                },
                "id": 9,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 49
                },
                "id": 10,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets Dropped",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 49
                },
                "id": 11,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets Dropped",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "iops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 56
                },
                "id": 12,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "ceil(sum by(pod) (rate(container_fs_reads_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[$__rate_interval])))",
                        "legendFormat": "Reads"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "ceil(sum by(pod) (rate(container_fs_writes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\",namespace=\"$namespace\", pod=~\"$pod\"}[$__rate_interval])))",
                        "legendFormat": "Writes"
                    }
                ],
                "title": "IOPS (Pod)",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "Bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 56
                },
                "id": 13,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(pod) (rate(container_fs_reads_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[$__rate_interval]))",
                        "legendFormat": "Reads"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(pod) (rate(container_fs_writes_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"$pod\"}[$__rate_interval]))",
                        "legendFormat": "Writes"
                    }
                ],
                "title": "ThroughPut (Pod)",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "iops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 63
                },
                "id": 14,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "ceil(sum by(container) (rate(container_fs_reads_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"}[$__rate_interval]) + rate(container_fs_writes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"}[$__rate_interval])))",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "IOPS (Containers)",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "Bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 63
                },
                "id": 15,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(container) (rate(container_fs_reads_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"}[$__rate_interval]) + rate(container_fs_writes_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"}[$__rate_interval]))",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "ThroughPut (Containers)",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/IOPS/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "iops"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Throughput/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "Bps"
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 70
                },
                "id": 16,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(container) (rate(container_fs_reads_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(container) (rate(container_fs_writes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\",device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(container) (rate(container_fs_reads_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"}[$__rate_interval]) + rate(container_fs_writes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(container) (rate(container_fs_reads_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(container) (rate(container_fs_writes_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by(container) (rate(container_fs_reads_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"}[$__rate_interval]) + rate(container_fs_writes_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\", container!=\"\", cluster=\"$cluster\", namespace=\"$namespace\", pod=\"$pod\"}[$__rate_interval]))",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Current Storage IO",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "container",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Value #A": 7,
                                "Value #B": 8,
                                "Value #C": 9,
                                "Value #D": 10,
                                "Value #E": 11,
                                "Value #F": 12,
                                "container": 6
                            },
                            "renameByName": {
                                "Value #A": "IOPS(Reads)",
                                "Value #B": "IOPS(Writes)",
                                "Value #C": "IOPS(Reads + Writes)",
                                "Value #D": "Throughput(Read)",
                                "Value #E": "Throughput(Write)",
                                "Value #F": "Throughput(Read + Write)",
                                "container": "Container"
                            }
                        }
                    }
                ],
                "type": "table"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(up{job=\"kube-state-metrics\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "namespace",
                    "name": "namespace",
                    "query": "label_values(kube_namespace_status_phase{job=\"kube-state-metrics\", cluster=\"$cluster\"}, namespace)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "pod",
                    "name": "pod",
                    "query": "label_values(kube_pod_info{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\"}, pod)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Compute Resources / Pod",
        "uid": "6581e46e4e5c7ba40a07646395ef7b23"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-k8s-resources-workload
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        }
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "CPU Usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/%/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Pod"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to pods",
                                            "url": "/d/6581e46e4e5c7ba40a07646395ef7b23/k8s-resources-pod?${datasource:queryparam}&var-cluster=$cluster&var-namespace=$namespace&var-pod=${__data.fields.Pod}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 7
                },
                "id": 2,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(kube_pod_container_resource_requests{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"cpu\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n/sum(\n    max by (cluster, namespace, pod, container)(kube_pod_container_resource_requests{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"cpu\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(kube_pod_container_resource_limits{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"cpu\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n/sum(\n    max by (cluster, namespace, pod, container)(kube_pod_container_resource_limits{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"cpu\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "CPU Quota",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "pod",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Value #A": 6,
                                "Value #B": 7,
                                "Value #C": 8,
                                "Value #D": 9,
                                "Value #E": 10,
                                "pod": 5
                            },
                            "renameByName": {
                                "Value #A": "CPU Usage",
                                "Value #B": "CPU Requests",
                                "Value #C": "CPU Requests %",
                                "Value #D": "CPU Limits",
                                "Value #E": "CPU Limits %",
                                "pod": "Pod"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bytes"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 14
                },
                "id": 3,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{cluster=\"$cluster\", namespace=\"$namespace\", container!=\"\", image!=\"\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Memory Usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "bytes"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/%/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Pod"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to pods",
                                            "url": "/d/6581e46e4e5c7ba40a07646395ef7b23/k8s-resources-pod?${datasource:queryparam}&var-cluster=$cluster&var-namespace=$namespace&var-pod=${__data.fields.Pod}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 21
                },
                "id": 4,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{cluster=\"$cluster\", namespace=\"$namespace\", container!=\"\", image!=\"\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(kube_pod_container_resource_requests{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"memory\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{cluster=\"$cluster\", namespace=\"$namespace\", container!=\"\", image!=\"\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n/sum(\n    max by (cluster, namespace, pod, container)(kube_pod_container_resource_requests{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"memory\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(kube_pod_container_resource_limits{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"memory\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{cluster=\"$cluster\", namespace=\"$namespace\", container!=\"\", image!=\"\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n/sum(\n    max by (cluster, namespace, pod, container)(kube_pod_container_resource_limits{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"memory\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}\n) by (pod)\n",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Memory Quota",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "pod",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Value #A": 9,
                                "Value #B": 10,
                                "Value #C": 11,
                                "Value #D": 12,
                                "Value #E": 13,
                                "pod": 8
                            },
                            "renameByName": {
                                "Value #A": "Memory Usage",
                                "Value #B": "Memory Requests",
                                "Value #C": "Memory Requests %",
                                "Value #D": "Memory Limits",
                                "Value #E": "Memory Limits %",
                                "pod": "Pod"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Bandwidth/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "bps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Packets/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "pps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Pod"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to pods",
                                            "url": "/d/6581e46e4e5c7ba40a07646395ef7b23/k8s-resources-pod?${datasource:queryparam}&var-cluster=$cluster&var-namespace=$namespace&var-pod=${__data.fields.Pod}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 28
                },
                "id": 5,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_receive_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_transmit_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_receive_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_transmit_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_receive_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_transmit_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Current Network Usage",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "pod",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Value #A": 7,
                                "Value #B": 8,
                                "Value #C": 9,
                                "Value #D": 10,
                                "Value #E": 11,
                                "Value #F": 12,
                                "pod": 6
                            },
                            "renameByName": {
                                "Value #A": "Current Receive Bandwidth",
                                "Value #B": "Current Transmit Bandwidth",
                                "Value #C": "Rate of Received Packets",
                                "Value #D": "Rate of Transmitted Packets",
                                "Value #E": "Rate of Received Packets Dropped",
                                "Value #F": "Rate of Transmitted Packets Dropped",
                                "pod": "Pod"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 35
                },
                "id": 6,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_receive_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Receive Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 35
                },
                "id": 7,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_transmit_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Transmit Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 42
                },
                "id": 8,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(avg(rate(container_network_receive_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Average Container Bandwidth by Pod: Received",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 42
                },
                "id": 9,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(avg(rate(container_network_transmit_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Average Container Bandwidth by Pod: Transmitted",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 49
                },
                "id": 10,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_receive_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 49
                },
                "id": 11,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_transmit_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 56
                },
                "id": 12,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_receive_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets Dropped",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 56
                },
                "id": 13,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_transmit_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets Dropped",
                "type": "timeseries"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(up{job=\"kube-state-metrics\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "namespace",
                    "name": "namespace",
                    "query": "label_values(kube_namespace_status_phase{job=\"kube-state-metrics\", cluster=\"$cluster\"}, namespace)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "includeAll": true,
                    "label": "workload_type",
                    "name": "type",
                    "query": "label_values(namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\"}, workload_type)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "includeAll": true,
                    "label": "workload",
                    "name": "workload",
                    "query": "label_values(namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}, workload)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Compute Resources / Workload",
        "uid": "a164a7f0339f99e89cea5cb47e9be617"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-k8s-resources-workloads-namespace
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        }
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byFrameRefID",
                                "options": "B"
                            },
                            "properties": [
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "fill": "dash"
                                    }
                                },
                                {
                                    "id": "custom.lineWidth",
                                    "value": 2
                                },
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "red",
                                        "mode": "fixed"
                                    }
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byFrameRefID",
                                "options": "C"
                            },
                            "properties": [
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "fill": "dash"
                                    }
                                },
                                {
                                    "id": "custom.lineWidth",
                                    "value": 2
                                },
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "orange",
                                        "mode": "fixed"
                                    }
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n  max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\"})\n* on(cluster, namespace, pod)\n  group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n",
                        "legendFormat": "{{workload}} - {{workload_type}}"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "scalar(max(kube_resourcequota{cluster=\"$cluster\", namespace=\"$namespace\", type=\"hard\",resource=~\"requests.cpu|cpu\"}))",
                        "legendFormat": "quota - requests"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "scalar(max(kube_resourcequota{cluster=\"$cluster\", namespace=\"$namespace\", type=\"hard\",resource=~\"limits.cpu\"}))",
                        "legendFormat": "quota - limits"
                    }
                ],
                "title": "CPU Usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/%/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Workload"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to workloads",
                                            "url": "/d/a164a7f0339f99e89cea5cb47e9be617/k8s-resources-workload?${datasource:queryparam}&var-cluster=$cluster&var-namespace=$namespace&var-type=${__data.fields.Type}&var-workload=${__data.fields.Workload}"
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Running Pods"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "none"
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 7
                },
                "id": 2,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "count(namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}) by (workload, workload_type)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n  max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\"})\n* on(cluster, namespace, pod)\n  group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n  max by (cluster, namespace, pod, container)(kube_pod_container_resource_requests{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"cpu\"})\n* on(cluster, namespace, pod)\n  group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n  max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\"})\n* on(cluster, namespace, pod)\n  group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n/sum(\n  max by (cluster, namespace, pod, container)(kube_pod_container_resource_requests{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"cpu\"})\n* on(cluster, namespace, pod)\n  group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n  max by (cluster, namespace, pod, container)(kube_pod_container_resource_limits{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"cpu\"})\n* on(cluster, namespace, pod)\n  group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n  max by (cluster, namespace, pod, container)(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate5m{cluster=\"$cluster\", namespace=\"$namespace\"})\n* on(cluster, namespace, pod)\n  group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n/sum(\n  max by (cluster, namespace, pod, container)(kube_pod_container_resource_limits{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"cpu\"})\n* on(cluster, namespace, pod)\n  group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "CPU Quota",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "workload",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true,
                                "workload_type 2": true,
                                "workload_type 3": true,
                                "workload_type 4": true,
                                "workload_type 5": true,
                                "workload_type 6": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Value #A": 8,
                                "Value #B": 9,
                                "Value #C": 10,
                                "Value #D": 11,
                                "Value #E": 12,
                                "Value #F": 13,
                                "workload": 6,
                                "workload_type 1": 7,
                                "workload_type 2": 14,
                                "workload_type 3": 15,
                                "workload_type 4": 16,
                                "workload_type 5": 17,
                                "workload_type 6": 18
                            },
                            "renameByName": {
                                "Value #A": "Running Pods",
                                "Value #B": "CPU Usage",
                                "Value #C": "CPU Requests",
                                "Value #D": "CPU Requests %",
                                "Value #E": "CPU Limits",
                                "Value #F": "CPU Limits %",
                                "workload": "Workload",
                                "workload_type 1": "Type"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bytes"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byFrameRefID",
                                "options": "B"
                            },
                            "properties": [
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "fill": "dash"
                                    }
                                },
                                {
                                    "id": "custom.lineWidth",
                                    "value": 2
                                },
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "red",
                                        "mode": "fixed"
                                    }
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byFrameRefID",
                                "options": "C"
                            },
                            "properties": [
                                {
                                    "id": "custom.lineStyle",
                                    "value": {
                                        "fill": "dash"
                                    }
                                },
                                {
                                    "id": "custom.lineWidth",
                                    "value": 2
                                },
                                {
                                    "id": "color",
                                    "value": {
                                        "fixedColor": "orange",
                                        "mode": "fixed"
                                    }
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 14
                },
                "id": 3,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", container!=\"\", image!=\"\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n",
                        "legendFormat": "{{workload}} - {{workload_type}}"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "scalar(max(kube_resourcequota{cluster=\"$cluster\", namespace=\"$namespace\", type=\"hard\",resource=~\"requests.memory|memory\"}))",
                        "legendFormat": "quota - requests"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "scalar(max(kube_resourcequota{cluster=\"$cluster\", namespace=\"$namespace\", type=\"hard\",resource=~\"limits.memory\"}))",
                        "legendFormat": "quota - limits"
                    }
                ],
                "title": "Memory Usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "bytes"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/%/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Workload"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to workloads",
                                            "url": "/d/a164a7f0339f99e89cea5cb47e9be617/k8s-resources-workload?${datasource:queryparam}&var-cluster=$cluster&var-namespace=$namespace&var-type=${__data.fields.Type}&var-workload=${__data.fields.Workload}"
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Running Pods"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "none"
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 21
                },
                "id": 4,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "count(namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}) by (workload, workload_type)",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", container!=\"\", image!=\"\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n  max by (cluster, namespace, pod, container)(kube_pod_container_resource_requests{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"memory\"})\n* on(cluster, namespace, pod)\n  group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", container!=\"\", image!=\"\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n/sum(\n  max by (cluster, namespace, pod, container)(kube_pod_container_resource_requests{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"memory\"})\n* on(cluster, namespace, pod)\n  group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n  max by (cluster, namespace, pod, container)(kube_pod_container_resource_limits{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"memory\"})\n* on(cluster, namespace, pod)\n  group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(\n    max by (cluster, namespace, pod, container)(container_memory_working_set_bytes{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\", container!=\"\", image!=\"\"})\n  * on(cluster, namespace, pod)\n    group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n/sum(\n  max by (cluster, namespace, pod, container)(kube_pod_container_resource_limits{job=\"kube-state-metrics\", cluster=\"$cluster\", namespace=\"$namespace\", resource=\"memory\"})\n* on(cluster, namespace, pod)\n  group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}\n) by (workload, workload_type)\n",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Memory Quota",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "workload",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true,
                                "workload_type 2": true,
                                "workload_type 3": true,
                                "workload_type 4": true,
                                "workload_type 5": true,
                                "workload_type 6": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Value #A": 8,
                                "Value #B": 9,
                                "Value #C": 10,
                                "Value #D": 11,
                                "Value #E": 12,
                                "Value #F": 13,
                                "workload": 6,
                                "workload_type 1": 7,
                                "workload_type 2": 14,
                                "workload_type 3": 15,
                                "workload_type 4": 16,
                                "workload_type 5": 17,
                                "workload_type 6": 18
                            },
                            "renameByName": {
                                "Value #A": "Running Pods",
                                "Value #B": "Memory Usage",
                                "Value #C": "Memory Requests",
                                "Value #D": "Memory Requests %",
                                "Value #E": "Memory Limits",
                                "Value #F": "Memory Limits %",
                                "workload": "Workload",
                                "workload_type 1": "Type"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Bandwidth/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "bps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Packets/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "pps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Workload"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down to workloads",
                                            "url": "/d/a164a7f0339f99e89cea5cb47e9be617/k8s-resources-workload?${datasource:queryparam}&var-cluster=$cluster&var-namespace=$namespace&var-type=${__data.fields.Type}&var-workload=${__data.fields.Workload}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 28
                },
                "id": 5,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_receive_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}) by (workload))\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_transmit_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}) by (workload))\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_receive_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}) by (workload))\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_transmit_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}) by (workload))\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_receive_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}) by (workload))\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_transmit_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload_type=~\"$type\"}) by (workload))\n",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Current Network Usage",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "workload",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Value #A": 7,
                                "Value #B": 8,
                                "Value #C": 9,
                                "Value #D": 10,
                                "Value #E": 11,
                                "Value #F": 12,
                                "workload": 6
                            },
                            "renameByName": {
                                "Value #A": "Current Receive Bandwidth",
                                "Value #B": "Current Transmit Bandwidth",
                                "Value #C": "Rate of Received Packets",
                                "Value #D": "Rate of Transmitted Packets",
                                "Value #E": "Rate of Received Packets Dropped",
                                "Value #F": "Rate of Transmitted Packets Dropped",
                                "workload": "Workload"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 35
                },
                "id": 6,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_receive_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Receive Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 35
                },
                "id": 7,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_transmit_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Transmit Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 42
                },
                "id": 8,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(avg(rate(container_network_receive_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Average Container Bandwidth by Workload: Received",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 42
                },
                "id": 9,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(avg(rate(container_network_transmit_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Average Container Bandwidth by Workload: Transmitted",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 49
                },
                "id": 10,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_receive_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 49
                },
                "id": 11,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_transmit_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 56
                },
                "id": 12,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_receive_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets Dropped",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 56
                },
                "id": 13,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(sum(rate(container_network_transmit_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets Dropped",
                "type": "timeseries"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(up{job=\"kube-state-metrics\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "namespace",
                    "name": "namespace",
                    "query": "label_values(kube_namespace_status_phase{job=\"kube-state-metrics\", cluster=\"$cluster\"}, namespace)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "includeAll": true,
                    "label": "workload_type",
                    "name": "type",
                    "query": "label_values(namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\".+\"}, workload_type)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Compute Resources / Namespace (Workloads)",
        "uid": "a87fb0d919ec0ea5f6543124e16c42a5"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-kubelet
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "none"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 4,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kubelet_node_name{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\"})",
                        "instant": true
                    }
                ],
                "title": "Running Kubelets",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "none"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 4,
                    "x": 4,
                    "y": 0
                },
                "id": 2,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kubelet_running_pods{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", instance=~\"$instance\"})",
                        "instant": true
                    }
                ],
                "title": "Running Pods",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "none"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 4,
                    "x": 8,
                    "y": 0
                },
                "id": 3,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(kubelet_running_containers{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", instance=~\"$instance\"})",
                        "instant": true
                    }
                ],
                "title": "Running Containers",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "none"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 4,
                    "x": 12,
                    "y": 0
                },
                "id": 4,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(volume_manager_total_volumes{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", instance=~\"$instance\", state=\"actual_state_of_world\"})",
                        "instant": true
                    }
                ],
                "title": "Actual Volume Count",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "none"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 4,
                    "x": 16,
                    "y": 0
                },
                "id": 5,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(volume_manager_total_volumes{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", instance=~\"$instance\",state=\"desired_state_of_world\"})",
                        "instant": true
                    }
                ],
                "title": "Desired Volume Count",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "none"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 4,
                    "x": 20,
                    "y": 0
                },
                "id": 6,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(kubelet_node_config_error{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", instance=~\"$instance\"}[$__rate_interval]))",
                        "instant": true
                    }
                ],
                "title": "Config Error Count",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 7
                },
                "id": 7,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(kubelet_runtime_operations_total{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\",instance=~\"$instance\"}[$__rate_interval])) by (operation_type, instance)",
                        "legendFormat": "{{instance}} {{operation_type}}"
                    }
                ],
                "title": "Operation Rate",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 7
                },
                "id": 8,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(kubelet_runtime_operations_errors_total{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\",instance=~\"$instance\"}[$__rate_interval])) by (instance, operation_type)",
                        "legendFormat": "{{instance}} {{operation_type}}"
                    }
                ],
                "title": "Operation Error Rate",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 14
                },
                "id": 9,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(kubelet_runtime_operations_duration_seconds_bucket{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\",instance=~\"$instance\"}[$__rate_interval])) by (instance, operation_type, le))",
                        "legendFormat": "{{instance}} {{operation_type}}"
                    }
                ],
                "title": "Operation Duration 99th quantile",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 21
                },
                "id": 10,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(kubelet_pod_start_duration_seconds_count{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\",instance=~\"$instance\"}[$__rate_interval])) by (instance)",
                        "legendFormat": "{{instance}} pod"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(kubelet_pod_worker_duration_seconds_count{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\",instance=~\"$instance\"}[$__rate_interval])) by (instance)",
                        "legendFormat": "{{instance}} worker"
                    }
                ],
                "title": "Pod Start Rate",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 21
                },
                "id": 11,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(kubelet_pod_start_duration_seconds_bucket{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\",instance=~\"$instance\"}[$__rate_interval])) by (instance, le))",
                        "legendFormat": "{{instance}} pod"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(kubelet_pod_worker_duration_seconds_bucket{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\",instance=~\"$instance\"}[$__rate_interval])) by (instance, le))",
                        "legendFormat": "{{instance}} worker"
                    }
                ],
                "title": "Pod Start Duration",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 28
                },
                "id": 12,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(storage_operation_duration_seconds_count{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\",instance=~\"$instance\"}[$__rate_interval])) by (instance, operation_name, volume_plugin)",
                        "legendFormat": "{{instance}} {{operation_name}} {{volume_plugin}}"
                    }
                ],
                "title": "Storage Operation Rate",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 28
                },
                "id": 13,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(storage_operation_errors_total{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\",instance=~\"$instance\"}[$__rate_interval])) by (instance, operation_name, volume_plugin)",
                        "legendFormat": "{{instance}} {{operation_name}} {{volume_plugin}}"
                    }
                ],
                "title": "Storage Operation Error Rate",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 35
                },
                "id": 14,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(storage_operation_duration_seconds_bucket{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", instance=~\"$instance\"}[$__rate_interval])) by (instance, operation_name, volume_plugin, le))",
                        "legendFormat": "{{instance}} {{operation_name}} {{volume_plugin}}"
                    }
                ],
                "title": "Storage Operation Duration 99th quantile",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 42
                },
                "id": 15,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(kubelet_cgroup_manager_duration_seconds_count{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", instance=~\"$instance\"}[$__rate_interval])) by (instance, operation_type)",
                        "legendFormat": "{{operation_type}}"
                    }
                ],
                "title": "Cgroup manager operation rate",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 42
                },
                "id": 16,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(kubelet_cgroup_manager_duration_seconds_bucket{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", instance=~\"$instance\"}[$__rate_interval])) by (instance, operation_type, le))",
                        "legendFormat": "{{instance}} {{operation_type}}"
                    }
                ],
                "title": "Cgroup manager 99th quantile",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 49
                },
                "id": 17,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(kubelet_pleg_relist_duration_seconds_count{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", instance=~\"$instance\"}[$__rate_interval])) by (instance)",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "PLEG relist rate",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 49
                },
                "id": 18,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(kubelet_pleg_relist_interval_seconds_bucket{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\",instance=~\"$instance\"}[$__rate_interval])) by (instance, le))",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "PLEG relist interval",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 56
                },
                "id": 19,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(kubelet_pleg_relist_duration_seconds_bucket{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\",instance=~\"$instance\"}[$__rate_interval])) by (instance, le))",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "PLEG relist duration",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 63
                },
                "id": 20,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(rest_client_requests_total{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\", instance=~\"$instance\",code=~\"2..\"}[$__rate_interval]))",
                        "legendFormat": "2xx"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(rest_client_requests_total{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\", instance=~\"$instance\",code=~\"3..\"}[$__rate_interval]))",
                        "legendFormat": "3xx"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(rest_client_requests_total{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\", instance=~\"$instance\",code=~\"4..\"}[$__rate_interval]))",
                        "legendFormat": "4xx"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(rest_client_requests_total{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\", instance=~\"$instance\",code=~\"5..\"}[$__rate_interval]))",
                        "legendFormat": "5xx"
                    }
                ],
                "title": "RPC rate",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 70
                },
                "id": 21,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(rest_client_request_duration_seconds_bucket{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\", instance=~\"$instance\"}[$__rate_interval])) by (instance, verb, le))",
                        "legendFormat": "{{instance}} {{verb}}"
                    }
                ],
                "title": "Request duration 99th quantile",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bytes"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 0,
                    "y": 77
                },
                "id": 22,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "process_resident_memory_bytes{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\",instance=~\"$instance\"}",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "Memory",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 8,
                    "y": 77
                },
                "id": 23,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "rate(process_cpu_seconds_total{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\",instance=~\"$instance\"}[$__rate_interval])",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "CPU usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 16,
                    "y": 77
                },
                "id": 24,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "go_goroutines{cluster=\"$cluster\",job=\"kubelet\", metrics_path=\"/metrics\",instance=~\"$instance\"}",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "Goroutines",
                "type": "timeseries"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(up{job=\"kubelet\", metrics_path=\"/metrics\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "includeAll": true,
                    "label": "instance",
                    "name": "instance",
                    "query": "label_values(up{job=\"kubelet\", metrics_path=\"/metrics\",cluster=\"$cluster\"}, instance)",
                    "refresh": 2,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Kubelet",
        "uid": "3138fa155d5915769fbded898ac09fd9"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-loki-chunks
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Loki"
  resyncPeriod: 24h
  json: |
    {
      "annotations": {
        "list": []
      },
      "editable": true,
      "gnetId": null,
      "graphTooltip": 0,
      "hideControls": false,
      "links": [
        {
          "asDropdown": true,
          "icon": "external link",
          "includeVars": true,
          "keepTime": true,
          "tags": [
            "loki"
          ],
          "targetBlank": false,
          "title": "Loki Dashboards",
          "type": "dashboards"
        }
      ],
      "refresh": "10s",
      "rows": [
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 1,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "sum(loki_ingester_memory_chunks{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"})",
                  "format": "time_series",
                  "legendFormat": "series",
                  "legendLink": null
                }
              ],
              "title": "Series",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 2,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "sum(loki_ingester_memory_chunks{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}) / sum(loki_ingester_memory_streams{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"})",
                  "format": "time_series",
                  "legendFormat": "chunks",
                  "legendLink": null
                }
              ],
              "title": "Chunks per series",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Active Series / Chunks",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "percentunit"
                },
                "overrides": []
              },
              "id": 3,
              "links": [],
              "nullPointMode": "null as zero",
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "histogram_quantile(0.99, sum(rate(loki_ingester_chunk_utilization_bucket{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) by (le)) * 1",
                  "format": "time_series",
                  "legendFormat": "99th Percentile",
                  "refId": "A"
                },
                {
                  "expr": "histogram_quantile(0.50, sum(rate(loki_ingester_chunk_utilization_bucket{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) by (le)) * 1",
                  "format": "time_series",
                  "legendFormat": "50th Percentile",
                  "refId": "B"
                },
                {
                  "expr": "sum(rate(loki_ingester_chunk_utilization_sum{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) * 1 / sum(rate(loki_ingester_chunk_utilization_count{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "Average",
                  "refId": "C"
                }
              ],
              "title": "Utilization",
              "type": "timeseries",
              "yaxes": [
                {
                  "format": "ms",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": false
                }
              ]
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 4,
              "links": [],
              "nullPointMode": "null as zero",
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "histogram_quantile(0.99, sum(rate(loki_ingester_chunk_age_seconds_bucket{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) by (le)) * 1e3",
                  "format": "time_series",
                  "legendFormat": "99th Percentile",
                  "refId": "A"
                },
                {
                  "expr": "histogram_quantile(0.50, sum(rate(loki_ingester_chunk_age_seconds_bucket{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) by (le)) * 1e3",
                  "format": "time_series",
                  "legendFormat": "50th Percentile",
                  "refId": "B"
                },
                {
                  "expr": "sum(rate(loki_ingester_chunk_age_seconds_sum{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) * 1e3 / sum(rate(loki_ingester_chunk_age_seconds_count{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "Average",
                  "refId": "C"
                }
              ],
              "title": "Age",
              "type": "timeseries",
              "yaxes": [
                {
                  "format": "ms",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": false
                }
              ]
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Flush Stats",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 5,
              "links": [],
              "nullPointMode": "null as zero",
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "histogram_quantile(0.99, sum(rate(loki_ingester_chunk_entries_bucket{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) by (le)) * 1",
                  "format": "time_series",
                  "legendFormat": "99th Percentile",
                  "refId": "A"
                },
                {
                  "expr": "histogram_quantile(0.50, sum(rate(loki_ingester_chunk_entries_bucket{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) by (le)) * 1",
                  "format": "time_series",
                  "legendFormat": "50th Percentile",
                  "refId": "B"
                },
                {
                  "expr": "sum(rate(loki_ingester_chunk_entries_sum{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) * 1 / sum(rate(loki_ingester_chunk_entries_count{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "Average",
                  "refId": "C"
                }
              ],
              "title": "Log Entries Per Chunk",
              "type": "timeseries",
              "yaxes": [
                {
                  "format": "ms",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": false
                }
              ]
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 6,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "sum(rate(loki_chunk_store_index_entries_per_chunk_sum{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) / sum(rate(loki_chunk_store_index_entries_per_chunk_count{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "Index Entries",
                  "legendLink": null
                }
              ],
              "title": "Index Entries Per Chunk",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Flush Stats",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 7,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "loki_ingester_flush_queue_length{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"} or cortex_ingester_flush_queue_length{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                }
              ],
              "title": "Queue Length",
              "type": "timeseries"
            },
            {
              "aliasColors": {
                "1xx": "#EAB839",
                "2xx": "#7EB26D",
                "3xx": "#6ED0E0",
                "4xx": "#EF843C",
                "5xx": "#E24D42",
                "OK": "#7EB26D",
                "cancel": "#A9A9A9",
                "error": "#E24D42",
                "success": "#7EB26D"
              },
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 100,
                    "lineWidth": 0,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "normal"
                    }
                  },
                  "min": 0,
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": [
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "1xx"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#EAB839",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "2xx"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#7EB26D",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "3xx"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#6ED0E0",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "4xx"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#EF843C",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "5xx"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#E24D42",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "OK"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#7EB26D",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "cancel"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#A9A9A9",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "error"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#E24D42",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "success"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#7EB26D",
                          "mode": "fixed"
                        }
                      }
                    ]
                  }
                ]
              },
              "fill": 10,
              "id": 8,
              "linewidth": 0,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "stack": true,
              "targets": [
                {
                  "expr": "sum by (status) (\n  label_replace(label_replace(rate(loki_ingester_chunk_age_seconds_count{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval]),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n  \"status\", \"${1}\", \"status_code\", \"([a-zA-Z_]+)\"))\n",
                  "format": "time_series",
                  "legendFormat": "{{status}}",
                  "refId": "A"
                }
              ],
              "title": "Flush Rate",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Flush Stats",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 9,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "sum(rate(loki_ingester_chunks_flushed_total{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                }
              ],
              "title": "Chunks Flushed/Second",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 10,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "stack": true,
              "targets": [
                {
                  "expr": "sum by (reason) (rate(loki_ingester_chunks_flushed_total{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) / ignoring(reason) group_left sum(rate(loki_ingester_chunks_flushed_total{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "{{reason}}",
                  "legendLink": null
                }
              ],
              "title": "Chunk Flush Reason",
              "type": "timeseries",
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": 1,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": 1,
                  "min": null,
                  "show": false
                }
              ]
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Flush Stats",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "cards": {
                "cardPadding": null,
                "cardRound": null
              },
              "color": {
                "cardColor": "#b4ff00",
                "colorScale": "sqrt",
                "colorScheme": "interpolateSpectral",
                "exponent": 0.5,
                "mode": "spectrum"
              },
              "dataFormat": "tsbuckets",
              "datasource": "$datasource",
              "heatmap": {},
              "hideZeroBuckets": false,
              "highlightCards": true,
              "id": 11,
              "legend": {
                "show": true
              },
              "span": 12,
              "targets": [
                {
                  "expr": "sum by (le) (rate(loki_ingester_chunk_utilization_bucket{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval]))",
                  "format": "heatmap",
                  "intervalFactor": 2,
                  "legendFormat": "{{le}}",
                  "refId": "A"
                }
              ],
              "title": "Chunk Utilization",
              "tooltip": {
                "show": true,
                "showHistogram": true
              },
              "type": "heatmap",
              "xAxis": {
                "show": true
              },
              "xBucketNumber": null,
              "xBucketSize": null,
              "yAxis": {
                "decimals": 0,
                "format": "percentunit",
                "show": true,
                "splitFactor": null
              },
              "yBucketBound": "auto"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Utilization",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "cards": {
                "cardPadding": null,
                "cardRound": null
              },
              "color": {
                "cardColor": "#b4ff00",
                "colorScale": "sqrt",
                "colorScheme": "interpolateSpectral",
                "exponent": 0.5,
                "mode": "spectrum"
              },
              "dataFormat": "tsbuckets",
              "datasource": "$datasource",
              "heatmap": {},
              "hideZeroBuckets": false,
              "highlightCards": true,
              "id": 12,
              "legend": {
                "show": true
              },
              "span": 12,
              "targets": [
                {
                  "expr": "sum(rate(loki_ingester_chunk_size_bytes_bucket{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) by (le)",
                  "format": "heatmap",
                  "intervalFactor": 2,
                  "legendFormat": "{{le}}",
                  "refId": "A"
                }
              ],
              "title": "Chunk Size Bytes",
              "tooltip": {
                "show": true,
                "showHistogram": true
              },
              "type": "heatmap",
              "xAxis": {
                "show": true
              },
              "xBucketNumber": null,
              "xBucketSize": null,
              "yAxis": {
                "decimals": 0,
                "format": "bytes",
                "show": true,
                "splitFactor": null
              },
              "yBucketBound": "auto"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Utilization",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "bytes"
                },
                "overrides": []
              },
              "id": 13,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 12,
              "targets": [
                {
                  "expr": "histogram_quantile(0.99, sum(rate(loki_ingester_chunk_size_bytes_bucket{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) by (le))",
                  "format": "time_series",
                  "legendFormat": "p99",
                  "legendLink": null
                },
                {
                  "expr": "histogram_quantile(0.90, sum(rate(loki_ingester_chunk_size_bytes_bucket{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) by (le))",
                  "format": "time_series",
                  "legendFormat": "p90",
                  "legendLink": null
                },
                {
                  "expr": "histogram_quantile(0.50, sum(rate(loki_ingester_chunk_size_bytes_bucket{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) by (le))",
                  "format": "time_series",
                  "legendFormat": "p50",
                  "legendLink": null
                }
              ],
              "title": "Chunk Size Quantiles",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Utilization",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 14,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 12,
              "targets": [
                {
                  "expr": "histogram_quantile(0.5, sum(rate(loki_ingester_chunk_bounds_hours_bucket{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) by (le))",
                  "format": "time_series",
                  "legendFormat": "p50",
                  "legendLink": null
                },
                {
                  "expr": "histogram_quantile(0.99, sum(rate(loki_ingester_chunk_bounds_hours_bucket{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) by (le))",
                  "format": "time_series",
                  "legendFormat": "p99",
                  "legendLink": null
                },
                {
                  "expr": "sum(rate(loki_ingester_chunk_bounds_hours_sum{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval])) / sum(rate(loki_ingester_chunk_bounds_hours_count{cluster=\"$cluster\", job=~\"$namespace/loki.*-write\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "avg",
                  "legendLink": null
                }
              ],
              "title": "Chunk Duration hours (end-start)",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Duration",
          "titleSize": "h6"
        }
      ],
      "schemaVersion": 14,
      "style": "dark",
      "tags": [
        "loki"
      ],
      "templating": {
        "list": [
          {
            "current": {
              "text": "default",
              "value": "default"
            },
            "hide": 0,
            "label": "Data source",
            "name": "datasource",
            "options": [],
            "query": "prometheus",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "cluster",
            "multi": false,
            "name": "cluster",
            "options": [],
            "query": "label_values(loki_build_info, cluster)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "namespace",
            "multi": false,
            "name": "namespace",
            "options": [],
            "query": "label_values(loki_build_info{cluster=~\"$cluster\"}, namespace)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          }
        ]
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "utc",
      "title": "Loki / Chunks",
      "uid": "chunks",
      "version": 0
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-loki-deletion
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Loki"
  resyncPeriod: 24h
  json: |
    {
      "annotations": {
        "list": []
      },
      "editable": true,
      "gnetId": null,
      "graphTooltip": 0,
      "hideControls": false,
      "links": [
        {
          "asDropdown": true,
          "icon": "external link",
          "includeVars": true,
          "keepTime": true,
          "tags": [
            "loki"
          ],
          "targetBlank": false,
          "title": "Loki Dashboards",
          "type": "dashboards"
        }
      ],
      "refresh": "10s",
      "rows": [
        {
          "collapse": false,
          "height": "100px",
          "panels": [
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "format": "none",
              "id": 1,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": true,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null as zero",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 6,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(loki_compactor_pending_delete_requests_count{cluster=~\"$cluster\", namespace=~\"$namespace\"})",
                  "format": "time_series",
                  "instant": true,
                  "refId": "A"
                }
              ],
              "thresholds": "70,80",
              "timeFrom": null,
              "timeShift": null,
              "title": "Number of Pending Requests",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "singlestat",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": false
                }
              ]
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "format": "dtdurations",
              "id": 2,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": true,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null as zero",
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 6,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "max(loki_compactor_oldest_pending_delete_request_age_seconds{cluster=~\"$cluster\", namespace=~\"$namespace\"})",
                  "format": "time_series",
                  "instant": true,
                  "refId": "A"
                }
              ],
              "thresholds": "70,80",
              "timeFrom": null,
              "timeShift": null,
              "title": "Oldest Pending Request Age",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "singlestat",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": false
                }
              ]
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": false,
          "title": "Headlines",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 3,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "(loki_compactor_delete_requests_received_total{cluster=~\"$cluster\", namespace=~\"$namespace\"} or on() vector(0)) - on () (loki_compactor_delete_requests_processed_total{cluster=~\"$cluster\", namespace=~\"$namespace\"} or on () vector(0))",
                  "format": "time_series",
                  "legendFormat": "in progress",
                  "legendLink": null
                }
              ],
              "title": "# of Delete Requests (received - processed) ",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 4,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum(increase(loki_compactor_delete_requests_received_total{cluster=~\"$cluster\", namespace=~\"$namespace\"}[1d]))",
                  "format": "time_series",
                  "legendFormat": "received",
                  "legendLink": null
                }
              ],
              "title": "Delete Requests Received / Day",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 5,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum(increase(loki_compactor_delete_requests_processed_total{cluster=~\"$cluster\", namespace=~\"$namespace\"}[1d]))",
                  "format": "time_series",
                  "legendFormat": "processed",
                  "legendLink": null
                }
              ],
              "title": "Delete Requests Processed / Day",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Churn",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 6,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{cluster=~\"$cluster\", namespace=~\"$namespace\", pod=~\"(.*compactor.*|loki.*-backend.*|loki-single-binary)\"}",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                }
              ],
              "title": "Compactor CPU usage",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 7,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "go_memstats_heap_inuse_bytes{cluster=~\"$cluster\", namespace=~\"$namespace\", pod=~\"(.*compactor.*|loki.*-backend.*|loki-single-binary)\"} / 1024 / 1024 ",
                  "format": "time_series",
                  "legendFormat": " {{pod}} ",
                  "legendLink": null
                }
              ],
              "title": "Compactor memory usage (MiB)",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 8,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "loki_boltdb_shipper_compact_tables_operation_duration_seconds{cluster=~\"$cluster\", namespace=~\"$namespace\"}",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                }
              ],
              "title": "Compaction run duration (seconds)",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Compactor",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 9,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "sum(increase(loki_compactor_load_pending_requests_attempts_total{status=\"fail\", cluster=~\"$cluster\", namespace=~\"$namespace\"}[1h]))",
                  "format": "time_series",
                  "legendFormat": "failures",
                  "legendLink": null
                }
              ],
              "title": "Failures in Loading Delete Requests / Hour",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 10,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "sum(rate(loki_compactor_deleted_lines{cluster=~\"$cluster\", namespace=~\"$namespace\", pod=~\"(.*compactor.*|loki.*-backend.*|loki-single-binary)\"}[$__rate_interval])) by (user)",
                  "format": "time_series",
                  "legendFormat": "{{user}}",
                  "legendLink": null
                }
              ],
              "title": "Lines Deleted / Sec",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Deletion metrics",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$loki_datasource",
              "id": 11,
              "span": 6,
              "targets": [
                {
                  "expr": "{cluster=~\"$cluster\", namespace=~\"$namespace\", pod=~\"(.*compactor.*|loki.*-backend.*|loki-single-binary)\"} |~ \"Started processing delete request|delete request for user marked as processed\" | logfmt | line_format \"{{.ts}} user={{.user}} delete_request_id={{.delete_request_id}} msg={{.msg}}\" ",
                  "refId": "A"
                }
              ],
              "title": "In progress/finished",
              "type": "logs"
            },
            {
              "datasource": "$loki_datasource",
              "id": 12,
              "span": 6,
              "targets": [
                {
                  "expr": "{cluster=~\"$cluster\", namespace=~\"$namespace\", pod=~\"(.*compactor.*|loki.*-backend.*|loki-single-binary)\"} |~ \"delete request for user added\" | logfmt | line_format \"{{.ts}} user={{.user}} query='{{.query}}'\"",
                  "refId": "A"
                }
              ],
              "title": "Requests",
              "type": "logs"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "List of deletion requests",
          "titleSize": "h6"
        }
      ],
      "schemaVersion": 14,
      "style": "dark",
      "tags": [
        "loki"
      ],
      "templating": {
        "list": [
          {
            "current": {
              "text": "default",
              "value": "default"
            },
            "hide": 0,
            "label": "Data source",
            "name": "datasource",
            "options": [],
            "query": "prometheus",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "cluster",
            "multi": false,
            "name": "cluster",
            "options": [],
            "query": "label_values(loki_build_info, cluster)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "namespace",
            "multi": false,
            "name": "namespace",
            "options": [],
            "query": "label_values(loki_build_info{cluster=~\"$cluster\"}, namespace)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "hide": 0,
            "label": null,
            "name": "loki_datasource",
            "options": [],
            "query": "loki",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
          }
        ]
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "utc",
      "title": "Loki / Deletion",
      "uid": "deletion",
      "version": 0
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-loki-logs
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Loki"
  resyncPeriod: 24h
  json: |
    {
      "annotations": {
        "list": []
      },
      "editable": true,
      "gnetId": null,
      "graphTooltip": 0,
      "hideControls": false,
      "iteration": 1583185057230,
      "links": [
        {
          "asDropdown": true,
          "icon": "external link",
          "includeVars": true,
          "keepTime": true,
          "tags": [
            "loki"
          ],
          "targetBlank": false,
          "title": "Loki Dashboards",
          "type": "dashboards"
        }
      ],
      "panels": [
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 0,
            "y": 0
          },
          "hiddenSeries": false,
          "id": 35,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum by (pod)(go_goroutines{cluster=\"$cluster\", namespace=\"$namespace\", container=~\"$container\"  })",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "goroutines",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "unit": "s"
            }
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 3,
            "y": 0
          },
          "hiddenSeries": false,
          "id": 41,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(go_gc_duration_seconds{cluster=\"$cluster\", namespace=\"$namespace\", container=~\"$container\"}) by (quantile)",
              "legendFormat": "{{quantile}}",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "gc duration",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 6,
            "y": 0
          },
          "hiddenSeries": false,
          "id": 36,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum by (pod)(rate(container_cpu_usage_seconds_total{cluster=\"$cluster\", namespace=\"$namespace\", container=~\"$container\"}[$__rate_interval]))",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "cpu",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "unit": "bytes"
            }
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 9,
            "y": 0
          },
          "hiddenSeries": false,
          "id": 40,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum by (pod)(container_memory_working_set_bytes{cluster=\"$cluster\", namespace=\"$namespace\", container=~\"$container\"})",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "working set",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "bytes",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "unit": "binBps"
            }
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 12,
            "y": 0
          },
          "hiddenSeries": false,
          "id": 38,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum by (pod)(rate(container_network_transmit_bytes_total{cluster=\"$cluster\", namespace=\"$namespace\", container=~\"$container\"}[$__rate_interval]))",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "tx",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "bytes",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "unit": "binBps"
            }
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 15,
            "y": 0
          },
          "hiddenSeries": false,
          "id": 39,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum by (pod)(rate(container_network_receive_bytes_total{cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval]))",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "rx",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "decbytes",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 18,
            "y": 0
          },
          "hiddenSeries": false,
          "id": 37,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "increase(kube_pod_container_status_last_terminated_reason{cluster=\"$cluster\", namespace=\"$namespace\", container=~\"$container\"}[30m]) > 0",
              "legendFormat": "{{reason}}",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "restarts",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "bytes",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "unit": "ops"
            }
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 21,
            "y": 0
          },
          "hiddenSeries": false,
          "id": 42,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(rate(promtail_custom_bad_words_total{cluster=\"$cluster\", exported_namespace=\"$namespace\", container=~\"$container\"}[$__rate_interval])) by (level)",
              "legendFormat": "{{level}}",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "bad words",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "bytes",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$loki_datasource",
          "fieldConfig": {
            "defaults": {
              "unit": "ops"
            }
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 7,
            "w": 24,
            "x": 0,
            "y": 4
          },
          "hiddenSeries": false,
          "id": 31,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [
            {
              "alias": "warn",
              "color": "#FF780A"
            },
            {
              "alias": "error",
              "color": "#E02F44"
            },
            {
              "alias": "info",
              "color": "#56A64B"
            },
            {
              "alias": "debug",
              "color": "#3274D9"
            }
          ],
          "spaceLength": 10,
          "stack": true,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(rate({cluster=\"$cluster\", namespace=\"$namespace\", container=~\"$container\" } |logfmt| level=~\"$level\" |= \"$filter\" | __error__=\"\" [$__auto])) by (level)",
              "intervalFactor": 3,
              "legendFormat": "{{level}}",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Log Rate",
          "tooltip": {
            "shared": true,
            "sort": 2,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": false,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": false
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "datasource": "$loki_datasource",
          "gridPos": {
            "h": 19,
            "w": 24,
            "x": 0,
            "y": 6
          },
          "id": 29,
          "maxDataPoints": "",
          "options": {
            "showLabels": false,
            "showTime": true,
            "sortOrder": "Descending",
            "wrapLogMessage": true
          },
          "targets": [
            {
              "expr": "{cluster=\"$cluster\", namespace=\"$namespace\", container=~\"$container\"} | logfmt | level=~\"$level\" |= \"$filter\"",
              "refId": "A"
            }
          ],
          "timeFrom": null,
          "timeShift": null,
          "title": "Logs",
          "type": "logs"
        }
      ],
      "refresh": "10s",
      "rows": [],
      "schemaVersion": 14,
      "style": "dark",
      "tags": [
        "loki"
      ],
      "templating": {
        "list": [
          {
            "current": {
              "text": "default",
              "value": "default"
            },
            "hide": 0,
            "label": "Data source",
            "name": "datasource",
            "options": [],
            "query": "prometheus",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "cluster",
            "multi": false,
            "name": "cluster",
            "options": [],
            "query": "label_values(loki_build_info, cluster)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "namespace",
            "multi": false,
            "name": "namespace",
            "options": [],
            "query": "label_values(loki_build_info{cluster=~\"$cluster\"}, namespace)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "hide": 0,
            "label": null,
            "name": "loki_datasource",
            "options": [],
            "query": "loki",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
          },
          {
            "allValue": null,
            "current": {},
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": null,
            "multi": true,
            "name": "container",
            "options": [],
            "query": "label_values(kube_pod_container_info{cluster=\"$cluster\", namespace=\"$namespace\"}, container)",
            "refresh": 0,
            "regex": "",
            "sort": 1,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": {
              "selected": true,
              "text": "",
              "value": ""
            },
            "hide": 0,
            "includeAll": false,
            "label": "",
            "multi": true,
            "name": "level",
            "options": [
              {
                "selected": false,
                "text": "debug",
                "value": "debug"
              },
              {
                "selected": false,
                "text": "info",
                "value": "info"
              },
              {
                "selected": false,
                "text": "warn",
                "value": "warn"
              },
              {
                "selected": false,
                "text": "error",
                "value": "error"
              }
            ],
            "query": "debug,info,warn,error",
            "refresh": 0,
            "type": "custom"
          },
          {
            "current": {
              "selected": false,
              "text": "",
              "value": ""
            },
            "label": "LogQL Filter",
            "name": "filter",
            "query": "",
            "type": "textbox"
          }
        ]
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "utc",
      "title": "Loki / Logs",
      "uid": "logs",
      "version": 0
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-loki-mixin-recording-rules
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Loki"
  resyncPeriod: 24h
  json: |
    {
      "annotations": {
        "list": []
      },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "gnetId": null,
      "graphTooltip": 0,
      "hideControls": false,
      "iteration": 1635347545534,
      "links": [
        {
          "asDropdown": true,
          "icon": "external link",
          "includeVars": true,
          "keepTime": true,
          "tags": [
            "loki"
          ],
          "targetBlank": false,
          "title": "Loki Dashboards",
          "type": "dashboards"
        }
      ],
      "liveNow": false,
      "panels": [
        {
          "datasource": "${datasource}",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 1
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 10,
            "w": 2,
            "x": 0,
            "y": 0
          },
          "id": 2,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "textMode": "auto"
          },
          "pluginVersion": "8.3.0-38205pre",
          "targets": [
            {
              "datasource": "${datasource}",
              "exemplar": false,
              "expr": "sum(loki_ruler_wal_appender_ready) by (pod, tenant) == 0",
              "instant": true,
              "interval": "",
              "legendFormat": "",
              "refId": "A"
            }
          ],
          "title": "Appenders Not Ready",
          "type": "stat"
        },
        {
          "datasource": "${datasource}",
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 10,
            "w": 11,
            "x": 2,
            "y": 0
          },
          "id": 4,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom"
            },
            "tooltip": {
              "mode": "single"
            }
          },
          "targets": [
            {
              "datasource": "${datasource}",
              "exemplar": true,
              "expr": "sum(rate(loki_ruler_wal_samples_appended_total{tenant=~\"${tenant}\"}[$__rate_interval])) by (tenant) > 0",
              "interval": "",
              "legendFormat": "{{tenant}}",
              "refId": "A"
            }
          ],
          "title": "Samples Appended to WAL per Second",
          "type": "timeseries"
        },
        {
          "datasource": "${datasource}",
          "description": "Series are unique combinations of labels",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 10,
            "w": 11,
            "x": 13,
            "y": 0
          },
          "id": 5,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom"
            },
            "tooltip": {
              "mode": "single"
            }
          },
          "targets": [
            {
              "datasource": "${datasource}",
              "exemplar": true,
              "expr": "sum(rate(loki_ruler_wal_storage_created_series_total{tenant=~\"${tenant}\"}[$__rate_interval])) by (tenant) > 0",
              "interval": "",
              "legendFormat": "{{tenant}}",
              "refId": "A"
            }
          ],
          "title": "Series Created per Second",
          "type": "timeseries"
        },
        {
          "datasource": "${datasource}",
          "description": "Difference between highest timestamp appended to WAL and highest timestamp successfully written to remote storage",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 10,
            "w": 12,
            "x": 0,
            "y": 10
          },
          "id": 6,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom"
            },
            "tooltip": {
              "mode": "single"
            }
          },
          "targets": [
            {
              "datasource": "${datasource}",
              "exemplar": true,
              "expr": "loki_ruler_wal_prometheus_remote_storage_highest_timestamp_in_seconds{tenant=~\"${tenant}\"}\n- on (tenant)\n  (\n    loki_ruler_wal_prometheus_remote_storage_queue_highest_sent_timestamp_seconds{tenant=~\"${tenant}\"}\n    or vector(0)\n  )",
              "interval": "",
              "legendFormat": "{{tenant}}",
              "refId": "A"
            }
          ],
          "title": "Write Behind",
          "type": "timeseries"
        },
        {
          "datasource": "${datasource}",
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 10,
            "w": 12,
            "x": 12,
            "y": 10
          },
          "id": 7,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom"
            },
            "tooltip": {
              "mode": "single"
            }
          },
          "targets": [
            {
              "datasource": "${datasource}",
              "exemplar": true,
              "expr": "sum(rate(loki_ruler_wal_prometheus_remote_storage_samples_total{tenant=~\"${tenant}\"}[$__rate_interval])) by (tenant) > 0",
              "interval": "",
              "legendFormat": "{{tenant}}",
              "refId": "A"
            }
          ],
          "title": "Samples Sent per Second",
          "type": "timeseries"
        },
        {
          "datasource": "${datasource}",
          "description": "\n",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "bytes"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 10,
            "w": 12,
            "x": 0,
            "y": 20
          },
          "id": 8,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom"
            },
            "tooltip": {
              "mode": "single"
            }
          },
          "targets": [
            {
              "datasource": "${datasource}",
              "exemplar": true,
              "expr": "sum by (tenant) (loki_ruler_wal_disk_size{tenant=~\"${tenant}\"})",
              "interval": "",
              "legendFormat": "{{tenant}}",
              "refId": "A"
            }
          ],
          "title": "WAL Disk Size",
          "type": "timeseries"
        },
        {
          "datasource": "${datasource}",
          "description": "Some number of pending samples is expected, but if remote-write is failing this value will remain high",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 10,
            "w": 12,
            "x": 12,
            "y": 20
          },
          "id": 9,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom"
            },
            "tooltip": {
              "mode": "single"
            }
          },
          "targets": [
            {
              "datasource": "${datasource}",
              "exemplar": true,
              "expr": "max(loki_ruler_wal_prometheus_remote_storage_samples_pending{tenant=~\"${tenant}\"}) by (tenant,pod) > 0",
              "interval": "",
              "legendFormat": "{{tenant}}",
              "refId": "A"
            }
          ],
          "title": "Pending Samples",
          "type": "timeseries"
        }
      ],
      "refresh": "10s",
      "rows": [],
      "schemaVersion": 14,
      "style": "dark",
      "tags": [
        "loki"
      ],
      "templating": {
        "list": [
          {
            "current": {
              "text": "default",
              "value": "default"
            },
            "hide": 0,
            "label": "Data source",
            "name": "datasource",
            "options": [],
            "query": "prometheus",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "cluster",
            "multi": false,
            "name": "cluster",
            "options": [],
            "query": "label_values(loki_build_info, cluster)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "namespace",
            "multi": false,
            "name": "namespace",
            "options": [],
            "query": "label_values(loki_build_info{cluster=~\"$cluster\"}, namespace)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "hide": 0,
            "label": null,
            "name": "loki_datasource",
            "options": [],
            "query": "loki",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
          },
          {
            "allValue": ".+",
            "current": {},
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": true,
            "label": null,
            "multi": false,
            "name": "tenant",
            "options": [],
            "query": "query_result(sum by (id) (grafanacloud_logs_instance_info) and sum(label_replace(loki_tenant:active_streams{cluster=\"$cluster\",namespace=\"$namespace\"},\"id\",\"$1\",\"tenant\",\"(.*)\")) by(id))",
            "refresh": 0,
            "regex": "/\"([^\"]+)\"/",
            "sort": 1,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          }
        ]
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "utc",
      "title": "Loki / Recording Rules",
      "uid": "recording-rules",
      "version": 0,
      "weekStart": ""
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-loki-operational
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Loki"
  resyncPeriod: 24h
  json: |
    {
      "annotations": {
        "list": []
      },
      "editable": true,
      "gnetId": null,
      "graphTooltip": 0,
      "hideControls": false,
      "iteration": 1588704280892,
      "links": [
        {
          "asDropdown": true,
          "icon": "external link",
          "includeVars": true,
          "keepTime": true,
          "tags": [
            "loki"
          ],
          "targetBlank": false,
          "title": "Loki Dashboards",
          "type": "dashboards"
        }
      ],
      "panels": [
        {
          "collapsed": false,
          "datasource": null,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 0
          },
          "id": 17,
          "panels": [],
          "targets": [],
          "title": "Main",
          "type": "row"
        },
        {
          "aliasColors": {
            "5xx": "red"
          },
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 5,
            "w": 4,
            "x": 0,
            "y": 1
          },
          "hiddenSeries": false,
          "id": 6,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "panels": [],
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum by (status) (\nlabel_replace(\n  label_replace(\n        rate(loki_request_duration_seconds_count{cluster=\"$cluster\", job=~\"($namespace)/loki.*-read\", route=~\"api_prom_query|api_prom_label|api_prom_label_name_values|loki_api_v1_query|loki_api_v1_query_range|loki_api_v1_label|loki_api_v1_label_name_values\"}[$__rate_interval]),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n\"status\", \"${1}\", \"status_code\", \"([a-z]+)\")\n)",
              "legendFormat": "{{status}}",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Queries/Second",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 10,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {
            "5xx": "red"
          },
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 5,
            "w": 4,
            "x": 4,
            "y": 1
          },
          "hiddenSeries": false,
          "id": 7,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "panels": [],
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum by (status) (\nlabel_replace(\n  label_replace(\n          rate(loki_request_duration_seconds_count{cluster=\"$cluster\", job=~\"($namespace)/loki.*-write\", route=~\"api_prom_push|loki_api_v1_push|otlp_v1_logs\"}[$__rate_interval]),\n   \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n\"status\", \"${1}\", \"status_code\", \"([a-z]+)\"))",
              "legendFormat": "{{status}}",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Pushes/Second",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 10,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 5,
            "w": 4,
            "x": 12,
            "y": 1
          },
          "hiddenSeries": false,
          "id": 2,
          "interval": "",
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "panels": [],
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "topk(10, sum(rate(loki_distributor_lines_received_total{cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (tenant))",
              "legendFormat": "{{tenant}}",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Lines Per Tenant (top 10)",
          "tooltip": {
            "shared": false,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "custom": {},
              "unit": "MBs"
            },
            "overrides": []
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 5,
            "w": 4,
            "x": 16,
            "y": 1
          },
          "hiddenSeries": false,
          "id": 4,
          "legend": {
            "avg": false,
            "current": false,
            "hideEmpty": true,
            "hideZero": true,
            "max": false,
            "min": false,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "panels": [],
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "topk(10, sum(rate(loki_distributor_bytes_received_total{cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (tenant)) / 1024 / 1024",
              "legendFormat": "{{tenant}}",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "MBs Per Tenant (Top 10)",
          "tooltip": {
            "shared": false,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 5,
            "w": 4,
            "x": 20,
            "y": 1
          },
          "hiddenSeries": false,
          "id": 24,
          "legend": {
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "panels": [],
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "increase(kube_pod_container_status_restarts_total{cluster=\"$cluster\", namespace=\"$namespace\"}[10m]) > 0",
              "hide": false,
              "interval": "",
              "legendFormat": "{{container}}-{{pod}}",
              "refId": "B"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Container Restarts",
          "tooltip": {
            "shared": true,
            "sort": 2,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "custom": {},
              "unit": "ms"
            },
            "overrides": []
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 10,
            "w": 12,
            "x": 0,
            "y": 6
          },
          "hiddenSeries": false,
          "id": 9,
          "legend": {
            "alignAsTable": true,
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "panels": [],
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "histogram_quantile(0.99, sum by (le) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-write\", route=~\"api_prom_push|loki_api_v1_push|otlp_v1_logs\", cluster=~\"$cluster\"})) * 1e3",
              "legendFormat": ".99",
              "refId": "A"
            },
            {
              "expr": "histogram_quantile(0.75, sum by (le) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-write\", route=~\"api_prom_push|loki_api_v1_push|otlp_v1_logs\", cluster=~\"$cluster\"})) * 1e3",
              "legendFormat": ".9",
              "refId": "B"
            },
            {
              "expr": "histogram_quantile(0.5, sum by (le) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-write\", route=~\"api_prom_push|loki_api_v1_push|otlp_v1_logs\", cluster=~\"$cluster\"})) * 1e3",
              "legendFormat": ".5",
              "refId": "C"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Push Latency",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "custom": {},
              "unit": "ms"
            },
            "overrides": []
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 5,
            "w": 6,
            "x": 12,
            "y": 6
          },
          "hiddenSeries": false,
          "id": 12,
          "legend": {
            "alignAsTable": true,
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "panels": [],
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "histogram_quantile(0.99, sum by (le) (cluster_job:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-write\", cluster=~\"$cluster\"})) * 1e3",
              "legendFormat": ".99",
              "refId": "A"
            },
            {
              "expr": "histogram_quantile(0.9, sum by (le) (cluster_job:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-write\", cluster=~\"$cluster\"})) * 1e3",
              "legendFormat": ".9",
              "refId": "B"
            },
            {
              "expr": "histogram_quantile(0.5, sum by (le) (cluster_job:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-write\", cluster=~\"$cluster\"})) * 1e3",
              "legendFormat": ".5",
              "refId": "C"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Distributor Latency",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "fill": 0,
          "fillGradient": 0,
          "gridPos": {
            "h": 5,
            "w": 6,
            "x": 18,
            "y": 6
          },
          "hiddenSeries": false,
          "id": 71,
          "legend": {
            "alignAsTable": true,
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "panels": [],
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(rate(loki_request_duration_seconds_count{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-write\", status_code!~\"5[0-9]{2}\"}[$__rate_interval])) by (route)\n/\nsum(rate(loki_request_duration_seconds_count{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-write\"}[$__rate_interval])) by (route) > 0",
              "interval": "",
              "legendFormat": "{{route}}",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Distributor Success Rate",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "decimals": null,
              "format": "percentunit",
              "label": "",
              "logBase": 1,
              "max": "1",
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "custom": {},
              "unit": "ms"
            },
            "overrides": []
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 5,
            "w": 6,
            "x": 12,
            "y": 11
          },
          "hiddenSeries": false,
          "id": 13,
          "legend": {
            "alignAsTable": true,
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "panels": [],
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "histogram_quantile(0.99, sum by (le) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-write\", route=\"/logproto.Pusher/Push\", cluster=~\"$cluster\"})) * 1e3",
              "legendFormat": ".99",
              "refId": "A"
            },
            {
              "expr": "histogram_quantile(0.9, sum by (le) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-write\", route=\"/logproto.Pusher/Push\", cluster=~\"$cluster\"})) * 1e3",
              "hide": false,
              "legendFormat": ".9",
              "refId": "B"
            },
            {
              "expr": "histogram_quantile(0.5, sum by (le) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-write\", route=\"/logproto.Pusher/Push\", cluster=~\"$cluster\"})) * 1e3",
              "hide": false,
              "legendFormat": ".5",
              "refId": "C"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Ingester Latency Write",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "fill": 0,
          "fillGradient": 0,
          "gridPos": {
            "h": 5,
            "w": 6,
            "x": 18,
            "y": 11
          },
          "hiddenSeries": false,
          "id": 72,
          "legend": {
            "alignAsTable": true,
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "panels": [],
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(rate(loki_request_duration_seconds_count{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-write\", status_code!~\"5[0-9]{2}\", route=\"/logproto.Pusher/Push\"}[$__rate_interval])) by (route)\n/\nsum(rate(loki_request_duration_seconds_count{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-write\", route=\"/logproto.Pusher/Push\"}[$__rate_interval])) by (route) > 0",
              "interval": "",
              "legendFormat": "{{route}}",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Ingester Success Rate Write",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "decimals": null,
              "format": "percentunit",
              "label": "",
              "logBase": 1,
              "max": "1",
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "custom": {},
              "unit": "ms"
            },
            "overrides": []
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 10,
            "w": 12,
            "x": 0,
            "y": 16
          },
          "hiddenSeries": false,
          "id": 10,
          "legend": {
            "alignAsTable": true,
            "avg": false,
            "current": false,
            "hideEmpty": true,
            "hideZero": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": true,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "panels": [],
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "histogram_quantile(0.99, sum by (le,route) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-read\", route=~\"api_prom_query|api_prom_labels|api_prom_label_name_values|loki_api_v1_query|loki_api_v1_query_range|loki_api_v1_label|loki_api_v1_label_name_values\", cluster=\"$cluster\"}))",
              "legendFormat": "{{route}}-.99",
              "refId": "A"
            },
            {
              "expr": "histogram_quantile(0.9, sum by (le,route) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-read\", route=~\"api_prom_query|api_prom_labels|api_prom_label_name_values|loki_api_v1_query|loki_api_v1_query_range|loki_api_v1_label|loki_api_v1_label_name_values\", cluster=\"$cluster\"}))",
              "legendFormat": "{{route}}-.9",
              "refId": "B"
            },
            {
              "expr": "histogram_quantile(0.5, sum by (le,route) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-read\", route=~\"api_prom_query|api_prom_labels|api_prom_label_name_values|loki_api_v1_query|loki_api_v1_query_range|loki_api_v1_label|loki_api_v1_label_name_values\", cluster=\"$cluster\"}))",
              "legendFormat": "{{route}}-.5",
              "refId": "C"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Query Latency",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "custom": {},
              "unit": "ms"
            },
            "overrides": []
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 5,
            "w": 6,
            "x": 12,
            "y": 16
          },
          "hiddenSeries": false,
          "id": 14,
          "legend": {
            "alignAsTable": true,
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "panels": [],
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "histogram_quantile(0.99, sum by (le,route) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-read\", route=~\"api_prom_query|api_prom_labels|api_prom_label_name_values|loki_api_v1_query|loki_api_v1_query_range|loki_api_v1_label|loki_api_v1_label_name_values\", cluster=\"$cluster\"})) * 1e3",
              "legendFormat": ".99-{{route}}",
              "refId": "A"
            },
            {
              "expr": "histogram_quantile(0.9, sum by (le,route) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-read\", route=~\"api_prom_query|api_prom_labels|api_prom_label_name_values|loki_api_v1_query|loki_api_v1_query_range|loki_api_v1_label|loki_api_v1_label_name_values\", cluster=\"$cluster\"})) * 1e3",
              "legendFormat": ".9-{{route}}",
              "refId": "B"
            },
            {
              "expr": "histogram_quantile(0.5, sum by (le,route) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-read\", route=~\"api_prom_query|api_prom_labels|api_prom_label_name_values|loki_api_v1_query|loki_api_v1_query_range|loki_api_v1_label|loki_api_v1_label_name_values\", cluster=\"$cluster\"})) * 1e3",
              "legendFormat": ".5-{{route}}",
              "refId": "C"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Querier Latency",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "fill": 0,
          "fillGradient": 0,
          "gridPos": {
            "h": 5,
            "w": 6,
            "x": 18,
            "y": 16
          },
          "hiddenSeries": false,
          "id": 73,
          "legend": {
            "alignAsTable": true,
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "panels": [],
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(rate(loki_request_duration_seconds_count{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-read\", status_code!~\"5[0-9]{2}\"}[$__rate_interval])) by (route)\n/\nsum(rate(loki_request_duration_seconds_count{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-read\"}[$__rate_interval])) by (route) > 0",
              "interval": "",
              "legendFormat": "{{route}}",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Querier Success Rate",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "decimals": null,
              "format": "percentunit",
              "label": "",
              "logBase": 1,
              "max": "1",
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "description": "",
          "fieldConfig": {
            "defaults": {
              "custom": {},
              "unit": "ms"
            },
            "overrides": []
          },
          "fill": 1,
          "fillGradient": 0,
          "gridPos": {
            "h": 5,
            "w": 6,
            "x": 12,
            "y": 21
          },
          "hiddenSeries": false,
          "id": 15,
          "legend": {
            "alignAsTable": true,
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "panels": [],
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "histogram_quantile(0.99, sum by (le,route) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-write\", route=~\"/logproto.Querier/Query|/logproto.Querier/Label|/logproto.Querier/Series|/logproto.Querier/QuerySample|/logproto.Querier/GetChunkIDs\", cluster=\"$cluster\"})) * 1e3",
              "legendFormat": ".99-{{route}}",
              "refId": "A"
            },
            {
              "expr": "histogram_quantile(0.9, sum by (le,route) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-write\", route=~\"/logproto.Querier/Query|/logproto.Querier/Label|/logproto.Querier/Series|/logproto.Querier/QuerySample|/logproto.Querier/GetChunkIDs\", cluster=\"$cluster\"})) * 1e3",
              "legendFormat": ".9-{{route}}",
              "refId": "B"
            },
            {
              "expr": "histogram_quantile(0.5, sum by (le,route) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{job=~\"($namespace)/loki.*-write\", route=~\"/logproto.Querier/Query|/logproto.Querier/Label|/logproto.Querier/Series|/logproto.Querier/QuerySample|/logproto.Querier/GetChunkIDs\", cluster=\"$cluster\"})) * 1e3",
              "legendFormat": ".5-{{route}}",
              "refId": "C"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Ingester Latency Read",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "aliasColors": {},
          "bars": false,
          "dashLength": 10,
          "dashes": false,
          "datasource": "$datasource",
          "fieldConfig": {
            "defaults": {
              "custom": {}
            },
            "overrides": []
          },
          "fill": 0,
          "fillGradient": 0,
          "gridPos": {
            "h": 5,
            "w": 6,
            "x": 18,
            "y": 21
          },
          "hiddenSeries": false,
          "id": 74,
          "legend": {
            "alignAsTable": true,
            "avg": false,
            "current": false,
            "max": false,
            "min": false,
            "rightSide": true,
            "show": false,
            "total": false,
            "values": false
          },
          "lines": true,
          "linewidth": 1,
          "nullPointMode": "null",
          "options": {
            "dataLinks": []
          },
          "panels": [],
          "percentage": false,
          "pointradius": 2,
          "points": false,
          "renderer": "flot",
          "seriesOverrides": [],
          "spaceLength": 10,
          "stack": false,
          "steppedLine": false,
          "targets": [
            {
              "expr": "sum(rate(loki_request_duration_seconds_count{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-write\", status_code!~\"5[0-9]{2}\", route=~\"/logproto.Querier/Query|/logproto.Querier/Label|/logproto.Querier/Series|/logproto.Querier/QuerySample|/logproto.Querier/GetChunkIDs\"}[$__rate_interval])) by (route)\n/\nsum(rate(loki_request_duration_seconds_count{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-write\", route=~\"/logproto.Querier/Query|/logproto.Querier/Label|/logproto.Querier/Series|/logproto.Querier/QuerySample|/logproto.Querier/GetChunkIDs\"}[$__rate_interval])) by (route) > 0",
              "interval": "",
              "legendFormat": "{{route}}",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "timeFrom": null,
          "timeRegions": [],
          "timeShift": null,
          "title": "Ingester Success Rate Read",
          "tooltip": {
            "shared": true,
            "sort": 0,
            "value_type": "individual"
          },
          "type": "timeseries",
          "xaxis": {
            "buckets": null,
            "mode": "time",
            "name": null,
            "show": true,
            "values": []
          },
          "yaxes": [
            {
              "decimals": null,
              "format": "percentunit",
              "label": "",
              "logBase": 1,
              "max": "1",
              "min": null,
              "show": true
            },
            {
              "format": "short",
              "label": null,
              "logBase": 1,
              "max": null,
              "min": null,
              "show": true
            }
          ],
          "yaxis": {
            "align": false,
            "alignLevel": null
          }
        },
        {
          "collapsed": true,
          "datasource": null,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 26
          },
          "id": 110,
          "panels": [
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 8,
                "w": 12,
                "x": 0,
                "y": 27
              },
              "hiddenSeries": false,
              "id": 112,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 2,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "topk(10,sum by (tenant, reason) (rate(loki_discarded_samples_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])))",
                  "interval": "",
                  "legendFormat": "{{ tenant }} - {{ reason }}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Discarded Lines",
              "tooltip": {
                "shared": false,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "mode": "thresholds"
                  },
                  "custom": {
                    "align": "right",
                    "cellOptions": {
                      "type": "auto"
                    },
                    "inspect": false
                  },
                  "decimals": 2,
                  "displayName": "",
                  "mappings": [],
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green",
                        "value": null
                      },
                      {
                        "color": "red",
                        "value": 80
                      }
                    ]
                  },
                  "unit": "short"
                },
                "overrides": [
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "Time"
                    },
                    "properties": [
                      {
                        "id": "displayName",
                        "value": "Time"
                      },
                      {
                        "id": "custom.align"
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "tenant"
                    },
                    "properties": [
                      {
                        "id": "unit",
                        "value": "short"
                      },
                      {
                        "id": "decimals",
                        "value": 2
                      },
                      {
                        "id": "custom.align"
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "reason"
                    },
                    "properties": [
                      {
                        "id": "unit",
                        "value": "short"
                      },
                      {
                        "id": "decimals",
                        "value": 2
                      },
                      {
                        "id": "custom.align"
                      }
                    ]
                  }
                ]
              },
              "gridPos": {
                "h": 8,
                "w": 12,
                "x": 12,
                "y": 27
              },
              "id": 113,
              "options": {
                "cellHeight": "sm",
                "footer": {
                  "countRows": false,
                  "fields": "",
                  "reducer": [
                    "sum"
                  ],
                  "show": false
                },
                "showHeader": true
              },
              "panels": [],
              "pluginVersion": "10.4.0",
              "targets": [
                {
                  "expr": "topk(10, sum by (tenant, reason) (sum_over_time(increase(loki_discarded_samples_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])[$__range:$__rate_interval])))",
                  "format": "table",
                  "instant": true,
                  "interval": "",
                  "legendFormat": "{{ tenant }} - {{ reason }}",
                  "refId": "A"
                }
              ],
              "title": "Discarded Lines Per Interval",
              "transformations": [
                {
                  "id": "merge",
                  "options": {
                    "reducers": []
                  }
                }
              ],
              "type": "table"
            }
          ],
          "targets": [],
          "title": "Limits",
          "type": "row"
        },
        {
          "collapsed": true,
          "datasource": null,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 27
          },
          "id": 23,
          "panels": [
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 7,
                "w": 6,
                "x": 0,
                "y": 28
              },
              "hiddenSeries": false,
              "id": 26,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": false,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 1,
              "points": true,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum by(pod) (rate(container_cpu_usage_seconds_total{cluster=~\"$cluster\", namespace=~\"$namespace\", pod=~\"loki.*-write.*\"}[$__rate_interval]))",
                  "intervalFactor": 3,
                  "legendFormat": "{{pod}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "CPU Usage",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "unit": "binBps"
                }
              },
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 7,
                "w": 6,
                "x": 6,
                "y": 28
              },
              "hiddenSeries": false,
              "id": 27,
              "legend": {
                "avg": false,
                "current": false,
                "hideEmpty": false,
                "hideZero": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": false,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 1,
              "points": true,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "go_memstats_heap_inuse_bytes{cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"loki.*-write.*\"}",
                  "instant": false,
                  "intervalFactor": 3,
                  "legendFormat": "{{pod}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Memory Usage",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "bytes",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "aliasColors": {},
              "bars": true,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$loki_datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 4,
                "w": 12,
                "x": 12,
                "y": 28
              },
              "hiddenSeries": false,
              "id": 31,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": false,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 2,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [
                {
                  "alias": "{}",
                  "color": "#C4162A"
                }
              ],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate({cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-write\"} | logfmt | level=\"error\"[$__auto]))",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Error Log Rate",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": false,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": false
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "datasource": "$loki_datasource",
              "gridPos": {
                "h": 18,
                "w": 12,
                "x": 12,
                "y": 32
              },
              "id": 29,
              "options": {
                "showLabels": false,
                "showTime": false,
                "sortOrder": "Descending",
                "wrapLogMessage": true
              },
              "panels": [],
              "targets": [
                {
                  "expr": "{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-write\"} | logfmt | level=\"error\"",
                  "refId": "A"
                }
              ],
              "timeFrom": null,
              "timeShift": null,
              "title": "Logs",
              "type": "logs"
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 0,
              "fillGradient": 0,
              "gridPos": {
                "h": 7,
                "w": 6,
                "x": 0,
                "y": 35
              },
              "hiddenSeries": false,
              "id": 33,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 1,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate(loki_request_duration_seconds_count{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-write\", status_code!~\"5[0-9]{2}\"}[$__rate_interval])) by (route)\n/\nsum(rate(loki_request_duration_seconds_count{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-write\"}[$__rate_interval])) by (route) > 0",
                  "interval": "",
                  "intervalFactor": 1,
                  "legendFormat": "{{route}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Success Rate",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "unit": "binBps"
                }
              },
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 7,
                "w": 6,
                "x": 6,
                "y": 35
              },
              "hiddenSeries": false,
              "id": 32,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 1,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate(loki_distributor_ingester_append_failures_total{cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (pod)",
                  "intervalFactor": 1,
                  "legendFormat": "{{pod}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Append Failures By Ingester",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "unit": "binBps"
                }
              },
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 7,
                "w": 6,
                "x": 0,
                "y": 42
              },
              "hiddenSeries": false,
              "id": 34,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 1,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate(loki_distributor_bytes_received_total{cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (pod)",
                  "intervalFactor": 1,
                  "legendFormat": "{{pod}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Bytes Received/Second",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "unit": "ops"
                }
              },
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 7,
                "w": 6,
                "x": 6,
                "y": 42
              },
              "hiddenSeries": false,
              "id": 35,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 1,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate(loki_distributor_lines_received_total{cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (pod)",
                  "intervalFactor": 1,
                  "legendFormat": "{{pod}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Lines Received/Second",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            }
          ],
          "targets": [],
          "title": "Write Path",
          "type": "row"
        },
        {
          "collapsed": true,
          "datasource": null,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 29
          },
          "id": 104,
          "panels": [
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 8,
                "w": 12,
                "x": 0,
                "y": 30
              },
              "hiddenSeries": false,
              "id": 106,
              "legend": {
                "avg": false,
                "current": false,
                "hideEmpty": true,
                "hideZero": true,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 2,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "topk(10,sum by (tenant) (loki_ingester_memory_streams{cluster=\"$cluster\",job=~\"($namespace)/loki.*-write\"}))",
                  "interval": "",
                  "legendFormat": "{{ tenant }}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Active Streams",
              "tooltip": {
                "shared": false,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 8,
                "w": 12,
                "x": 12,
                "y": 30
              },
              "hiddenSeries": false,
              "id": 108,
              "legend": {
                "avg": false,
                "current": false,
                "hideEmpty": true,
                "hideZero": true,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 2,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "topk(10, sum by (tenant) (rate(loki_ingester_streams_created_total{cluster=\"$cluster\",job=~\"($namespace)/loki.*-write\"}[$__rate_interval]) > 0))",
                  "interval": "",
                  "legendFormat": "{{ tenant }}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Streams Created/Sec",
              "tooltip": {
                "shared": false,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            }
          ],
          "targets": [],
          "title": "Streams",
          "type": "row"
        },
        {
          "collapsed": true,
          "datasource": null,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 30
          },
          "id": 94,
          "panels": [
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 8,
                "w": 12,
                "x": 0,
                "y": 31
              },
              "hiddenSeries": false,
              "id": 102,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": true,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 2,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [
                {
                  "alias": "De-Dupe Ratio",
                  "yaxis": 2
                }
              ],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate(loki_ingester_chunks_flushed_total{cluster=\"$cluster\",job=~\"($namespace)/loki.*-write\"}[$__rate_interval]))",
                  "interval": "",
                  "legendFormat": "Chunks",
                  "refId": "A"
                },
                {
                  "expr": "sum(increase(loki_chunk_store_deduped_chunks_total{cluster=\"$cluster\", job=~\"($namespace)/loki.*-write\"}[$__rate_interval]))/sum(increase(loki_ingester_chunks_flushed_total{cluster=\"$cluster\", job=~\"($namespace)/loki.*-write\"}[$__rate_interval])) < 1",
                  "interval": "",
                  "legendFormat": "De-Dupe Ratio",
                  "refId": "B"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Chunks Flushed/Sec",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "cards": {
                "cardPadding": null,
                "cardRound": null
              },
              "color": {
                "cardColor": "#b4ff00",
                "colorScale": "sqrt",
                "colorScheme": "interpolateSpectral",
                "exponent": 0.5,
                "mode": "spectrum"
              },
              "dataFormat": "tsbuckets",
              "datasource": "$datasource",
              "gridPos": {
                "h": 8,
                "w": 12,
                "x": 12,
                "y": 31
              },
              "heatmap": {},
              "hideZeroBuckets": false,
              "highlightCards": true,
              "id": 100,
              "legend": {
                "show": true
              },
              "panels": [],
              "reverseYBuckets": false,
              "targets": [
                {
                  "expr": "sum(rate(loki_ingester_chunk_size_bytes_bucket{cluster=\"$cluster\",job=~\"($namespace)/loki.*-write\"}[$__rate_interval])) by (le)",
                  "format": "heatmap",
                  "instant": false,
                  "interval": "",
                  "legendFormat": "{{ le }}",
                  "refId": "A"
                }
              ],
              "timeFrom": null,
              "timeShift": null,
              "title": "Chunk Size Bytes",
              "tooltip": {
                "show": true,
                "showHistogram": false
              },
              "type": "heatmap",
              "xAxis": {
                "show": true
              },
              "xBucketNumber": null,
              "xBucketSize": null,
              "yAxis": {
                "decimals": 0,
                "format": "bytes",
                "logBase": 1,
                "max": null,
                "min": null,
                "show": true,
                "splitFactor": null
              },
              "yBucketBound": "auto",
              "yBucketNumber": null,
              "yBucketSize": null
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 7,
              "fillGradient": 0,
              "gridPos": {
                "h": 9,
                "w": 12,
                "x": 0,
                "y": 39
              },
              "hiddenSeries": false,
              "id": 96,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": true,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 2,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": true,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum by(reason) (rate(loki_ingester_chunks_flushed_total{cluster=~\"$cluster\",job=~\"($namespace)/loki.*-write\", namespace=~\"$namespace\"}[$__rate_interval])) / ignoring(reason) group_left sum(rate(loki_ingester_chunks_flushed_total{cluster=~\"$cluster\",job=~\"($namespace)/loki.*-write\", namespace=~\"$namespace\"}[$__rate_interval]))",
                  "interval": "",
                  "legendFormat": "{{ reason }}"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Chunk Flush Reason %",
              "tooltip": {
                "shared": true,
                "sort": 0,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "percentunit",
                  "label": null,
                  "logBase": 1,
                  "max": "1",
                  "min": "0",
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "cards": {
                "cardPadding": null,
                "cardRound": null
              },
              "color": {
                "cardColor": "#b4ff00",
                "colorScale": "sqrt",
                "colorScheme": "interpolateSpectral",
                "exponent": 0.5,
                "max": null,
                "min": null,
                "mode": "spectrum"
              },
              "dataFormat": "tsbuckets",
              "datasource": "$datasource",
              "gridPos": {
                "h": 9,
                "w": 12,
                "x": 12,
                "y": 39
              },
              "heatmap": {},
              "hideZeroBuckets": true,
              "highlightCards": true,
              "id": 98,
              "legend": {
                "show": true
              },
              "panels": [],
              "reverseYBuckets": false,
              "targets": [
                {
                  "expr": "sum by (le) (rate(loki_ingester_chunk_utilization_bucket{cluster=\"$cluster\", job=~\"($namespace)/loki.*-write\"}[$__rate_interval]))",
                  "format": "heatmap",
                  "instant": false,
                  "interval": "",
                  "legendFormat": "{{ le }}",
                  "refId": "A"
                }
              ],
              "timeFrom": null,
              "timeShift": null,
              "title": "Chunk Utilization",
              "tooltip": {
                "show": true,
                "showHistogram": false
              },
              "type": "heatmap",
              "xAxis": {
                "show": true
              },
              "xBucketNumber": null,
              "xBucketSize": null,
              "yAxis": {
                "decimals": 0,
                "format": "percentunit",
                "logBase": 1,
                "max": null,
                "min": null,
                "show": true,
                "splitFactor": null
              },
              "yBucketBound": "auto",
              "yBucketNumber": null,
              "yBucketSize": null
            }
          ],
          "targets": [],
          "title": "Chunks",
          "type": "row"
        },
        {
          "collapsed": true,
          "datasource": null,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 31
          },
          "id": 64,
          "panels": [
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 7,
                "w": 6,
                "x": 0,
                "y": 32
              },
              "hiddenSeries": false,
              "id": 68,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": false,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 1,
              "points": true,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum by(pod) (rate(container_cpu_usage_seconds_total{cluster=~\"$cluster\", namespace=~\"$namespace\", pod=~\"loki.*-read.*\"}[$__rate_interval]))",
                  "intervalFactor": 3,
                  "legendFormat": "{{pod}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "CPU Usage",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "unit": "binBps"
                }
              },
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 7,
                "w": 6,
                "x": 0,
                "y": 39
              },
              "hiddenSeries": false,
              "id": 69,
              "legend": {
                "avg": false,
                "current": false,
                "hideEmpty": false,
                "hideZero": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": false,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 1,
              "points": true,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "go_memstats_heap_inuse_bytes{cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"loki.*-read.*\"}",
                  "instant": false,
                  "intervalFactor": 3,
                  "legendFormat": "{{pod}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Memory Usage",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "bytes",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "aliasColors": {},
              "bars": true,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$loki_datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 3,
                "w": 18,
                "x": 12,
                "y": 32
              },
              "hiddenSeries": false,
              "id": 65,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": false,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 2,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [
                {
                  "alias": "{}",
                  "color": "#F2495C"
                }
              ],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate({cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-read\"} | logfmt |  level=\"error\"[$__auto]))",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Error Log Rate",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": false,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": false
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "datasource": "$loki_datasource",
              "gridPos": {
                "h": 18,
                "w": 18,
                "x": 12,
                "y": 35
              },
              "id": 66,
              "options": {
                "showLabels": false,
                "showTime": false,
                "sortOrder": "Descending",
                "wrapLogMessage": true
              },
              "panels": [],
              "targets": [
                {
                  "expr": "{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-read\"} | logfmt | level=\"error\"",
                  "refId": "A"
                }
              ],
              "timeFrom": null,
              "timeShift": null,
              "title": "Logs",
              "type": "logs"
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 0,
              "fillGradient": 0,
              "gridPos": {
                "h": 7,
                "w": 6,
                "x": 0,
                "y": 46
              },
              "hiddenSeries": false,
              "id": 70,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 1,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate(loki_request_duration_seconds_count{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-read\", status_code!~\"5[0-9]{2}\"}[$__rate_interval])) by (route)\n/\nsum(rate(loki_request_duration_seconds_count{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-read\"}[$__rate_interval])) by (route) > 0",
                  "interval": "",
                  "intervalFactor": 1,
                  "legendFormat": "{{route}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Success Rate",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            }
          ],
          "targets": [],
          "title": "Read Path",
          "type": "row"
        },
        {
          "collapsed": true,
          "datasource": null,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 31
          },
          "id": 64,
          "panels": [
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 7,
                "w": 6,
                "x": 0,
                "y": 32
              },
              "hiddenSeries": false,
              "id": 68,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": false,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 1,
              "points": true,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum by(pod) (rate(container_cpu_usage_seconds_total{cluster=~\"$cluster\", namespace=~\"$namespace\", pod=~\"loki.*-read.*\"}[$__rate_interval]))",
                  "intervalFactor": 3,
                  "legendFormat": "{{pod}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "CPU Usage",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "unit": "binBps"
                }
              },
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 7,
                "w": 6,
                "x": 0,
                "y": 39
              },
              "hiddenSeries": false,
              "id": 69,
              "legend": {
                "avg": false,
                "current": false,
                "hideEmpty": false,
                "hideZero": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": false,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 1,
              "points": true,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "go_memstats_heap_inuse_bytes{cluster=\"$cluster\", namespace=\"$namespace\", pod=~\"loki.*-backend.*\"}",
                  "instant": false,
                  "intervalFactor": 3,
                  "legendFormat": "{{pod}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Memory Usage",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "bytes",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "aliasColors": {},
              "bars": true,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$loki_datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 3,
                "w": 18,
                "x": 12,
                "y": 32
              },
              "hiddenSeries": false,
              "id": 65,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": false,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 2,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [
                {
                  "alias": "{}",
                  "color": "#F2495C"
                }
              ],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate({cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-backend\"} | logfmt |  level=\"error\"[$__auto]))",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Error Log Rate",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": false,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": false
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "datasource": "$loki_datasource",
              "gridPos": {
                "h": 18,
                "w": 18,
                "x": 12,
                "y": 35
              },
              "id": 66,
              "options": {
                "showLabels": false,
                "showTime": false,
                "sortOrder": "Descending",
                "wrapLogMessage": true
              },
              "panels": [],
              "targets": [
                {
                  "expr": "{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-backend\"} | logfmt | level=\"error\"",
                  "refId": "A"
                }
              ],
              "timeFrom": null,
              "timeShift": null,
              "title": "Logs",
              "type": "logs"
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 0,
              "fillGradient": 0,
              "gridPos": {
                "h": 7,
                "w": 6,
                "x": 0,
                "y": 46
              },
              "hiddenSeries": false,
              "id": 70,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": false,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 1,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate(loki_request_duration_seconds_count{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-backend\", status_code!~\"5[0-9]{2}\"}[$__rate_interval])) by (route)\n/\nsum(rate(loki_request_duration_seconds_count{cluster=\"$cluster\", namespace=\"$namespace\", job=~\"($namespace)/loki.*-backend\"}[$__rate_interval])) by (route) > 0",
                  "interval": "",
                  "intervalFactor": 1,
                  "legendFormat": "{{route}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Success Rate",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            }
          ],
          "targets": [],
          "title": "Backend Path",
          "type": "row"
        },
        {
          "collapsed": true,
          "datasource": null,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 37
          },
          "id": 78,
          "panels": [
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "unit": "s"
                }
              },
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 8,
                "w": 24,
                "x": 0,
                "y": 10
              },
              "id": 79,
              "interval": "",
              "legend": {
                "alignAsTable": true,
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "rightSide": true,
                "show": true,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 1,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "histogram_quantile(.99, sum(rate(loki_s3_request_duration_seconds_bucket{cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (operation, le))",
                  "intervalFactor": 1,
                  "legendFormat": ".99-{{operation}}",
                  "refId": "A"
                },
                {
                  "expr": "histogram_quantile(.9, sum(rate(loki_s3_request_duration_seconds_bucket{cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (operation, le))",
                  "hide": false,
                  "legendFormat": ".9-{{operation}}",
                  "refId": "B"
                },
                {
                  "expr": "histogram_quantile(.5, sum(rate(loki_s3_request_duration_seconds_bucket{cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (operation, le))",
                  "hide": false,
                  "legendFormat": ".5-{{operation}}",
                  "refId": "C"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Latency By Operation",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            },
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fill": 1,
              "fillGradient": 0,
              "gridPos": {
                "h": 8,
                "w": 24,
                "x": 0,
                "y": 18
              },
              "id": 80,
              "interval": "",
              "legend": {
                "alignAsTable": true,
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "rightSide": true,
                "show": true,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "nullPointMode": "null",
              "options": {
                "dataLinks": []
              },
              "panels": [],
              "percentage": false,
              "pointradius": 1,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "sum(rate(loki_s3_request_duration_seconds_count{cluster=\"$cluster\", namespace=\"$namespace\"}[$__rate_interval])) by (status_code, operation)",
                  "intervalFactor": 1,
                  "legendFormat": "{{status_code}}-{{operation}}",
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeRegions": [],
              "timeShift": null,
              "title": "Status By Method",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "timeseries",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": true
                }
              ],
              "yaxis": {
                "align": false,
                "alignLevel": null
              }
            }
          ],
          "targets": [],
          "title": "S3",
          "type": "row"
        }
      ],
      "refresh": "10s",
      "rows": [],
      "schemaVersion": 14,
      "style": "dark",
      "tags": [
        "loki"
      ],
      "templating": {
        "list": [
          {
            "current": {
              "text": "default",
              "value": "default"
            },
            "hide": 0,
            "label": "Data source",
            "name": "datasource",
            "options": [],
            "query": "prometheus",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
          },
          {
            "hide": 0,
            "label": null,
            "name": "loki_datasource",
            "options": [],
            "query": "loki",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "cluster",
            "multi": false,
            "name": "cluster",
            "options": [],
            "query": "label_values(loki_build_info, cluster)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "namespace",
            "multi": false,
            "name": "namespace",
            "options": [],
            "query": "label_values(loki_build_info{cluster=~\"$cluster\"}, namespace)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          }
        ]
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "utc",
      "title": "Loki / Operational",
      "uid": "operational",
      "version": 0
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-loki-reads
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Loki"
  resyncPeriod: 24h
  json: |
    {
      "annotations": {
        "list": []
      },
      "editable": true,
      "gnetId": null,
      "graphTooltip": 0,
      "hideControls": false,
      "links": [
        {
          "asDropdown": true,
          "icon": "external link",
          "includeVars": true,
          "keepTime": true,
          "tags": [
            "loki"
          ],
          "targetBlank": false,
          "title": "Loki Dashboards",
          "type": "dashboards"
        }
      ],
      "refresh": "10s",
      "rows": [
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "aliasColors": {
                "1xx": "#EAB839",
                "2xx": "#7EB26D",
                "3xx": "#6ED0E0",
                "4xx": "#EF843C",
                "5xx": "#E24D42",
                "OK": "#7EB26D",
                "cancel": "#A9A9A9",
                "error": "#E24D42",
                "success": "#7EB26D"
              },
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 100,
                    "lineWidth": 0,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "normal"
                    }
                  },
                  "min": 0,
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": [
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "1xx"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#EAB839",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "2xx"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#7EB26D",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "3xx"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#6ED0E0",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "4xx"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#EF843C",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "5xx"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#E24D42",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "OK"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#7EB26D",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "cancel"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#A9A9A9",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "error"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#E24D42",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "success"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#7EB26D",
                          "mode": "fixed"
                        }
                      }
                    ]
                  }
                ]
              },
              "fill": 10,
              "id": 1,
              "linewidth": 0,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "stack": true,
              "targets": [
                {
                  "expr": "sum by (status) (\n  label_replace(label_replace(rate(loki_request_duration_seconds_count{cluster=~\"$cluster\",job=~\"($namespace)/loki.*-read\", route=~\"(api_prom_rules|api_prom_rules_namespace_groupname|api_v1_rules|loki_api_v1_delete|loki_api_v1_detected_labels|loki_api_v1_index_stats|loki_api_v1_index_volume|loki_api_v1_index_volume_range|loki_api_v1_label_name_values|loki_api_v1_label_values|loki_api_v1_labels|loki_api_v1_patterns|loki_api_v1_query|loki_api_v1_query_range|loki_api_v1_series|prometheus_api_v1_rules)\"}[$__rate_interval]),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n  \"status\", \"${1}\", \"status_code\", \"([a-zA-Z_]+)\"))\n",
                  "format": "time_series",
                  "legendFormat": "{{status}}",
                  "refId": "A"
                }
              ],
              "title": "QPS",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "ms"
                },
                "overrides": []
              },
              "id": 2,
              "links": [],
              "nullPointMode": "null as zero",
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "histogram_quantile(0.99, sum by (le,route) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-read\", route=~\"(api_prom_rules|api_prom_rules_namespace_groupname|api_v1_rules|loki_api_v1_delete|loki_api_v1_detected_labels|loki_api_v1_index_stats|loki_api_v1_index_volume|loki_api_v1_index_volume_range|loki_api_v1_label_name_values|loki_api_v1_label_values|loki_api_v1_labels|loki_api_v1_patterns|loki_api_v1_query|loki_api_v1_query_range|loki_api_v1_series|prometheus_api_v1_rules)\"})) * 1e3",
                  "format": "time_series",
                  "legendFormat": "{{ route }} 99th percentile",
                  "refId": "A"
                },
                {
                  "expr": "histogram_quantile(0.50, sum by (le,route) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-read\", route=~\"(api_prom_rules|api_prom_rules_namespace_groupname|api_v1_rules|loki_api_v1_delete|loki_api_v1_detected_labels|loki_api_v1_index_stats|loki_api_v1_index_volume|loki_api_v1_index_volume_range|loki_api_v1_label_name_values|loki_api_v1_label_values|loki_api_v1_labels|loki_api_v1_patterns|loki_api_v1_query|loki_api_v1_query_range|loki_api_v1_series|prometheus_api_v1_rules)\"})) * 1e3",
                  "format": "time_series",
                  "legendFormat": "{{ route }} 50th percentile",
                  "refId": "B"
                },
                {
                  "expr": "1e3 * sum(cluster_job_route:loki_request_duration_seconds_sum:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-read\", route=~\"(api_prom_rules|api_prom_rules_namespace_groupname|api_v1_rules|loki_api_v1_delete|loki_api_v1_detected_labels|loki_api_v1_index_stats|loki_api_v1_index_volume|loki_api_v1_index_volume_range|loki_api_v1_label_name_values|loki_api_v1_label_values|loki_api_v1_labels|loki_api_v1_patterns|loki_api_v1_query|loki_api_v1_query_range|loki_api_v1_series|prometheus_api_v1_rules)\"}) by (route)  / sum(cluster_job_route:loki_request_duration_seconds_count:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-read\", route=~\"(api_prom_rules|api_prom_rules_namespace_groupname|api_v1_rules|loki_api_v1_delete|loki_api_v1_detected_labels|loki_api_v1_index_stats|loki_api_v1_index_volume|loki_api_v1_index_volume_range|loki_api_v1_label_name_values|loki_api_v1_label_values|loki_api_v1_labels|loki_api_v1_patterns|loki_api_v1_query|loki_api_v1_query_range|loki_api_v1_series|prometheus_api_v1_rules)\"}) by (route) ",
                  "format": "time_series",
                  "legendFormat": "{{ route }} Average",
                  "refId": "C"
                }
              ],
              "title": "Latency",
              "type": "timeseries",
              "yaxes": [
                {
                  "format": "ms",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": false
                }
              ]
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "ms"
                },
                "overrides": []
              },
              "id": 3,
              "links": [],
              "nullPointMode": "null as zero",
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "histogram_quantile(0.99, sum(rate(loki_request_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-read\", route=~\"(api_prom_rules|api_prom_rules_namespace_groupname|api_v1_rules|loki_api_v1_delete|loki_api_v1_detected_labels|loki_api_v1_index_stats|loki_api_v1_index_volume|loki_api_v1_index_volume_range|loki_api_v1_label_name_values|loki_api_v1_label_values|loki_api_v1_labels|loki_api_v1_patterns|loki_api_v1_query|loki_api_v1_query_range|loki_api_v1_series|prometheus_api_v1_rules)\"}[$__rate_interval])) by (le,pod)) * 1e3",
                  "format": "time_series",
                  "interval": "1m",
                  "intervalFactor": 2,
                  "legendFormat": "__auto",
                  "refId": "A",
                  "step": 10
                }
              ],
              "title": "Per Pod Latency (p99)",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Read Path",
          "titleSize": "h6"
        }
      ],
      "schemaVersion": 14,
      "style": "dark",
      "tags": [
        "loki"
      ],
      "templating": {
        "list": [
          {
            "current": {
              "text": "default",
              "value": "default"
            },
            "hide": 0,
            "label": "Data source",
            "name": "datasource",
            "options": [],
            "query": "prometheus",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "cluster",
            "multi": false,
            "name": "cluster",
            "options": [],
            "query": "label_values(loki_build_info, cluster)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "namespace",
            "multi": false,
            "name": "namespace",
            "options": [],
            "query": "label_values(loki_build_info{cluster=~\"$cluster\"}, namespace)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          }
        ]
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "utc",
      "title": "Loki / Reads",
      "uid": "reads",
      "version": 0
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-loki-resources-overview
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Loki"
  resyncPeriod: 24h
  json: |
    {
      "annotations": {
        "list": []
      },
      "editable": true,
      "gnetId": null,
      "graphTooltip": 0,
      "hideControls": false,
      "links": [
        {
          "asDropdown": true,
          "icon": "external link",
          "includeVars": true,
          "keepTime": true,
          "tags": [
            "loki"
          ],
          "targetBlank": false,
          "title": "Loki Dashboards",
          "type": "dashboards"
        }
      ],
      "refresh": "10s",
      "rows": [
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": [
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "request"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#FFC000",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "limit"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#E02F44",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  }
                ]
              },
              "id": 1,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum by(pod) (rate(container_cpu_usage_seconds_total{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-read.*\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                },
                {
                  "expr": "min(kube_pod_container_resource_requests{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-read.*\", resource=\"cpu\"} > 0)",
                  "format": "time_series",
                  "legendFormat": "request",
                  "legendLink": null
                },
                {
                  "expr": "min(container_spec_cpu_quota{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-read.*\"} / container_spec_cpu_period{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-read.*\"})",
                  "format": "time_series",
                  "legendFormat": "limit",
                  "legendLink": null
                }
              ],
              "title": "CPU",
              "tooltip": {
                "sort": 2
              },
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "bytes"
                },
                "overrides": [
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "request"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#FFC000",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "limit"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#E02F44",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  }
                ]
              },
              "id": 2,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "max by(pod) (container_memory_working_set_bytes{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-read.*\"})",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                },
                {
                  "expr": "min(kube_pod_container_resource_requests{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-read.*\", resource=\"memory\"} > 0)",
                  "format": "time_series",
                  "legendFormat": "request",
                  "legendLink": null
                },
                {
                  "expr": "min(container_spec_memory_limit_bytes{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-read.*\"} > 0)",
                  "format": "time_series",
                  "legendFormat": "limit",
                  "legendLink": null
                }
              ],
              "title": "Memory (workingset)",
              "tooltip": {
                "sort": 2
              },
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "bytes"
                },
                "overrides": []
              },
              "id": 3,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum by(pod) (go_memstats_heap_inuse_bytes{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-read\"})",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                }
              ],
              "title": "Memory (go heap inuse)",
              "tooltip": {
                "sort": 2
              },
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Read path",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 4,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 3,
              "targets": [
                {
                  "expr": "sum by(pod) (loki_write_memory_streams{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-write\"})",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                }
              ],
              "title": "In-memory streams",
              "tooltip": {
                "sort": 2
              },
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": [
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "request"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#FFC000",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "limit"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#E02F44",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  }
                ]
              },
              "id": 5,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 3,
              "targets": [
                {
                  "expr": "sum by(pod) (rate(container_cpu_usage_seconds_total{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-write.*\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                },
                {
                  "expr": "min(kube_pod_container_resource_requests{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-write.*\", resource=\"cpu\"} > 0)",
                  "format": "time_series",
                  "legendFormat": "request",
                  "legendLink": null
                },
                {
                  "expr": "min(container_spec_cpu_quota{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-write.*\"} / container_spec_cpu_period{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-write.*\"})",
                  "format": "time_series",
                  "legendFormat": "limit",
                  "legendLink": null
                }
              ],
              "title": "CPU",
              "tooltip": {
                "sort": 2
              },
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "bytes"
                },
                "overrides": [
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "request"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#FFC000",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "limit"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#E02F44",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  }
                ]
              },
              "id": 6,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 3,
              "targets": [
                {
                  "expr": "max by(pod) (container_memory_working_set_bytes{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-write.*\"})",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                },
                {
                  "expr": "min(kube_pod_container_resource_requests{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-write.*\", resource=\"memory\"} > 0)",
                  "format": "time_series",
                  "legendFormat": "request",
                  "legendLink": null
                },
                {
                  "expr": "min(container_spec_memory_limit_bytes{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-write.*\"} > 0)",
                  "format": "time_series",
                  "legendFormat": "limit",
                  "legendLink": null
                }
              ],
              "title": "Memory (workingset)",
              "tooltip": {
                "sort": 2
              },
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "bytes"
                },
                "overrides": []
              },
              "id": 7,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 3,
              "targets": [
                {
                  "expr": "sum by(pod) (go_memstats_heap_inuse_bytes{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-write\"})",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                }
              ],
              "title": "Memory (go heap inuse)",
              "tooltip": {
                "sort": 2
              },
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Write path",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 100,
                    "lineWidth": 0,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "normal"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "Bps"
                },
                "overrides": []
              },
              "id": 8,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum by(instance, device) (rate(node_disk_written_bytes_total[$__rate_interval])) + ignoring(pod) group_right() (label_replace(count by(instance, pod, device) (container_fs_writes_bytes_total{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-write.*\", device!~\".*sda.*\"}), \"device\", \"$1\", \"device\", \"/dev/(.*)\") * 0)\n",
                  "format": "time_series",
                  "legendFormat": "{{pod}} - {{device}}",
                  "legendLink": null
                }
              ],
              "title": "Disk Writes",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 100,
                    "lineWidth": 0,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "normal"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "Bps"
                },
                "overrides": []
              },
              "id": 9,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum by(instance, device) (rate(node_disk_read_bytes_total[$__rate_interval])) + ignoring(pod) group_right() (label_replace(count by(instance, pod, device) (container_fs_writes_bytes_total{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-write.*\", device!~\".*sda.*\"}), \"device\", \"$1\", \"device\", \"/dev/(.*)\") * 0)\n",
                  "format": "time_series",
                  "legendFormat": "{{pod}} - {{device}}",
                  "legendLink": null
                }
              ],
              "title": "Disk Reads",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "percentunit"
                },
                "overrides": []
              },
              "id": 10,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "max by(persistentvolumeclaim) (kubelet_volume_stats_used_bytes{cluster=~\"$cluster\", namespace=~\"$namespace\", persistentvolumeclaim=~\".*loki.*-write.*\"} / kubelet_volume_stats_capacity_bytes{cluster=~\"$cluster\", namespace=~\"$namespace\", persistentvolumeclaim=~\".*loki.*-write.*\"})",
                  "format": "time_series",
                  "legendFormat": "{{persistentvolumeclaim}}",
                  "legendLink": null
                }
              ],
              "title": "Disk Space Utilization",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": [
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "request"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#FFC000",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "limit"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#E02F44",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  }
                ]
              },
              "id": 11,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum by(pod) (rate(container_cpu_usage_seconds_total{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-backend.*\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                },
                {
                  "expr": "min(kube_pod_container_resource_requests{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-backend.*\", resource=\"cpu\"} > 0)",
                  "format": "time_series",
                  "legendFormat": "request",
                  "legendLink": null
                },
                {
                  "expr": "min(container_spec_cpu_quota{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-backend.*\"} / container_spec_cpu_period{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-backend.*\"})",
                  "format": "time_series",
                  "legendFormat": "limit",
                  "legendLink": null
                }
              ],
              "title": "CPU",
              "tooltip": {
                "sort": 2
              },
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "bytes"
                },
                "overrides": [
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "request"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#FFC000",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "limit"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#E02F44",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  }
                ]
              },
              "id": 12,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "max by(pod) (container_memory_working_set_bytes{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-backend.*\"})",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                },
                {
                  "expr": "min(kube_pod_container_resource_requests{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-backend.*\", resource=\"memory\"} > 0)",
                  "format": "time_series",
                  "legendFormat": "request",
                  "legendLink": null
                },
                {
                  "expr": "min(container_spec_memory_limit_bytes{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-backend.*\"} > 0)",
                  "format": "time_series",
                  "legendFormat": "limit",
                  "legendLink": null
                }
              ],
              "title": "Memory (workingset)",
              "tooltip": {
                "sort": 2
              },
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "bytes"
                },
                "overrides": []
              },
              "id": 13,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum by(pod) (go_memstats_heap_inuse_bytes{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-backend\"})",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                }
              ],
              "title": "Memory (go heap inuse)",
              "tooltip": {
                "sort": 2
              },
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Backend path",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 100,
                    "lineWidth": 0,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "normal"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "Bps"
                },
                "overrides": []
              },
              "id": 14,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum by(instance, device) (rate(node_disk_written_bytes_total[$__rate_interval])) + ignoring(pod) group_right() (label_replace(count by(instance, pod, device) (container_fs_writes_bytes_total{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-backend.*\", device!~\".*sda.*\"}), \"device\", \"$1\", \"device\", \"/dev/(.*)\") * 0)\n",
                  "format": "time_series",
                  "legendFormat": "{{pod}} - {{device}}",
                  "legendLink": null
                }
              ],
              "title": "Disk Writes",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 100,
                    "lineWidth": 0,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "normal"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "Bps"
                },
                "overrides": []
              },
              "id": 15,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum by(instance, device) (rate(node_disk_read_bytes_total[$__rate_interval])) + ignoring(pod) group_right() (label_replace(count by(instance, pod, device) (container_fs_writes_bytes_total{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-backend.*\", device!~\".*sda.*\"}), \"device\", \"$1\", \"device\", \"/dev/(.*)\") * 0)\n",
                  "format": "time_series",
                  "legendFormat": "{{pod}} - {{device}}",
                  "legendLink": null
                }
              ],
              "title": "Disk Reads",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "percentunit"
                },
                "overrides": []
              },
              "id": 16,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "max by(persistentvolumeclaim) (kubelet_volume_stats_used_bytes{cluster=~\"$cluster\", namespace=~\"$namespace\", persistentvolumeclaim=~\".*loki.*-backend.*\"} / kubelet_volume_stats_capacity_bytes{cluster=~\"$cluster\", namespace=~\"$namespace\", persistentvolumeclaim=~\".*loki.*-backend.*\"})",
                  "format": "time_series",
                  "legendFormat": "{{persistentvolumeclaim}}",
                  "legendLink": null
                }
              ],
              "title": "Disk Space Utilization",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "",
          "titleSize": "h6"
        }
      ],
      "schemaVersion": 14,
      "style": "dark",
      "tags": [
        "loki"
      ],
      "templating": {
        "list": [
          {
            "current": {
              "text": "default",
              "value": "default"
            },
            "hide": 0,
            "label": "Data source",
            "name": "datasource",
            "options": [],
            "query": "prometheus",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "cluster",
            "multi": false,
            "name": "cluster",
            "options": [],
            "query": "label_values(loki_build_info, cluster)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "namespace",
            "multi": false,
            "name": "namespace",
            "options": [],
            "query": "label_values(loki_build_info{cluster=~\"$cluster\"}, namespace)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          }
        ]
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "utc",
      "title": "Loki / Resources Overview",
      "uid": "resources-overview",
      "version": 0
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-loki-retention
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Loki"
  resyncPeriod: 24h
  json: |
    {
      "annotations": {
        "list": []
      },
      "editable": true,
      "gnetId": null,
      "graphTooltip": 0,
      "hideControls": false,
      "links": [
        {
          "asDropdown": true,
          "icon": "external link",
          "includeVars": true,
          "keepTime": true,
          "tags": [
            "loki"
          ],
          "targetBlank": false,
          "title": "Loki Dashboards",
          "type": "dashboards"
        }
      ],
      "refresh": "10s",
      "rows": [
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": [
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "request"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#FFC000",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "limit"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#E02F44",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  }
                ]
              },
              "id": 1,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum by(pod) (rate(container_cpu_usage_seconds_total{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-read.*\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                },
                {
                  "expr": "min(kube_pod_container_resource_requests{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-read.*\", resource=\"cpu\"} > 0)",
                  "format": "time_series",
                  "legendFormat": "request",
                  "legendLink": null
                },
                {
                  "expr": "min(container_spec_cpu_quota{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-read.*\"} / container_spec_cpu_period{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-read.*\"})",
                  "format": "time_series",
                  "legendFormat": "limit",
                  "legendLink": null
                }
              ],
              "title": "CPU",
              "tooltip": {
                "sort": 2
              },
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "bytes"
                },
                "overrides": [
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "request"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#FFC000",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "limit"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#E02F44",
                          "mode": "fixed"
                        }
                      },
                      {
                        "id": "custom.fillOpacity",
                        "value": 0
                      }
                    ]
                  }
                ]
              },
              "id": 2,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "max by(pod) (container_memory_working_set_bytes{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-read.*\"})",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                },
                {
                  "expr": "min(kube_pod_container_resource_requests{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-read.*\", resource=\"memory\"} > 0)",
                  "format": "time_series",
                  "legendFormat": "request",
                  "legendLink": null
                },
                {
                  "expr": "min(container_spec_memory_limit_bytes{cluster=~\"$cluster\", namespace=~\"$namespace\", container=\"loki\", pod=~\"loki.*-read.*\"} > 0)",
                  "format": "time_series",
                  "legendFormat": "limit",
                  "legendLink": null
                }
              ],
              "title": "Memory (workingset)",
              "tooltip": {
                "sort": 2
              },
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "bytes"
                },
                "overrides": []
              },
              "id": 3,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum by(pod) (go_memstats_heap_inuse_bytes{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-backend\"})",
                  "format": "time_series",
                  "legendFormat": "{{pod}}",
                  "legendLink": null
                }
              ],
              "title": "Memory (go heap inuse)",
              "tooltip": {
                "sort": 2
              },
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Resource Usage",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "fixedColor": "blue",
                    "mode": "fixed"
                  },
                  "custom": {},
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green",
                        "value": null
                      }
                    ]
                  },
                  "unit": "dateTimeFromNow"
                }
              },
              "fill": 1,
              "id": 4,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": true,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null as zero",
              "options": {
                "colorMode": "value",
                "graphMode": "area",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "fields": "",
                  "values": false
                },
                "text": {},
                "textMode": "auto"
              },
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 6,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "loki_boltdb_shipper_compact_tables_operation_last_successful_run_timestamp_seconds{cluster=~\"$cluster\", namespace=~\"$namespace\"} * 1e3",
                  "format": "time_series",
                  "instant": true,
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Last Compact Tables Operation Success",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "stat",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": false
                }
              ]
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "s"
                },
                "overrides": []
              },
              "id": 5,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "loki_boltdb_shipper_compact_tables_operation_duration_seconds{cluster=~\"$cluster\", namespace=~\"$namespace\"}",
                  "format": "time_series",
                  "legendFormat": "duration",
                  "legendLink": null
                }
              ],
              "title": "Compact Tables Operations Duration",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Compaction",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 6,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "sum(loki_compactor_locked_table_successive_compaction_skips{cluster=~\"$cluster\", namespace=~\"$namespace\"})",
                  "format": "time_series",
                  "legendFormat": "{{table_name}}",
                  "legendLink": null
                }
              ],
              "title": "Number of times Tables were skipped during Compaction",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 7,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "sum by (status)(rate(loki_boltdb_shipper_compact_tables_operation_total{cluster=~\"$cluster\", namespace=~\"$namespace\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "{{success}}",
                  "legendLink": null
                }
              ],
              "title": "Compact Tables Operations Per Status",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "aliasColors": {},
              "bars": false,
              "dashLength": 10,
              "dashes": false,
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "color": {
                    "fixedColor": "blue",
                    "mode": "fixed"
                  },
                  "custom": {},
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green",
                        "value": null
                      }
                    ]
                  },
                  "unit": "dateTimeFromNow"
                }
              },
              "fill": 1,
              "id": 8,
              "legend": {
                "avg": false,
                "current": false,
                "max": false,
                "min": false,
                "show": true,
                "total": false,
                "values": false
              },
              "lines": true,
              "linewidth": 1,
              "links": [],
              "nullPointMode": "null as zero",
              "options": {
                "colorMode": "value",
                "graphMode": "area",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                  "calcs": [
                    "lastNotNull"
                  ],
                  "fields": "",
                  "values": false
                },
                "text": {},
                "textMode": "auto"
              },
              "percentage": false,
              "pointradius": 5,
              "points": false,
              "renderer": "flot",
              "seriesOverrides": [],
              "spaceLength": 10,
              "span": 4,
              "stack": false,
              "steppedLine": false,
              "targets": [
                {
                  "expr": "loki_compactor_apply_retention_last_successful_run_timestamp_seconds{cluster=~\"$cluster\", namespace=~\"$namespace\"} * 1e3",
                  "format": "time_series",
                  "instant": true,
                  "refId": "A"
                }
              ],
              "thresholds": [],
              "timeFrom": null,
              "timeShift": null,
              "title": "Last Mark Operation Success",
              "tooltip": {
                "shared": true,
                "sort": 2,
                "value_type": "individual"
              },
              "type": "stat",
              "xaxis": {
                "buckets": null,
                "mode": "time",
                "name": null,
                "show": true,
                "values": []
              },
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": false
                }
              ]
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "s"
                },
                "overrides": []
              },
              "id": 9,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "loki_compactor_apply_retention_operation_duration_seconds{cluster=~\"$cluster\", namespace=~\"$namespace\"}",
                  "format": "time_series",
                  "legendFormat": "duration",
                  "legendLink": null
                }
              ],
              "title": "Mark Operations Duration",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 10,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum by (status)(rate(loki_compactor_apply_retention_operation_total{cluster=~\"$cluster\", namespace=~\"$namespace\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "{{success}}",
                  "legendLink": null
                }
              ],
              "title": "Mark Operations Per Status",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Retention",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 100,
                    "lineWidth": 0,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "normal"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 11,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "count by(action)(loki_boltdb_shipper_retention_marker_table_processed_total{cluster=~\"$cluster\", namespace=~\"$namespace\"})",
                  "format": "time_series",
                  "legendFormat": "{{action}}",
                  "legendLink": null
                }
              ],
              "title": "Processed Tables Per Action",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 100,
                    "lineWidth": 0,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "normal"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 12,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "count by(table,action)(loki_boltdb_shipper_retention_marker_table_processed_total{cluster=~\"$cluster\", namespace=~\"$namespace\" , action=~\"modified|deleted\"})",
                  "format": "time_series",
                  "legendFormat": "{{table}}-{{action}}",
                  "legendLink": null
                }
              ],
              "title": "Modified Tables",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 100,
                    "lineWidth": 0,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "normal"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 13,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum by (table)(rate(loki_boltdb_shipper_retention_marker_count_total{cluster=~\"$cluster\", namespace=~\"$namespace\"}[$__rate_interval])) >0",
                  "format": "time_series",
                  "legendFormat": "{{table}}",
                  "legendLink": null
                }
              ],
              "title": "Marks Creation Rate Per Table",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Per Table Marker",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "format": "short",
              "id": 14,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "sum (increase(loki_boltdb_shipper_retention_marker_count_total{cluster=~\"$cluster\", namespace=~\"$namespace\"}[24h]))",
                  "format": "time_series",
                  "instant": true,
                  "refId": "A"
                }
              ],
              "thresholds": "70,80",
              "title": "Marked Chunks (24h)",
              "type": "singlestat"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 15,
              "links": [],
              "nullPointMode": "null as zero",
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "histogram_quantile(0.99, sum(rate(loki_boltdb_shipper_retention_marker_table_processed_duration_seconds_bucket{cluster=~\"$cluster\", namespace=~\"$namespace\"}[$__rate_interval])) by (le)) * 1e3",
                  "format": "time_series",
                  "legendFormat": "99th Percentile",
                  "refId": "A"
                },
                {
                  "expr": "histogram_quantile(0.50, sum(rate(loki_boltdb_shipper_retention_marker_table_processed_duration_seconds_bucket{cluster=~\"$cluster\", namespace=~\"$namespace\"}[$__rate_interval])) by (le)) * 1e3",
                  "format": "time_series",
                  "legendFormat": "50th Percentile",
                  "refId": "B"
                },
                {
                  "expr": "sum(rate(loki_boltdb_shipper_retention_marker_table_processed_duration_seconds_sum{cluster=~\"$cluster\", namespace=~\"$namespace\"}[$__rate_interval])) * 1e3 / sum(rate(loki_boltdb_shipper_retention_marker_table_processed_duration_seconds_count{cluster=~\"$cluster\", namespace=~\"$namespace\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "Average",
                  "refId": "C"
                }
              ],
              "title": "Mark Table Latency",
              "type": "timeseries",
              "yaxes": [
                {
                  "format": "ms",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": false
                }
              ]
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "format": "short",
              "id": 16,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "sum (increase(loki_boltdb_shipper_retention_sweeper_chunk_deleted_duration_seconds_count{cluster=~\"$cluster\", namespace=~\"$namespace\"}[24h]))",
                  "format": "time_series",
                  "instant": true,
                  "refId": "A"
                }
              ],
              "thresholds": "70,80",
              "title": "Delete Chunks (24h)",
              "type": "singlestat"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 17,
              "links": [],
              "nullPointMode": "null as zero",
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "histogram_quantile(0.99, sum(rate(loki_boltdb_shipper_retention_sweeper_chunk_deleted_duration_seconds_bucket{cluster=~\"$cluster\", namespace=~\"$namespace\"}[$__rate_interval])) by (le)) * 1e3",
                  "format": "time_series",
                  "legendFormat": "99th Percentile",
                  "refId": "A"
                },
                {
                  "expr": "histogram_quantile(0.50, sum(rate(loki_boltdb_shipper_retention_sweeper_chunk_deleted_duration_seconds_bucket{cluster=~\"$cluster\", namespace=~\"$namespace\"}[$__rate_interval])) by (le)) * 1e3",
                  "format": "time_series",
                  "legendFormat": "50th Percentile",
                  "refId": "B"
                },
                {
                  "expr": "sum(rate(loki_boltdb_shipper_retention_sweeper_chunk_deleted_duration_seconds_sum{cluster=~\"$cluster\", namespace=~\"$namespace\"}[$__rate_interval])) * 1e3 / sum(rate(loki_boltdb_shipper_retention_sweeper_chunk_deleted_duration_seconds_count{cluster=~\"$cluster\", namespace=~\"$namespace\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "Average",
                  "refId": "C"
                }
              ],
              "title": "Delete Latency",
              "type": "timeseries",
              "yaxes": [
                {
                  "format": "ms",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": false
                }
              ]
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Sweeper",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "s"
                },
                "overrides": []
              },
              "id": 18,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "time() - (loki_boltdb_shipper_retention_sweeper_marker_file_processing_current_time{cluster=~\"$cluster\", namespace=~\"$namespace\"} > 0)",
                  "format": "time_series",
                  "legendFormat": "lag",
                  "legendLink": null
                }
              ],
              "title": "Sweeper Lag",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 19,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum(loki_boltdb_shipper_retention_sweeper_marker_files_current{cluster=~\"$cluster\", namespace=~\"$namespace\"})",
                  "format": "time_series",
                  "legendFormat": "count",
                  "legendLink": null
                }
              ],
              "title": "Marks Files to Process",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 20,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "sum by (status)(rate(loki_boltdb_shipper_retention_sweeper_chunk_deleted_duration_seconds_count{cluster=~\"$cluster\", namespace=~\"$namespace\"}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "{{status}}",
                  "legendLink": null
                }
              ],
              "title": "Delete Rate Per Status",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$loki_datasource",
              "id": 21,
              "span": 12,
              "targets": [
                {
                  "expr": "{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-backend\"}",
                  "refId": "A"
                }
              ],
              "title": "Compactor Logs",
              "type": "logs"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Logs",
          "titleSize": "h6"
        }
      ],
      "schemaVersion": 14,
      "style": "dark",
      "tags": [
        "loki"
      ],
      "templating": {
        "list": [
          {
            "current": {
              "text": "default",
              "value": "default"
            },
            "hide": 0,
            "label": "Data source",
            "name": "datasource",
            "options": [],
            "query": "prometheus",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "cluster",
            "multi": false,
            "name": "cluster",
            "options": [],
            "query": "label_values(loki_build_info, cluster)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "namespace",
            "multi": false,
            "name": "namespace",
            "options": [],
            "query": "label_values(loki_build_info{cluster=~\"$cluster\"}, namespace)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "hide": 0,
            "label": null,
            "name": "loki_datasource",
            "options": [],
            "query": "loki",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
          }
        ]
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "utc",
      "title": "Loki / Retention",
      "uid": "retention",
      "version": 0
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-loki-writes
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Loki"
  resyncPeriod: 24h
  json: |
    {
      "annotations": {
        "list": []
      },
      "editable": true,
      "gnetId": null,
      "graphTooltip": 0,
      "hideControls": false,
      "links": [
        {
          "asDropdown": true,
          "icon": "external link",
          "includeVars": true,
          "keepTime": true,
          "tags": [
            "loki"
          ],
          "targetBlank": false,
          "title": "Loki Dashboards",
          "type": "dashboards"
        }
      ],
      "refresh": "10s",
      "rows": [
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "aliasColors": {
                "1xx": "#EAB839",
                "2xx": "#7EB26D",
                "3xx": "#6ED0E0",
                "4xx": "#EF843C",
                "5xx": "#E24D42",
                "OK": "#7EB26D",
                "cancel": "#A9A9A9",
                "error": "#E24D42",
                "success": "#7EB26D"
              },
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 100,
                    "lineWidth": 0,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "normal"
                    }
                  },
                  "min": 0,
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": [
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "1xx"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#EAB839",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "2xx"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#7EB26D",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "3xx"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#6ED0E0",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "4xx"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#EF843C",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "5xx"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#E24D42",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "OK"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#7EB26D",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "cancel"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#A9A9A9",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "error"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#E24D42",
                          "mode": "fixed"
                        }
                      }
                    ]
                  },
                  {
                    "matcher": {
                      "id": "byName",
                      "options": "success"
                    },
                    "properties": [
                      {
                        "id": "color",
                        "value": {
                          "fixedColor": "#7EB26D",
                          "mode": "fixed"
                        }
                      }
                    ]
                  }
                ]
              },
              "fill": 10,
              "id": 1,
              "linewidth": 0,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "stack": true,
              "targets": [
                {
                  "expr": "sum by (status) (\n  label_replace(label_replace(rate(loki_request_duration_seconds_count{cluster=~\"$cluster\",job=~\"($namespace)/loki.*-write\", route=~\"api_prom_push|loki_api_v1_push|otlp_v1_logs|/httpgrpc.HTTP/Handle\"}[$__rate_interval]),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n  \"status\", \"${1}\", \"status_code\", \"([a-zA-Z_]+)\"))\n",
                  "format": "time_series",
                  "legendFormat": "{{status}}",
                  "refId": "A"
                }
              ],
              "title": "QPS",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "ms"
                },
                "overrides": []
              },
              "id": 2,
              "links": [],
              "nullPointMode": "null as zero",
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "histogram_quantile(0.99, sum by (le) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-write\", route=~\"api_prom_push|loki_api_v1_push|otlp_v1_logs|/httpgrpc.HTTP/Handle\"})) * 1e3",
                  "format": "time_series",
                  "legendFormat": "99th percentile",
                  "refId": "A"
                },
                {
                  "expr": "histogram_quantile(0.50, sum by (le) (cluster_job_route:loki_request_duration_seconds_bucket:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-write\", route=~\"api_prom_push|loki_api_v1_push|otlp_v1_logs|/httpgrpc.HTTP/Handle\"})) * 1e3",
                  "format": "time_series",
                  "legendFormat": "50th percentile",
                  "refId": "B"
                },
                {
                  "expr": "1e3 * sum(cluster_job_route:loki_request_duration_seconds_sum:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-write\", route=~\"api_prom_push|loki_api_v1_push|otlp_v1_logs|/httpgrpc.HTTP/Handle\"}) / sum(cluster_job_route:loki_request_duration_seconds_count:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-write\", route=~\"api_prom_push|loki_api_v1_push|otlp_v1_logs|/httpgrpc.HTTP/Handle\"})",
                  "format": "time_series",
                  "legendFormat": "Average",
                  "refId": "C"
                }
              ],
              "title": "Latency",
              "type": "timeseries",
              "yaxes": [
                {
                  "format": "ms",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": null,
                  "min": null,
                  "show": false
                }
              ]
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "ms"
                },
                "overrides": []
              },
              "id": 3,
              "links": [],
              "nullPointMode": "null as zero",
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 4,
              "targets": [
                {
                  "expr": "histogram_quantile(0.99, sum(rate(loki_request_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/loki.*-write\", route=~\"api_prom_push|loki_api_v1_push|otlp_v1_logs|/httpgrpc.HTTP/Handle\"}[$__rate_interval])) by (le,pod)) * 1e3",
                  "format": "time_series",
                  "interval": "1m",
                  "intervalFactor": 2,
                  "legendFormat": "__auto",
                  "refId": "A",
                  "step": 10
                }
              ],
              "title": "Per Pod Latency (p99)",
              "type": "timeseries"
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Write Path",
          "titleSize": "h6"
        },
        {
          "collapse": false,
          "height": "250px",
          "panels": [
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 4,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "targets": [
                {
                  "expr": "sum (rate(loki_distributor_structured_metadata_bytes_received_total{cluster=~\"$cluster\",job=~\"($namespace)/loki.*-write\",}[$__rate_interval])) / sum(rate(loki_distributor_bytes_received_total{cluster=~\"$cluster\",job=~\"($namespace)/loki.*-write\",}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "bytes",
                  "legendLink": null
                }
              ],
              "title": "Per Total Received Bytes",
              "type": "timeseries"
            },
            {
              "datasource": "$datasource",
              "fieldConfig": {
                "defaults": {
                  "custom": {
                    "drawStyle": "line",
                    "fillOpacity": 10,
                    "lineWidth": 1,
                    "pointSize": 5,
                    "showPoints": "never",
                    "spanNulls": false,
                    "stacking": {
                      "group": "A",
                      "mode": "none"
                    }
                  },
                  "thresholds": {
                    "mode": "absolute",
                    "steps": []
                  },
                  "unit": "short"
                },
                "overrides": []
              },
              "id": 5,
              "links": [],
              "options": {
                "legend": {
                  "showLegend": true
                },
                "tooltip": {
                  "mode": "single",
                  "sort": "none"
                }
              },
              "span": 6,
              "stack": true,
              "targets": [
                {
                  "expr": "sum by (tenant) (rate(loki_distributor_structured_metadata_bytes_received_total{cluster=~\"$cluster\",job=~\"($namespace)/loki.*-write\",}[$__rate_interval])) / ignoring(tenant) group_left sum(rate(loki_distributor_structured_metadata_bytes_received_total{cluster=~\"$cluster\",job=~\"($namespace)/loki.*-write\",}[$__rate_interval]))",
                  "format": "time_series",
                  "legendFormat": "{{tenant}}",
                  "legendLink": null
                }
              ],
              "title": "Per Tenant",
              "type": "timeseries",
              "yaxes": [
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": 1,
                  "min": 0,
                  "show": true
                },
                {
                  "format": "short",
                  "label": null,
                  "logBase": 1,
                  "max": 1,
                  "min": null,
                  "show": false
                }
              ]
            }
          ],
          "repeat": null,
          "repeatIteration": null,
          "repeatRowId": null,
          "showTitle": true,
          "title": "Write Path - Structured Metadata",
          "titleSize": "h6"
        }
      ],
      "schemaVersion": 14,
      "style": "dark",
      "tags": [
        "loki"
      ],
      "templating": {
        "list": [
          {
            "current": {
              "text": "default",
              "value": "default"
            },
            "hide": 0,
            "label": "Data source",
            "name": "datasource",
            "options": [],
            "query": "prometheus",
            "refresh": 1,
            "regex": "",
            "type": "datasource"
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "cluster",
            "multi": false,
            "name": "cluster",
            "options": [],
            "query": "label_values(loki_build_info, cluster)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          },
          {
            "allValue": null,
            "current": {
              "text": "prod",
              "value": "prod"
            },
            "datasource": "$datasource",
            "hide": 0,
            "includeAll": false,
            "label": "namespace",
            "multi": false,
            "name": "namespace",
            "options": [],
            "query": "label_values(loki_build_info{cluster=~\"$cluster\"}, namespace)",
            "refresh": 1,
            "regex": "",
            "sort": 2,
            "tagValuesQuery": "",
            "tags": [],
            "tagsQuery": "",
            "type": "query",
            "useTags": false
          }
        ]
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {
        "refresh_intervals": [
          "5s",
          "10s",
          "30s",
          "1m",
          "5m",
          "15m",
          "30m",
          "1h",
          "2h",
          "1d"
        ],
        "time_options": [
          "5m",
          "15m",
          "1h",
          "6h",
          "12h",
          "24h",
          "2d",
          "7d",
          "30d"
        ]
      },
      "timezone": "utc",
      "title": "Loki / Writes",
      "uid": "writes",
      "version": 0
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-namespace-by-pod
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "displayName": "$namespace",
                        "max": 10000000000,
                        "min": 0,
                        "thresholds": {
                            "steps": [
                                {
                                    "color": "dark-green",
                                    "index": 0,
                                    "value": null
                                },
                                {
                                    "color": "dark-yellow",
                                    "index": 1,
                                    "value": 5000000000
                                },
                                {
                                    "color": "dark-red",
                                    "index": 2,
                                    "value": 7000000000
                                }
                            ]
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum (\n    rate(container_network_receive_bytes_total{cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Current Rate of Bytes Received",
                "type": "gauge"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "displayName": "$namespace",
                        "max": 10000000000,
                        "min": 0,
                        "thresholds": {
                            "steps": [
                                {
                                    "color": "dark-green",
                                    "index": 0,
                                    "value": null
                                },
                                {
                                    "color": "dark-yellow",
                                    "index": 1,
                                    "value": 5000000000
                                },
                                {
                                    "color": "dark-red",
                                    "index": 2,
                                    "value": 7000000000
                                }
                            ]
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 0
                },
                "id": 2,
                "interval": "1m",
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum (\n    rate(container_network_transmit_bytes_total{cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Current Rate of Bytes Transmitted",
                "type": "gauge"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Bandwidth/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "bps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Packets/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "pps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Pod"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down",
                                            "url": "/d/7a18067ce943a40ae25454675c19ff5c/kubernetes-networking-pod?${datasource:queryparam}&var-cluster=${cluster}&var-namespace=${namespace}&var-pod=${__data.fields.Pod}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 9,
                    "w": 24,
                    "x": 0,
                    "y": 9
                },
                "id": 3,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (pod) (\n    rate(container_network_receive_bytes_total{cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (pod) (\n    rate(container_network_transmit_bytes_total{cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (pod) (\n    rate(container_network_receive_packets_total{cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (pod) (\n    rate(container_network_transmit_packets_total{cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (pod) (\n    rate(container_network_receive_packets_dropped_total{cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (pod) (\n    rate(container_network_transmit_packets_dropped_total{cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n)\n",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Current Network Usage",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "pod",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Value #A": 7,
                                "Value #B": 8,
                                "Value #C": 9,
                                "Value #D": 10,
                                "Value #E": 11,
                                "Value #F": 12,
                                "pod": 6
                            },
                            "renameByName": {
                                "Value #A": "Current Receive Bandwidth",
                                "Value #B": "Current Transmit Bandwidth",
                                "Value #C": "Rate of Received Packets",
                                "Value #D": "Rate of Transmitted Packets",
                                "Value #E": "Rate of Received Packets Dropped",
                                "Value #F": "Rate of Transmitted Packets Dropped",
                                "pod": "Pod"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 18
                },
                "id": 4,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (pod) (\n    rate(container_network_receive_bytes_total{cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Receive Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 18
                },
                "id": 5,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (pod) (\n    rate(container_network_transmit_bytes_total{cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Transmit Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 27
                },
                "id": 6,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (pod) (\n    rate(container_network_receive_packets_total{cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 27
                },
                "id": 7,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (pod) (\n    rate(container_network_transmit_packets_total{cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 36
                },
                "id": 8,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (pod) (\n    rate(container_network_receive_packets_dropped_total{cluster=\"$cluster\",namespace!=\"\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets Dropped",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 36
                },
                "id": 9,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum by (pod) (\n    rate(container_network_transmit_packets_dropped_total{cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n  * on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n)\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets Dropped",
                "type": "timeseries"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(up{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "allValue": ".+",
                    "current": {
                        "selected": false,
                        "text": "kube-system",
                        "value": "kube-system"
                    },
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "includeAll": true,
                    "label": "namespace",
                    "name": "namespace",
                    "query": "label_values(container_network_receive_packets_total{cluster=\"$cluster\"}, namespace)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Networking / Namespace (Pods)",
        "uid": "8b7a8b326d7a6f1f04244066368c67af"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-namespace-by-workload
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "color": {
                            "fixedColor": "green",
                            "mode": "fixed"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "options": {
                    "displayMode": "basic",
                    "showUnfilled": false
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_receive_bytes_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n* on (cluster,namespace,pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Current Rate of Bytes Received",
                "type": "bargauge"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "color": {
                            "fixedColor": "green",
                            "mode": "fixed"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 0
                },
                "id": 2,
                "interval": "1m",
                "options": {
                    "displayMode": "basic",
                    "showUnfilled": false
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_transmit_bytes_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n* on (cluster,namespace,pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Current Rate of Bytes Transmitted",
                "type": "bargauge"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Bytes/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "bps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Packets/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "pps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Workload"
                            },
                            "properties": [
                                {
                                    "id": "links",
                                    "value": [
                                        {
                                            "title": "Drill down",
                                            "url": "/d/728bf77cc1166d2f3133bf25846876cc/kubernetes-networking-workload?${datasource:queryparam}&var-cluster=${cluster}&var-namespace=${namespace}&var-type=${__data.fields.Type}&var-workload=${__data.fields.Workload}"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 9,
                    "w": 24,
                    "x": 0,
                    "y": 9
                },
                "id": 3,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(\n  sum by (workload, workload_type) (\n    rate(container_network_receive_bytes_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n    * on (cluster, namespace, pod) group_left\n    kube_pod_info{cluster=\"$cluster\",namespace=\"$namespace\",host_network=\"false\"}\n    * on (cluster, namespace, pod) group_left (workload, workload_type)\n    namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}\n  )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(\n  sum by (workload, workload_type) (\n    rate(container_network_transmit_bytes_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n    * on (cluster, namespace, pod) group_left\n    kube_pod_info{cluster=\"$cluster\",namespace=\"$namespace\",host_network=\"false\"}\n    * on (cluster, namespace, pod) group_left (workload, workload_type)\n    namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}\n  )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(\n  avg by (workload, workload_type) (\n    rate(container_network_receive_bytes_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n    * on (cluster, namespace, pod) group_left\n    kube_pod_info{cluster=\"$cluster\",namespace=\"$namespace\",host_network=\"false\"}\n    * on (cluster, namespace, pod) group_left (workload, workload_type)\n    namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}\n  )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(\n  avg by (workload, workload_type) (\n    rate(container_network_transmit_bytes_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n    * on (cluster, namespace, pod) group_left\n    kube_pod_info{cluster=\"$cluster\",namespace=\"$namespace\",host_network=\"false\"}\n    * on (cluster, namespace, pod) group_left (workload, workload_type)\n    namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}\n  )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(\n  sum by (workload, workload_type) (\n    rate(container_network_receive_packets_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n    * on (cluster, namespace, pod) group_left\n    kube_pod_info{cluster=\"$cluster\",namespace=\"$namespace\",host_network=\"false\"}\n    * on (cluster, namespace, pod) group_left (workload, workload_type)\n    namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}\n  )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(\n  sum by (workload, workload_type) (\n    rate(container_network_transmit_packets_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n    * on (cluster, namespace, pod) group_left\n    kube_pod_info{cluster=\"$cluster\",namespace=\"$namespace\",host_network=\"false\"}\n    * on (cluster, namespace, pod) group_left (workload, workload_type)\n    namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}\n  )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(\n  sum by (workload, workload_type) (\n    rate(container_network_receive_packets_dropped_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n    * on (cluster, namespace, pod) group_left\n    kube_pod_info{cluster=\"$cluster\",namespace=\"$namespace\",host_network=\"false\"}\n    * on (cluster, namespace, pod) group_left (workload, workload_type)\n    namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}\n  )\n)\n",
                        "format": "table",
                        "instant": true
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(\n  sum by (workload, workload_type) (\n    rate(container_network_transmit_packets_dropped_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n    * on (cluster, namespace, pod) group_left\n    kube_pod_info{cluster=\"$cluster\",namespace=\"$namespace\",host_network=\"false\"}\n    * on (cluster, namespace, pod) group_left (workload, workload_type)\n    namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}\n  )\n)\n",
                        "format": "table",
                        "instant": true
                    }
                ],
                "title": "Current Status",
                "transformations": [
                    {
                        "id": "joinByField",
                        "options": {
                            "byField": "workload",
                            "mode": "outer"
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {
                                "Time": true,
                                "Time 1": true,
                                "Time 2": true,
                                "Time 3": true,
                                "Time 4": true,
                                "Time 5": true,
                                "Time 6": true,
                                "Time 7": true,
                                "Time 8": true,
                                "workload_type 2": true,
                                "workload_type 3": true,
                                "workload_type 4": true,
                                "workload_type 5": true,
                                "workload_type 6": true,
                                "workload_type 7": true,
                                "workload_type 8": true
                            },
                            "indexByName": {
                                "Time 1": 0,
                                "Time 2": 1,
                                "Time 3": 2,
                                "Time 4": 3,
                                "Time 5": 4,
                                "Time 6": 5,
                                "Time 7": 6,
                                "Time 8": 7,
                                "Value #A": 10,
                                "Value #B": 11,
                                "Value #C": 12,
                                "Value #D": 13,
                                "Value #E": 14,
                                "Value #F": 15,
                                "Value #G": 16,
                                "Value #H": 17,
                                "workload": 8,
                                "workload_type 1": 9,
                                "workload_type 2": 18,
                                "workload_type 3": 19,
                                "workload_type 4": 20,
                                "workload_type 5": 21,
                                "workload_type 6": 22,
                                "workload_type 7": 23,
                                "workload_type 8": 24
                            },
                            "renameByName": {
                                "Value #A": "Rx Bytes",
                                "Value #B": "Tx Bytes",
                                "Value #C": "Rx Bytes (Avg)",
                                "Value #D": "Tx Bytes (Avg)",
                                "Value #E": "Rx Packets",
                                "Value #F": "Tx Packets",
                                "Value #G": "Rx Packets Dropped",
                                "Value #H": "Tx Packets Dropped",
                                "workload": "Workload",
                                "workload_type 1": "Type"
                            }
                        }
                    }
                ],
                "type": "table"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 18
                },
                "id": 4,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_receive_bytes_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n* on (cluster,namespace,pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Receive Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 18
                },
                "id": 5,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_transmit_bytes_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n* on (cluster,namespace,pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Transmit Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 27
                },
                "id": 6,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(avg(rate(container_network_receive_bytes_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n* on (cluster,namespace,pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Average Container Bandwidth by Workload: Received",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 27
                },
                "id": 7,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(avg(rate(container_network_transmit_bytes_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n* on (cluster,namespace,pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Average Container Bandwidth by Workload: Transmitted",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 36
                },
                "id": 8,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_receive_packets_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n* on (cluster,namespace,pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 36
                },
                "id": 9,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_transmit_packets_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n* on (cluster,namespace,pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 45
                },
                "id": 10,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_receive_packets_dropped_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n* on (cluster,namespace,pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets Dropped",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 45
                },
                "id": 11,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_transmit_packets_dropped_total{cluster=\"$cluster\",namespace=\"$namespace\"}[$__rate_interval])\n* on (cluster,namespace,pod) group_left ()\n    topk by (cluster,namespace,pod) (\n      1,\n      max by (cluster,namespace,pod) (kube_pod_info{host_network=\"false\"})\n    )\n* on (cluster,namespace,pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=\"$namespace\", workload=~\".+\", workload_type=~\"$type\"}) by (workload))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets Dropped",
                "type": "timeseries"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(up{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "current": {
                        "selected": false,
                        "text": "kube-system",
                        "value": "kube-system"
                    },
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "namespace",
                    "name": "namespace",
                    "query": "label_values(container_network_receive_packets_total{cluster=\"$cluster\"}, namespace)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "includeAll": true,
                    "label": "workload_type",
                    "name": "type",
                    "query": "label_values(namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=\"$namespace\", workload=~\".+\"}, workload_type)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Networking / Namespace (Workload)",
        "uid": "bbb2a765a623ae38130206c7d94a160f"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-node-cluster-rsrc-use
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Node Exporter"
  resyncPeriod: 24h
  json: |
    {
        "graphTooltip": 1,
        "panels": [
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "panels": [

                ],
                "title": "CPU",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 1
                },
                "id": 2,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "((\n  instance:node_cpu_utilisation:rate5m{job=\"node-exporter\", cluster=\"$cluster\"}\n  *\n  instance:node_num_cpu:sum{job=\"node-exporter\", cluster=\"$cluster\"}\n) != 0 )\n/ scalar(sum(instance:node_num_cpu:sum{job=\"node-exporter\", cluster=\"$cluster\"}))\n",
                        "legendFormat": "{{ instance }}"
                    }
                ],
                "title": "CPU Utilisation",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 1
                },
                "id": 3,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "(\n  instance:node_load1_per_cpu:ratio{job=\"node-exporter\", cluster=\"$cluster\"}\n  / scalar(count(instance:node_load1_per_cpu:ratio{job=\"node-exporter\", cluster=\"$cluster\"}))\n)  != 0\n",
                        "legendFormat": "{{ instance }}"
                    }
                ],
                "title": "CPU Saturation (Load1 per CPU)",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 8
                },
                "id": 4,
                "panels": [

                ],
                "title": "Memory",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 9
                },
                "id": 5,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "(\n  instance:node_memory_utilisation:ratio{job=\"node-exporter\", cluster=\"$cluster\"}\n  / scalar(count(instance:node_memory_utilisation:ratio{job=\"node-exporter\", cluster=\"$cluster\"}))\n) != 0\n",
                        "legendFormat": "{{ instance }}"
                    }
                ],
                "title": "Memory Utilisation",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "rds"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 9
                },
                "id": 6,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance:node_vmstat_pgmajfault:rate5m{job=\"node-exporter\", cluster=\"$cluster\"}",
                        "legendFormat": "{{ instance }}"
                    }
                ],
                "title": "Memory Saturation (Major Page Faults)",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 16
                },
                "id": 7,
                "panels": [

                ],
                "title": "Network",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "Bps"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Transmit/"
                            },
                            "properties": [
                                {
                                    "id": "custom.transform",
                                    "value": "negative-Y"
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 17
                },
                "id": 8,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance:node_network_receive_bytes_excluding_lo:rate5m{job=\"node-exporter\", cluster=\"$cluster\"} != 0",
                        "legendFormat": "{{ instance }} Receive"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance:node_network_transmit_bytes_excluding_lo:rate5m{job=\"node-exporter\", cluster=\"$cluster\"} != 0",
                        "legendFormat": "{{ instance }} Transmit"
                    }
                ],
                "title": "Network Utilisation (Bytes Receive/Transmit)",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "Bps"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Transmit/"
                            },
                            "properties": [
                                {
                                    "id": "custom.transform",
                                    "value": "negative-Y"
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 17
                },
                "id": 9,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance:node_network_receive_drop_excluding_lo:rate5m{job=\"node-exporter\", cluster=\"$cluster\"}",
                        "legendFormat": "{{ instance }} Receive"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance:node_network_transmit_drop_excluding_lo:rate5m{job=\"node-exporter\", cluster=\"$cluster\"}",
                        "legendFormat": "{{ instance }} Transmit"
                    }
                ],
                "title": "Network Saturation (Drops Receive/Transmit)",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 24
                },
                "id": 10,
                "panels": [

                ],
                "title": "Disk IO",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 25
                },
                "id": 11,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance_device:node_disk_io_time_seconds:rate5m{job=\"node-exporter\", cluster=\"$cluster\"}\n/ scalar(count(instance_device:node_disk_io_time_seconds:rate5m{job=\"node-exporter\", cluster=\"$cluster\"}))\n",
                        "legendFormat": "{{ instance }} {{device}}"
                    }
                ],
                "title": "Disk IO Utilisation",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 25
                },
                "id": 12,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance_device:node_disk_io_time_weighted_seconds:rate5m{job=\"node-exporter\", cluster=\"$cluster\"}\n/ scalar(count(instance_device:node_disk_io_time_weighted_seconds:rate5m{job=\"node-exporter\", cluster=\"$cluster\"}))\n",
                        "legendFormat": "{{ instance }} {{device}}"
                    }
                ],
                "title": "Disk IO Saturation",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 34
                },
                "id": 13,
                "panels": [

                ],
                "title": "Disk Space",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 35
                },
                "id": 14,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "sum without (device) (\n  max without (fstype, mountpoint) ((\n    node_filesystem_size_bytes{job=\"node-exporter\", fstype!=\"\", mountpoint!=\"\", cluster=\"$cluster\"}\n    -\n    node_filesystem_avail_bytes{job=\"node-exporter\", fstype!=\"\", mountpoint!=\"\", cluster=\"$cluster\"}\n  ) != 0)\n)\n/ scalar(sum(max without (fstype, mountpoint) (node_filesystem_size_bytes{job=\"node-exporter\", fstype!=\"\", mountpoint!=\"\", cluster=\"$cluster\"})))\n",
                        "legendFormat": "{{ instance }}"
                    }
                ],
                "title": "Disk Space Utilisation",
                "type": "timeseries"
            }
        ],
        "refresh": "30s",
        "schemaVersion": 39,
        "tags": [
            "node-exporter-mixin"
        ],
        "templating": {
            "list": [
                {
                    "name": "datasource",
                    "query": "prometheus",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 2,
                    "includeAll": false,
                    "name": "cluster",
                    "query": "label_values(node_time_seconds, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "utc",
        "title": "Node Exporter / USE Method / Cluster",
        "uid": "3e97d1d02672cdd0861f4c97c64f89b2"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-node-rsrc-use
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Node Exporter"
  resyncPeriod: 24h
  json: |
    {
        "graphTooltip": 1,
        "panels": [
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "panels": [

                ],
                "title": "CPU",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 1
                },
                "id": 2,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance:node_cpu_utilisation:rate5m{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"} != 0",
                        "legendFormat": "Utilisation"
                    }
                ],
                "title": "CPU Utilisation",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 1
                },
                "id": 3,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance:node_load1_per_cpu:ratio{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"} != 0",
                        "legendFormat": "Saturation"
                    }
                ],
                "title": "CPU Saturation (Load1 per CPU)",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 8
                },
                "id": 4,
                "panels": [

                ],
                "title": "Memory",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 9
                },
                "id": 5,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance:node_memory_utilisation:ratio{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"} != 0",
                        "legendFormat": "Utilisation"
                    }
                ],
                "title": "Memory Utilisation",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "rds"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 9
                },
                "id": 6,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance:node_vmstat_pgmajfault:rate5m{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"}",
                        "legendFormat": "Major page Faults"
                    }
                ],
                "title": "Memory Saturation (Major Page Faults)",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 16
                },
                "id": 7,
                "panels": [

                ],
                "title": "Network",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "Bps"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Transmit/"
                            },
                            "properties": [
                                {
                                    "id": "custom.transform",
                                    "value": "negative-Y"
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 17
                },
                "id": 8,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance:node_network_receive_bytes_excluding_lo:rate5m{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"} != 0",
                        "legendFormat": "Receive"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance:node_network_transmit_bytes_excluding_lo:rate5m{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"} != 0",
                        "legendFormat": "Transmit"
                    }
                ],
                "title": "Network Utilisation (Bytes Receive/Transmit)",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "Bps"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/Transmit/"
                            },
                            "properties": [
                                {
                                    "id": "custom.transform",
                                    "value": "negative-Y"
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 17
                },
                "id": 9,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance:node_network_receive_drop_excluding_lo:rate5m{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"}",
                        "legendFormat": "Receive"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance:node_network_transmit_drop_excluding_lo:rate5m{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"}",
                        "legendFormat": "Transmit"
                    }
                ],
                "title": "Network Saturation (Drops Receive/Transmit)",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 24
                },
                "id": 10,
                "panels": [

                ],
                "title": "Disk IO",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 25
                },
                "id": 11,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance_device:node_disk_io_time_seconds:rate5m{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"} != 0",
                        "legendFormat": "{{device}}"
                    }
                ],
                "title": "Disk IO Utilisation",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 25
                },
                "id": 12,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "instance_device:node_disk_io_time_weighted_seconds:rate5m{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"} != 0",
                        "legendFormat": "{{device}}"
                    }
                ],
                "title": "Disk IO Saturation",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 34
                },
                "id": 13,
                "panels": [

                ],
                "title": "Disk Space",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 35
                },
                "id": 14,
                "options": {
                    "legend": {
                        "showLegend": false
                    },
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "sort_desc(1 -\n  (\n    max without (mountpoint, fstype) (node_filesystem_avail_bytes{job=\"node-exporter\", fstype!=\"\", instance=\"$instance\", cluster=\"$cluster\"})\n    /\n    max without (mountpoint, fstype) (node_filesystem_size_bytes{job=\"node-exporter\", fstype!=\"\", instance=\"$instance\", cluster=\"$cluster\"})\n  ) != 0\n)\n",
                        "legendFormat": "{{device}}"
                    }
                ],
                "title": "Disk Space Utilisation",
                "type": "timeseries"
            }
        ],
        "refresh": "30s",
        "schemaVersion": 39,
        "tags": [
            "node-exporter-mixin"
        ],
        "templating": {
            "list": [
                {
                    "name": "datasource",
                    "query": "prometheus",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 2,
                    "includeAll": false,
                    "name": "cluster",
                    "query": "label_values(node_time_seconds, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "name": "instance",
                    "query": "label_values(node_exporter_build_info{job=\"node-exporter\", cluster=\"$cluster\"}, instance)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "utc",
        "title": "Node Exporter / USE Method / Node",
        "uid": "fac67cfbe174d3ef53eb473d73d9212f"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-nodes
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Node Exporter"
  resyncPeriod: 24h
  json: |
    {
        "graphTooltip": 1,
        "panels": [
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "panels": [

                ],
                "title": "CPU",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "max": 1,
                        "min": 0,
                        "unit": "percentunit"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 1
                },
                "id": 2,
                "options": {
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "(\n  (1 - sum without (mode) (rate(node_cpu_seconds_total{job=\"node-exporter\", mode=~\"idle|iowait|steal\", instance=\"$instance\", cluster=\"$cluster\"}[$__rate_interval])))\n/ ignoring(cpu) group_left\n  count without (cpu, mode) (node_cpu_seconds_total{job=\"node-exporter\", mode=\"idle\", instance=\"$instance\", cluster=\"$cluster\"})\n)\n",
                        "intervalFactor": 5,
                        "legendFormat": "{{cpu}}"
                    }
                ],
                "title": "CPU Usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 0,
                            "showPoints": "never"
                        },
                        "min": 0,
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 1
                },
                "id": 3,
                "options": {
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "node_load1{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"}",
                        "legendFormat": "1m load average"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "node_load5{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"}",
                        "legendFormat": "5m load average"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "node_load15{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"}",
                        "legendFormat": "15m load average"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "count(node_cpu_seconds_total{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\", mode=\"idle\"})",
                        "legendFormat": "logical cores"
                    }
                ],
                "title": "Load Average",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 8
                },
                "id": 4,
                "title": "Memory",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "min": 0,
                        "unit": "bytes"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 18,
                    "x": 0,
                    "y": 9
                },
                "id": 5,
                "options": {
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "(\n  node_memory_MemTotal_bytes{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"}\n-\n  node_memory_MemFree_bytes{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"}\n-\n  node_memory_Buffers_bytes{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"}\n-\n  node_memory_Cached_bytes{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"}\n)\n",
                        "legendFormat": "memory used"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "node_memory_Buffers_bytes{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"}",
                        "legendFormat": "memory buffers"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "node_memory_Cached_bytes{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"}",
                        "legendFormat": "memory cached"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "node_memory_MemFree_bytes{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"}",
                        "legendFormat": "memory free"
                    }
                ],
                "title": "Memory Usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "max": 100,
                        "min": 0,
                        "thresholds": {
                            "steps": [
                                {
                                    "color": "rgba(50, 172, 45, 0.97)"
                                },
                                {
                                    "color": "rgba(237, 129, 40, 0.89)",
                                    "value": 80
                                },
                                {
                                    "color": "rgba(245, 54, 54, 0.9)",
                                    "value": 90
                                }
                            ]
                        },
                        "unit": "percent"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 6,
                    "x": 18,
                    "y": 9
                },
                "id": 6,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "100 -\n(\n  avg(node_memory_MemAvailable_bytes{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"}) /\n  avg(node_memory_MemTotal_bytes{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\"})\n* 100\n)\n"
                    }
                ],
                "title": "Memory Usage",
                "type": "gauge"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 18
                },
                "id": 7,
                "panels": [

                ],
                "title": "Disk",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 0,
                            "showPoints": "never"
                        },
                        "min": 0
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/ read| written/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "Bps"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byRegexp",
                                "options": "/ io time/"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 19
                },
                "id": 8,
                "options": {
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "rate(node_disk_read_bytes_total{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\"}[$__rate_interval])",
                        "intervalFactor": 1,
                        "legendFormat": "{{device}} read"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "rate(node_disk_written_bytes_total{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\"}[$__rate_interval])",
                        "intervalFactor": 1,
                        "legendFormat": "{{device}} written"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "rate(node_disk_io_time_seconds_total{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\", device=~\"(/dev/)?(mmcblk.p.+|nvme.+|rbd.+|sd.+|vd.+|xvd.+|dm-.+|md.+|dasd.+)\"}[$__rate_interval])",
                        "intervalFactor": 1,
                        "legendFormat": "{{device}} io time"
                    }
                ],
                "title": "Disk I/O",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "fieldConfig": {
                    "defaults": {
                        "thresholds": {
                            "steps": [
                                {
                                    "color": "green"
                                },
                                {
                                    "color": "yellow",
                                    "value": 0.80000000000000004
                                },
                                {
                                    "color": "red",
                                    "value": 0.90000000000000002
                                }
                            ]
                        },
                        "unit": "decbytes"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Mounted on"
                            },
                            "properties": [
                                {
                                    "id": "custom.width",
                                    "value": 260
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Size"
                            },
                            "properties": [
                                {
                                    "id": "custom.width",
                                    "value": 93
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Used"
                            },
                            "properties": [
                                {
                                    "id": "custom.width",
                                    "value": 72
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Available"
                            },
                            "properties": [
                                {
                                    "id": "custom.width",
                                    "value": 88
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Used, %"
                            },
                            "properties": [
                                {
                                    "id": "unit",
                                    "value": "percentunit"
                                },
                                {
                                    "id": "custom.cellOptions",
                                    "value": {
                                        "type": "gauge"
                                    }
                                },
                                {
                                    "id": "max",
                                    "value": 1
                                },
                                {
                                    "id": "min",
                                    "value": 0
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 19
                },
                "id": 9,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "max by (mountpoint) (node_filesystem_size_bytes{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\", fstype!=\"\", mountpoint!=\"\"})\n",
                        "format": "table",
                        "instant": true,
                        "legendFormat": ""
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "max by (mountpoint) (node_filesystem_avail_bytes{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\", fstype!=\"\", mountpoint!=\"\"})\n",
                        "format": "table",
                        "instant": true,
                        "legendFormat": ""
                    }
                ],
                "title": "Disk Space Usage",
                "transformations": [
                    {
                        "id": "groupBy",
                        "options": {
                            "fields": {
                                "Value #A": {
                                    "aggregations": [
                                        "lastNotNull"
                                    ],
                                    "operation": "aggregate"
                                },
                                "Value #B": {
                                    "aggregations": [
                                        "lastNotNull"
                                    ],
                                    "operation": "aggregate"
                                },
                                "mountpoint": {
                                    "aggregations": [

                                    ],
                                    "operation": "groupby"
                                }
                            }
                        }
                    },
                    {
                        "id": "merge"
                    },
                    {
                        "id": "calculateField",
                        "options": {
                            "alias": "Used",
                            "binary": {
                                "left": "Value #A (lastNotNull)",
                                "operator": "-",
                                "reducer": "sum",
                                "right": "Value #B (lastNotNull)"
                            },
                            "mode": "binary",
                            "reduce": {
                                "reducer": "sum"
                            }
                        }
                    },
                    {
                        "id": "calculateField",
                        "options": {
                            "alias": "Used, %",
                            "binary": {
                                "left": "Used",
                                "operator": "/",
                                "reducer": "sum",
                                "right": "Value #A (lastNotNull)"
                            },
                            "mode": "binary",
                            "reduce": {
                                "reducer": "sum"
                            }
                        }
                    },
                    {
                        "id": "organize",
                        "options": {
                            "excludeByName": {

                            },
                            "indexByName": {

                            },
                            "renameByName": {
                                "Value #A (lastNotNull)": "Size",
                                "Value #B (lastNotNull)": "Available",
                                "mountpoint": "Mounted on"
                            }
                        }
                    },
                    {
                        "id": "sortBy",
                        "options": {
                            "fields": {

                            },
                            "sort": [
                                {
                                    "field": "Mounted on"
                                }
                            ]
                        }
                    }
                ],
                "type": "table"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 26
                },
                "id": 10,
                "panels": [

                ],
                "title": "Network",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "description": "Network received (bits/s)",
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 0,
                            "showPoints": "never"
                        },
                        "min": 0,
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 27
                },
                "id": 11,
                "options": {
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "rate(node_network_receive_bytes_total{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\", device!=\"lo\"}[$__rate_interval]) * 8",
                        "intervalFactor": 1,
                        "legendFormat": "{{device}}"
                    }
                ],
                "title": "Network Received",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "${datasource}"
                },
                "description": "Network transmitted (bits/s)",
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 0
                        },
                        "min": 0,
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 27
                },
                "id": 12,
                "options": {
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "rate(node_network_transmit_bytes_total{job=\"node-exporter\", instance=\"$instance\", cluster=\"$cluster\", device!=\"lo\"}[$__rate_interval]) * 8",
                        "intervalFactor": 1,
                        "legendFormat": "{{device}}"
                    }
                ],
                "title": "Network Transmitted",
                "type": "timeseries"
            }
        ],
        "refresh": "30s",
        "schemaVersion": 39,
        "tags": [
            "node-exporter-mixin"
        ],
        "templating": {
            "list": [
                {
                    "name": "datasource",
                    "query": "prometheus",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 2,
                    "label": "Cluster",
                    "name": "cluster",
                    "query": "label_values(node_uname_info{job=\"node-exporter\", sysname!=\"Darwin\"}, cluster)",
                    "refresh": 2,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "label": "Instance",
                    "name": "instance",
                    "query": "label_values(node_uname_info{job=\"node-exporter\", cluster=\"$cluster\", sysname!=\"Darwin\"}, instance)",
                    "refresh": 2,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "utc",
        "title": "Node Exporter / Nodes",
        "uid": "7d57716318ee0dddbac5a7f451fb7753"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-persistentvolumesusage
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bytes"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 18,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(\n  sum without(instance, node) (topk(1, (kubelet_volume_stats_capacity_bytes{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", namespace=\"$namespace\", persistentvolumeclaim=\"$volume\"})))\n  -\n  sum without(instance, node) (topk(1, (kubelet_volume_stats_available_bytes{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", namespace=\"$namespace\", persistentvolumeclaim=\"$volume\"})))\n)\n",
                        "legendFormat": "Used Space"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum without(instance, node) (topk(1, (kubelet_volume_stats_available_bytes{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", namespace=\"$namespace\", persistentvolumeclaim=\"$volume\"})))\n",
                        "legendFormat": "Free Space"
                    }
                ],
                "title": "Volume Space Usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "color": {
                            "mode": "thresholds"
                        },
                        "max": 100,
                        "min": 0,
                        "thresholds": {
                            "mode": "absolute",
                            "steps": [
                                {
                                    "color": "green",
                                    "value": 0
                                },
                                {
                                    "color": "orange",
                                    "value": 80
                                },
                                {
                                    "color": "red",
                                    "value": 90
                                }
                            ]
                        },
                        "unit": "percent"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 6,
                    "x": 18,
                    "y": 0
                },
                "id": 2,
                "interval": "1m",
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "max without(instance,node) (\n(\n  topk(1, kubelet_volume_stats_capacity_bytes{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", namespace=\"$namespace\", persistentvolumeclaim=\"$volume\"})\n  -\n  topk(1, kubelet_volume_stats_available_bytes{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", namespace=\"$namespace\", persistentvolumeclaim=\"$volume\"})\n)\n/\ntopk(1, kubelet_volume_stats_capacity_bytes{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", namespace=\"$namespace\", persistentvolumeclaim=\"$volume\"})\n* 100)\n",
                        "instant": true
                    }
                ],
                "title": "Volume Space Usage",
                "type": "gauge"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "none"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 18,
                    "y": 7
                },
                "id": 3,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum without(instance, node) (topk(1, (kubelet_volume_stats_inodes_used{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", namespace=\"$namespace\", persistentvolumeclaim=\"$volume\"})))",
                        "legendFormat": "Used inodes"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "(\n  sum without(instance, node) (topk(1, (kubelet_volume_stats_inodes{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", namespace=\"$namespace\", persistentvolumeclaim=\"$volume\"})))\n  -\n  sum without(instance, node) (topk(1, (kubelet_volume_stats_inodes_used{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", namespace=\"$namespace\", persistentvolumeclaim=\"$volume\"})))\n)\n",
                        "legendFormat": "Free inodes"
                    }
                ],
                "title": "Volume inodes Usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "color": {
                            "mode": "thresholds"
                        },
                        "max": 100,
                        "min": 0,
                        "thresholds": {
                            "mode": "absolute",
                            "steps": [
                                {
                                    "color": "green",
                                    "value": 0
                                },
                                {
                                    "color": "orange",
                                    "value": 80
                                },
                                {
                                    "color": "red",
                                    "value": 90
                                }
                            ]
                        },
                        "unit": "percent"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 6,
                    "x": 18,
                    "y": 7
                },
                "id": 4,
                "interval": "1m",
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "max without(instance,node) (\ntopk(1, kubelet_volume_stats_inodes_used{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", namespace=\"$namespace\", persistentvolumeclaim=\"$volume\"})\n/\ntopk(1, kubelet_volume_stats_inodes{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", namespace=\"$namespace\", persistentvolumeclaim=\"$volume\"})\n* 100)\n",
                        "instant": true
                    }
                ],
                "title": "Volume inodes Usage",
                "type": "gauge"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(kubelet_volume_stats_capacity_bytes{job=\"kubelet\", metrics_path=\"/metrics\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "Namespace",
                    "name": "namespace",
                    "query": "label_values(kubelet_volume_stats_capacity_bytes{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\"}, namespace)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "PersistentVolumeClaim",
                    "name": "volume",
                    "query": "label_values(kubelet_volume_stats_capacity_bytes{cluster=\"$cluster\", job=\"kubelet\", metrics_path=\"/metrics\", namespace=\"$namespace\"}, persistentvolumeclaim)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Persistent Volumes",
        "uid": "919b92a8e8041bd567af9edab12c840c"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-pod-total
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "displayName": "$pod",
                        "max": 10000000000,
                        "min": 0,
                        "thresholds": {
                            "steps": [
                                {
                                    "color": "dark-green",
                                    "index": 0,
                                    "value": null
                                },
                                {
                                    "color": "dark-yellow",
                                    "index": 1,
                                    "value": 5000000000
                                },
                                {
                                    "color": "dark-red",
                                    "index": 2,
                                    "value": 7000000000
                                }
                            ]
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_bytes_total{cluster=\"$cluster\",namespace=~\"$namespace\", pod=~\"$pod\"}[$__rate_interval]))",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Current Rate of Bytes Received",
                "type": "gauge"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "displayName": "$pod",
                        "max": 10000000000,
                        "min": 0,
                        "thresholds": {
                            "steps": [
                                {
                                    "color": "dark-green",
                                    "index": 0,
                                    "value": null
                                },
                                {
                                    "color": "dark-yellow",
                                    "index": 1,
                                    "value": 5000000000
                                },
                                {
                                    "color": "dark-red",
                                    "index": 2,
                                    "value": 7000000000
                                }
                            ]
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 0
                },
                "id": 2,
                "interval": "1m",
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_bytes_total{cluster=\"$cluster\",namespace=~\"$namespace\", pod=~\"$pod\"}[$__rate_interval]))",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Current Rate of Bytes Transmitted",
                "type": "gauge"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 9
                },
                "id": 3,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_bytes_total{cluster=\"$cluster\",namespace=~\"$namespace\", pod=~\"$pod\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Receive Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 9
                },
                "id": 4,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_bytes_total{cluster=\"$cluster\",namespace=~\"$namespace\", pod=~\"$pod\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Transmit Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 18
                },
                "id": 5,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_packets_total{cluster=\"$cluster\",namespace=~\"$namespace\", pod=~\"$pod\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 18
                },
                "id": 6,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_packets_total{cluster=\"$cluster\",namespace=~\"$namespace\", pod=~\"$pod\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 27
                },
                "id": 7,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_receive_packets_dropped_total{cluster=\"$cluster\",namespace=~\"$namespace\", pod=~\"$pod\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets Dropped",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "showPoints": "never"
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 27
                },
                "id": 8,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(container_network_transmit_packets_dropped_total{cluster=\"$cluster\",namespace=~\"$namespace\", pod=~\"$pod\"}[$__rate_interval])) by (pod)",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets Dropped",
                "type": "timeseries"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(up{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "allValue": ".+",
                    "current": {
                        "selected": false,
                        "text": "kube-system",
                        "value": "kube-system"
                    },
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "includeAll": true,
                    "label": "namespace",
                    "name": "namespace",
                    "query": "label_values(container_network_receive_packets_total{cluster=\"$cluster\"}, namespace)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "current": {
                        "selected": false,
                        "text": "kube-system",
                        "value": "kube-system"
                    },
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "pod",
                    "name": "pod",
                    "query": "label_values(container_network_receive_packets_total{cluster=\"$cluster\",namespace=~\"$namespace\"}, pod)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Networking / Pod",
        "uid": "7a18067ce943a40ae25454675c19ff5c"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-prometheus-remote-write
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Prometheus"
  resyncPeriod: 24h
  json: |
    {
        "panels": [
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "panels": [

                ],
                "title": "Timestamps",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never"
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 1
                },
                "id": 2,
                "options": {
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "(\n  prometheus_remote_storage_queue_highest_timestamp_seconds{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}\n-\n  prometheus_remote_storage_queue_highest_sent_timestamp_seconds{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}\n)\n",
                        "format": "time_series",
                        "intervalFactor": 2,
                        "legendFormat": "{{cluster}}::{{instance}} {{remote_name}}:{{url}}"
                    }
                ],
                "title": "Highest Enqueued Timestamp vs. Highest Timestamp Sent",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never"
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 1
                },
                "id": 3,
                "options": {
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "clamp_min(\n  rate(prometheus_remote_storage_queue_highest_timestamp_seconds{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}[5m])\n-\n  rate(prometheus_remote_storage_queue_highest_sent_timestamp_seconds{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}[5m])\n, 0)\n",
                        "format": "time_series",
                        "intervalFactor": 2,
                        "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}"
                    }
                ],
                "title": "Rate[5m]",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 8
                },
                "id": 4,
                "panels": [

                ],
                "title": "Samples",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never"
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 9
                },
                "id": 5,
                "options": {
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "rate(\n  prometheus_remote_storage_samples_in_total{cluster=~\"$cluster\", instance=~\"$instance\"}[5m])\n-\n  ignoring(remote_name, url) group_right(instance) (rate(prometheus_remote_storage_succeeded_samples_total{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}[5m]) or rate(prometheus_remote_storage_samples_total{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}[5m]))\n-\n  (rate(prometheus_remote_storage_dropped_samples_total{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}[5m]) or rate(prometheus_remote_storage_samples_dropped_total{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}[5m]))\n",
                        "format": "time_series",
                        "intervalFactor": 2,
                        "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}"
                    }
                ],
                "title": "Rate, in vs. succeeded or dropped [5m]",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 16
                },
                "id": 6,
                "panels": [

                ],
                "title": "Shards",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never"
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 16
                },
                "id": 7,
                "options": {
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "prometheus_remote_storage_shards{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}",
                        "format": "time_series",
                        "intervalFactor": 2,
                        "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}"
                    }
                ],
                "title": "Current Shards",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never"
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 0,
                    "y": 23
                },
                "id": 8,
                "options": {
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "prometheus_remote_storage_shards_max{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}",
                        "format": "time_series",
                        "intervalFactor": 2,
                        "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}"
                    }
                ],
                "title": "Max Shards",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never"
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 8,
                    "y": 23
                },
                "id": 9,
                "options": {
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "prometheus_remote_storage_shards_min{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}",
                        "format": "time_series",
                        "intervalFactor": 2,
                        "legendFormat": "{{cluster}}{{instance}} {{remote_name}}:{{url}}"
                    }
                ],
                "title": "Min Shards",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never"
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 16,
                    "y": 23
                },
                "id": 10,
                "options": {
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "prometheus_remote_storage_shards_desired{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}",
                        "format": "time_series",
                        "intervalFactor": 2,
                        "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}"
                    }
                ],
                "title": "Desired Shards",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 24
                },
                "id": 11,
                "panels": [

                ],
                "title": "Shard Details",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never"
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 25
                },
                "id": 12,
                "options": {
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "prometheus_remote_storage_shard_capacity{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}",
                        "format": "time_series",
                        "intervalFactor": 2,
                        "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}"
                    }
                ],
                "title": "Shard Capacity",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never"
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 25
                },
                "id": 13,
                "options": {
                    "tooltip": {
                        "mode": "multi"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "prometheus_remote_storage_pending_samples{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"} or prometheus_remote_storage_samples_pending{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}",
                        "format": "time_series",
                        "intervalFactor": 2,
                        "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}"
                    }
                ],
                "title": "Pending Samples",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 32
                },
                "id": 14,
                "panels": [

                ],
                "title": "Segments",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 0,
                            "showPoints": "never"
                        },
                        "unit": "none"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 33
                },
                "id": 15,
                "options": {
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "prometheus_tsdb_wal_segment_current{cluster=~\"$cluster\", instance=~\"$instance\"}",
                        "format": "time_series",
                        "intervalFactor": 2,
                        "legendFormat": "{{cluster}}:{{instance}}"
                    }
                ],
                "title": "TSDB Current Segment",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 0,
                            "showPoints": "never"
                        },
                        "unit": "none"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 33
                },
                "id": 16,
                "options": {
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "prometheus_wal_watcher_current_segment{cluster=~\"$cluster\", instance=~\"$instance\"}",
                        "format": "time_series",
                        "intervalFactor": 2,
                        "legendFormat": "{{cluster}}:{{instance}} {{consumer}}"
                    }
                ],
                "title": "Remote Write Current Segment",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 40
                },
                "id": 17,
                "panels": [

                ],
                "title": "Misc. Rates",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 0,
                            "showPoints": "never"
                        }
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 6,
                    "x": 0,
                    "y": 41
                },
                "id": 18,
                "options": {
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "rate(prometheus_remote_storage_dropped_samples_total{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}[5m]) or rate(prometheus_remote_storage_samples_dropped_total{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}[5m])",
                        "format": "time_series",
                        "intervalFactor": 2,
                        "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}"
                    }
                ],
                "title": "Dropped Samples",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 0,
                            "showPoints": "never"
                        }
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 6,
                    "x": 6,
                    "y": 41
                },
                "id": 19,
                "options": {
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "rate(prometheus_remote_storage_failed_samples_total{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}[5m]) or rate(prometheus_remote_storage_samples_failed_total{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}[5m])",
                        "format": "time_series",
                        "intervalFactor": 2,
                        "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}"
                    }
                ],
                "title": "Failed Samples",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 0,
                            "showPoints": "never"
                        }
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 6,
                    "x": 12,
                    "y": 41
                },
                "id": 20,
                "options": {
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "rate(prometheus_remote_storage_retried_samples_total{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}[5m]) or rate(prometheus_remote_storage_samples_retried_total{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}[5m])",
                        "format": "time_series",
                        "intervalFactor": 2,
                        "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}"
                    }
                ],
                "title": "Retried Samples",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 0,
                            "showPoints": "never"
                        }
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 6,
                    "x": 18,
                    "y": 41
                },
                "id": 21,
                "options": {
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "rate(prometheus_remote_storage_enqueue_retries_total{cluster=~\"$cluster\", instance=~\"$instance\", url=~\"$url\"}[5m])",
                        "format": "time_series",
                        "intervalFactor": 2,
                        "legendFormat": "{{cluster}}:{{instance}} {{remote_name}}:{{url}}"
                    }
                ],
                "title": "Enqueue Retries",
                "type": "timeseries"
            }
        ],
        "schemaVersion": 39,
        "tags": [
            "prometheus-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": false,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "name": "datasource",
                    "query": "prometheus",
                    "type": "datasource"
                },
                {
                    "current": {
                        "selected": false,
                        "text": "$__all",
                        "value": "$__all"
                    },
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "includeAll": true,
                    "name": "cluster",
                    "query": "label_values(prometheus_build_info, cluster)",
                    "refresh": 2,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "includeAll": true,
                    "name": "instance",
                    "query": "label_values(prometheus_build_info{cluster=~\"$cluster\"}, instance)",
                    "refresh": 2,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "includeAll": true,
                    "name": "url",
                    "query": "label_values(prometheus_remote_storage_shards{cluster=~\"$cluster\", instance=~\"$instance\"}, url)",
                    "refresh": 2,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timepicker": {
            "refresh_intervals": [
                "60s"
            ]
        },
        "timezone": "utc",
        "title": "Prometheus / Remote Write",
        "uid": "cb079f93-fde4-41f0-862b-d4301d7c1c56"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-prometheus
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Prometheus"
  resyncPeriod: 24h
  json: |
    {
        "panels": [
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "panels": [

                ],
                "title": "Prometheus Stats",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "decimals": 2,
                        "displayName": "",
                        "unit": "short"
                    },
                    "overrides": [
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Time"
                            },
                            "properties": [
                                {
                                    "id": "displayName",
                                    "value": "Time"
                                },
                                {
                                    "id": "custom.align",
                                    "value": null
                                },
                                {
                                    "id": "custom.hidden",
                                    "value": "true"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "cluster"
                            },
                            "properties": [
                                {
                                    "id": "custom.align",
                                    "value": null
                                },
                                {
                                    "id": "unit",
                                    "value": "short"
                                },
                                {
                                    "id": "decimals",
                                    "value": 2
                                },
                                {
                                    "id": "displayName",
                                    "value": "Cluster"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "job"
                            },
                            "properties": [
                                {
                                    "id": "custom.align",
                                    "value": null
                                },
                                {
                                    "id": "unit",
                                    "value": "short"
                                },
                                {
                                    "id": "decimals",
                                    "value": 2
                                },
                                {
                                    "id": "displayName",
                                    "value": "Job"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "instance"
                            },
                            "properties": [
                                {
                                    "id": "displayName",
                                    "value": "Instance"
                                },
                                {
                                    "id": "custom.align",
                                    "value": null
                                },
                                {
                                    "id": "unit",
                                    "value": "short"
                                },
                                {
                                    "id": "decimals",
                                    "value": 2
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "version"
                            },
                            "properties": [
                                {
                                    "id": "displayName",
                                    "value": "Version"
                                },
                                {
                                    "id": "custom.align",
                                    "value": null
                                },
                                {
                                    "id": "unit",
                                    "value": "short"
                                },
                                {
                                    "id": "decimals",
                                    "value": 2
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Value #A"
                            },
                            "properties": [
                                {
                                    "id": "displayName",
                                    "value": "Count"
                                },
                                {
                                    "id": "custom.align",
                                    "value": null
                                },
                                {
                                    "id": "unit",
                                    "value": "short"
                                },
                                {
                                    "id": "decimals",
                                    "value": 2
                                },
                                {
                                    "id": "custom.hidden",
                                    "value": "true"
                                }
                            ]
                        },
                        {
                            "matcher": {
                                "id": "byName",
                                "options": "Value #B"
                            },
                            "properties": [
                                {
                                    "id": "displayName",
                                    "value": "Uptime"
                                },
                                {
                                    "id": "custom.align",
                                    "value": null
                                },
                                {
                                    "id": "unit",
                                    "value": "s"
                                }
                            ]
                        }
                    ]
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 1
                },
                "id": 2,
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "count by (cluster, job, instance, version) (prometheus_build_info{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"})",
                        "format": "table",
                        "instant": true,
                        "legendFormat": ""
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "max by (cluster, job, instance) (time() - process_start_time_seconds{cluster=~\"$cluster\", job=~\"$job\", instance=~\"$instance\"})",
                        "format": "table",
                        "instant": true,
                        "legendFormat": ""
                    }
                ],
                "title": "Prometheus Stats",
                "type": "table"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 8
                },
                "id": 3,
                "panels": [

                ],
                "title": "Discovery",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never"
                        },
                        "min": 0,
                        "unit": "ms"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 9
                },
                "id": 4,
                "options": {
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "sum(rate(prometheus_target_sync_length_seconds_sum{cluster=~\"$cluster\",job=~\"$job\",instance=~\"$instance\"}[5m])) by (cluster, job, scrape_job, instance) * 1e3",
                        "format": "time_series",
                        "legendFormat": "{{cluster}}:{{job}}:{{instance}}:{{scrape_job}}"
                    }
                ],
                "title": "Target Sync",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "lineWidth": 0,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "min": 0,
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 9
                },
                "id": 5,
                "options": {
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "sum by (cluster, job, instance) (prometheus_sd_discovered_targets{cluster=~\"$cluster\", job=~\"$job\",instance=~\"$instance\"})",
                        "format": "time_series",
                        "legendFormat": "{{cluster}}:{{job}}:{{instance}}"
                    }
                ],
                "title": "Targets",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 16
                },
                "id": 6,
                "panels": [

                ],
                "title": "Retrieval",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never"
                        },
                        "min": 0,
                        "unit": "ms"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 0,
                    "y": 17
                },
                "id": 7,
                "options": {
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "rate(prometheus_target_interval_length_seconds_sum{cluster=~\"$cluster\", job=~\"$job\",instance=~\"$instance\"}[5m]) / rate(prometheus_target_interval_length_seconds_count{cluster=~\"$cluster\", job=~\"$job\",instance=~\"$instance\"}[5m]) * 1e3",
                        "format": "time_series",
                        "legendFormat": "{{cluster}}:{{job}}:{{instance}} {{interval}} configured"
                    }
                ],
                "title": "Average Scrape Interval Duration",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "lineWidth": 0,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "min": 0,
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 8,
                    "y": 17
                },
                "id": 8,
                "options": {
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "sum by (cluster, job, instance) (rate(prometheus_target_scrapes_exceeded_body_size_limit_total{cluster=~\"$cluster\",job=~\"$job\",instance=~\"$instance\"}[1m]))",
                        "format": "time_series",
                        "legendFormat": "exceeded body size limit: {{cluster}} {{job}} {{instance}}"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "sum by (cluster, job, instance) (rate(prometheus_target_scrapes_exceeded_sample_limit_total{cluster=~\"$cluster\",job=~\"$job\",instance=~\"$instance\"}[1m]))",
                        "format": "time_series",
                        "legendFormat": "exceeded sample limit: {{cluster}} {{job}} {{instance}}"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "sum by (cluster, job, instance) (rate(prometheus_target_scrapes_sample_duplicate_timestamp_total{cluster=~\"$cluster\",job=~\"$job\",instance=~\"$instance\"}[1m]))",
                        "format": "time_series",
                        "legendFormat": "duplicate timestamp: {{cluster}} {{job}} {{instance}}"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "sum by (cluster, job, instance) (rate(prometheus_target_scrapes_sample_out_of_bounds_total{cluster=~\"$cluster\",job=~\"$job\",instance=~\"$instance\"}[1m]))",
                        "format": "time_series",
                        "legendFormat": "out of bounds: {{cluster}} {{job}} {{instance}}"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "sum by (cluster, job, instance) (rate(prometheus_target_scrapes_sample_out_of_order_total{cluster=~\"$cluster\",job=~\"$job\",instance=~\"$instance\"}[1m]))",
                        "format": "time_series",
                        "legendFormat": "out of order: {{cluster}} {{job}} {{instance}}"
                    }
                ],
                "title": "Scrape failures",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "lineWidth": 0,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "min": 0,
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 16,
                    "y": 17
                },
                "id": 9,
                "options": {
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "rate(prometheus_tsdb_head_samples_appended_total{cluster=~\"$cluster\", job=~\"$job\",instance=~\"$instance\"}[5m])",
                        "format": "time_series",
                        "legendFormat": "{{cluster}} {{job}} {{instance}}"
                    }
                ],
                "title": "Appended Samples",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 24
                },
                "id": 10,
                "panels": [

                ],
                "title": "Storage",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "lineWidth": 0,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "min": 0,
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 25
                },
                "id": 11,
                "options": {
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "prometheus_tsdb_head_series{cluster=~\"$cluster\",job=~\"$job\",instance=~\"$instance\"}",
                        "format": "time_series",
                        "legendFormat": "{{cluster}} {{job}} {{instance}} head series"
                    }
                ],
                "title": "Head Series",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "lineWidth": 0,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "min": 0,
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 25
                },
                "id": 12,
                "options": {
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "prometheus_tsdb_head_chunks{cluster=~\"$cluster\",job=~\"$job\",instance=~\"$instance\"}",
                        "format": "time_series",
                        "legendFormat": "{{cluster}} {{job}} {{instance}} head chunks"
                    }
                ],
                "title": "Head Chunks",
                "type": "timeseries"
            },
            {
                "collapsed": false,
                "gridPos": {
                    "h": 1,
                    "w": 24,
                    "x": 0,
                    "y": 32
                },
                "id": 13,
                "panels": [

                ],
                "title": "Query",
                "type": "row"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "lineWidth": 0,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "min": 0,
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 0,
                    "y": 33
                },
                "id": 14,
                "options": {
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "rate(prometheus_engine_query_duration_seconds_count{cluster=~\"$cluster\",job=~\"$job\",instance=~\"$instance\",slice=\"inner_eval\"}[5m])",
                        "format": "time_series",
                        "legendFormat": "{{cluster}} {{job}} {{instance}}"
                    }
                ],
                "title": "Query Rate",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "prometheus",
                    "uid": "$datasource"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 100,
                            "lineWidth": 0,
                            "showPoints": "never",
                            "stacking": {
                                "mode": "normal"
                            }
                        },
                        "min": 0,
                        "unit": "ms"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 12,
                    "x": 12,
                    "y": 33
                },
                "id": 15,
                "options": {
                    "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "$datasource"
                        },
                        "expr": "max by (slice) (prometheus_engine_query_duration_seconds{quantile=\"0.9\",cluster=~\"$cluster\", job=~\"$job\",instance=~\"$instance\"}) * 1e3",
                        "format": "time_series",
                        "legendFormat": "{{slice}}"
                    }
                ],
                "title": "Stage Duration",
                "type": "timeseries"
            }
        ],
        "schemaVersion": 39,
        "tags": [
            "prometheus-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": false,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "type": "datasource"
                },
                {
                    "allValue": ".+",
                    "current": {
                        "selected": false,
                        "text": [
                            "$__all"
                        ],
                        "value": [
                            "$__all"
                        ]
                    },
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "includeAll": true,
                    "label": "cluster",
                    "multi": true,
                    "name": "cluster",
                    "query": "label_values(prometheus_build_info{job=\"prometheus-k8s\",namespace=\"default\"}, cluster)",
                    "refresh": 2,
                    "sort": 2,
                    "type": "query"
                },
                {
                    "allValue": ".+",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "includeAll": true,
                    "label": "job",
                    "multi": true,
                    "name": "job",
                    "query": "label_values(prometheus_build_info{cluster=~\"$cluster\"}, job)",
                    "refresh": 2,
                    "sort": 2,
                    "type": "query"
                },
                {
                    "allValue": ".+",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "includeAll": true,
                    "label": "instance",
                    "multi": true,
                    "name": "instance",
                    "query": "label_values(prometheus_build_info{cluster=~\"$cluster\", job=~\"$job\"}, instance)",
                    "refresh": 2,
                    "sort": 2,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timepicker": {
            "refresh_intervals": [
                "60s"
            ]
        },
        "timezone": "utc",
        "title": "Prometheus / Overview",
        "uid": "9fa0d141-d019-4ad7-8bc5-42196ee308bd"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-scheduler
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "unit": "none"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 4,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "options": {
                    "colorMode": "none"
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(up{cluster=\"$cluster\", job=\"kube-scheduler\"})",
                        "instant": true
                    }
                ],
                "title": "Up",
                "type": "stat"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 10,
                    "x": 4,
                    "y": 0
                },
                "id": 2,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(scheduler_scheduling_attempt_duration_seconds_count{cluster=\"$cluster\", job=\"kube-scheduler\", instance=~\"$instance\"}[$__rate_interval])) by (cluster, instance)",
                        "legendFormat": "{{cluster}} {{instance}} e2e"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(scheduler_pod_scheduling_sli_duration_seconds_count{cluster=\"$cluster\", job=\"kube-scheduler\", instance=~\"$instance\"}[$__rate_interval])) by (cluster, instance)",
                        "legendFormat": "{{cluster}} {{instance}} binding"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(scheduler_scheduling_algorithm_duration_seconds_count{cluster=\"$cluster\", job=\"kube-scheduler\", instance=~\"$instance\"}[$__rate_interval])) by (cluster, instance)",
                        "legendFormat": "{{cluster}} {{instance}} scheduling algorithm"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(scheduler_volume_scheduling_duration_seconds_count{cluster=\"$cluster\", job=\"kube-scheduler\", instance=~\"$instance\"}[$__rate_interval])) by (cluster, instance)",
                        "legendFormat": "{{cluster}} {{instance}} volume"
                    }
                ],
                "title": "Scheduling Rate",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 10,
                    "x": 14,
                    "y": 0
                },
                "id": 3,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(scheduler_scheduling_attempt_duration_seconds_bucket{cluster=\"$cluster\", job=\"kube-scheduler\",instance=~\"$instance\"}[$__rate_interval])) by (cluster, instance, le))",
                        "legendFormat": "{{cluster}} {{instance}} e2e"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(scheduler_pod_scheduling_sli_duration_seconds_bucket{cluster=\"$cluster\", job=\"kube-scheduler\",instance=~\"$instance\"}[$__rate_interval])) by (cluster, instance, le))",
                        "legendFormat": "{{cluster}} {{instance}} binding"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(scheduler_scheduling_algorithm_duration_seconds_bucket{cluster=\"$cluster\", job=\"kube-scheduler\",instance=~\"$instance\"}[$__rate_interval])) by (cluster, instance, le))",
                        "legendFormat": "{{cluster}} {{instance}} scheduling algorithm"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(scheduler_volume_scheduling_duration_seconds_bucket{cluster=\"$cluster\", job=\"kube-scheduler\",instance=~\"$instance\"}[$__rate_interval])) by (cluster, instance, le))",
                        "legendFormat": "{{cluster}} {{instance}} volume"
                    }
                ],
                "title": "Scheduling latency 99th Quantile",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 0,
                    "y": 7
                },
                "id": 4,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(rest_client_requests_total{cluster=\"$cluster\", job=\"kube-scheduler\", instance=~\"$instance\",code=~\"2..\"}[$__rate_interval]))",
                        "legendFormat": "2xx"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(rest_client_requests_total{cluster=\"$cluster\", job=\"kube-scheduler\", instance=~\"$instance\",code=~\"3..\"}[$__rate_interval]))",
                        "legendFormat": "3xx"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(rest_client_requests_total{cluster=\"$cluster\", job=\"kube-scheduler\", instance=~\"$instance\",code=~\"4..\"}[$__rate_interval]))",
                        "legendFormat": "4xx"
                    },
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sum(rate(rest_client_requests_total{cluster=\"$cluster\", job=\"kube-scheduler\", instance=~\"$instance\",code=~\"5..\"}[$__rate_interval]))",
                        "legendFormat": "5xx"
                    }
                ],
                "title": "Kube API Request Rate",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "ops"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 16,
                    "x": 8,
                    "y": 7
                },
                "id": 5,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(rest_client_request_duration_seconds_bucket{cluster=\"$cluster\", job=\"kube-scheduler\", instance=~\"$instance\", verb=\"POST\"}[$__rate_interval])) by (verb, le))",
                        "legendFormat": "{{verb}}"
                    }
                ],
                "title": "Post Request Latency 99th Quantile",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "s"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 14
                },
                "id": 6,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "histogram_quantile(0.99, sum(rate(rest_client_request_duration_seconds_bucket{cluster=\"$cluster\", job=\"kube-scheduler\", instance=~\"$instance\", verb=\"GET\"}[$__rate_interval])) by (verb, le))",
                        "legendFormat": "{{verb}}"
                    }
                ],
                "title": "Get Request Latency 99th Quantile",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bytes"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 0,
                    "y": 21
                },
                "id": 7,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "process_resident_memory_bytes{cluster=\"$cluster\", job=\"kube-scheduler\", instance=~\"$instance\"}",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "Memory",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 8,
                    "y": 21
                },
                "id": 8,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "rate(process_cpu_seconds_total{cluster=\"$cluster\", job=\"kube-scheduler\", instance=~\"$instance\"}[$__rate_interval])",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "CPU usage",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "short"
                    }
                },
                "gridPos": {
                    "h": 7,
                    "w": 8,
                    "x": 16,
                    "y": 21
                },
                "id": 9,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "go_goroutines{cluster=\"$cluster\", job=\"kube-scheduler\",instance=~\"$instance\"}",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "title": "Goroutines",
                "type": "timeseries"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(up{job=\"kube-scheduler\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "allValue": ".+",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "includeAll": true,
                    "label": "instance",
                    "name": "instance",
                    "query": "label_values(up{job=\"kube-scheduler\", cluster=\"$cluster\"}, instance)",
                    "refresh": 2,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Scheduler",
        "uid": "2e6b6a3b4bddf1427b3a55aa1311c656"
    }

---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: kp-workload-total
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana
  allowCrossNamespaceImport: true
  folder: "Kubernetes"
  resyncPeriod: 24h
  json: |
    {
        "editable": false,
        "links": [
            {
                "asDropdown": true,
                "includeVars": true,
                "keepTime": true,
                "tags": [
                    "kubernetes-mixin"
                ],
                "targetBlank": false,
                "title": "Kubernetes",
                "type": "dashboards"
            }
        ],
        "panels": [
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "color": {
                            "fixedColor": "green",
                            "mode": "fixed"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 0
                },
                "id": 1,
                "interval": "1m",
                "options": {
                    "displayMode": "basic",
                    "showUnfilled": false
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_receive_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=~\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Current Rate of Bytes Received",
                "type": "bargauge"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "color": {
                            "fixedColor": "green",
                            "mode": "fixed"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 0
                },
                "id": 2,
                "interval": "1m",
                "options": {
                    "displayMode": "basic",
                    "showUnfilled": false
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_transmit_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=~\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Current Rate of Bytes Transmitted",
                "type": "bargauge"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "color": {
                            "fixedColor": "green",
                            "mode": "fixed"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 9
                },
                "id": 3,
                "interval": "1m",
                "options": {
                    "displayMode": "basic",
                    "showUnfilled": false
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(avg(rate(container_network_receive_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=~\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Average Rate of Bytes Received",
                "type": "bargauge"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "color": {
                            "fixedColor": "green",
                            "mode": "fixed"
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 9
                },
                "id": 4,
                "interval": "1m",
                "options": {
                    "displayMode": "basic",
                    "showUnfilled": false
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(avg(rate(container_network_transmit_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=~\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Average Rate of Bytes Transmitted",
                "type": "bargauge"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 18
                },
                "id": 5,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_receive_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=~\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Receive Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "bps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 18
                },
                "id": 6,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_transmit_bytes_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=~\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Transmit Bandwidth",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 27
                },
                "id": 7,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_receive_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=~\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 27
                },
                "id": 8,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_transmit_packets_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=~\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 0,
                    "y": 36
                },
                "id": 9,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_receive_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=~\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Received Packets Dropped",
                "type": "timeseries"
            },
            {
                "datasource": {
                    "type": "datasource",
                    "uid": "-- Mixed --"
                },
                "fieldConfig": {
                    "defaults": {
                        "custom": {
                            "fillOpacity": 10,
                            "showPoints": "never",
                            "spanNulls": true
                        },
                        "unit": "pps"
                    }
                },
                "gridPos": {
                    "h": 9,
                    "w": 12,
                    "x": 12,
                    "y": 36
                },
                "id": 10,
                "interval": "1m",
                "options": {
                    "legend": {
                        "asTable": true,
                        "calcs": [
                            "lastNotNull"
                        ],
                        "displayMode": "table",
                        "placement": "right",
                        "showLegend": true
                    },
                    "tooltip": {
                        "mode": "single"
                    }
                },
                "pluginVersion": "v11.4.0",
                "targets": [
                    {
                        "datasource": {
                            "type": "prometheus",
                            "uid": "${datasource}"
                        },
                        "expr": "sort_desc(sum(rate(container_network_transmit_packets_dropped_total{job=\"kubelet\", metrics_path=\"/metrics/cadvisor\", cluster=\"$cluster\",namespace=~\"$namespace\"}[$__rate_interval])\n* on (cluster, namespace, pod)\ngroup_left(workload,workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\",namespace=~\"$namespace\", workload=~\"$workload\", workload_type=~\"$type\"}) by (pod))\n",
                        "legendFormat": "__auto"
                    }
                ],
                "title": "Rate of Transmitted Packets Dropped",
                "type": "timeseries"
            }
        ],
        "refresh": "10s",
        "schemaVersion": 39,
        "tags": [
            "kubernetes-mixin"
        ],
        "templating": {
            "list": [
                {
                    "current": {
                        "selected": true,
                        "text": "default",
                        "value": "default"
                    },
                    "hide": 0,
                    "label": "Data source",
                    "name": "datasource",
                    "query": "prometheus",
                    "regex": "",
                    "type": "datasource"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(kube_pod_info{job=\"kube-state-metrics\"}, cluster)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "allValue": ".+",
                    "current": {
                        "selected": false,
                        "text": "kube-system",
                        "value": "kube-system"
                    },
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "includeAll": true,
                    "label": "namespace",
                    "name": "namespace",
                    "query": "label_values(container_network_receive_packets_total{cluster=\"$cluster\"}, namespace)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "label": "workload",
                    "name": "workload",
                    "query": "label_values(namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=~\"$namespace\", workload=~\".+\"}, workload)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                },
                {
                    "allValue": ".+",
                    "datasource": {
                        "type": "prometheus",
                        "uid": "${datasource}"
                    },
                    "hide": 0,
                    "includeAll": true,
                    "label": "workload_type",
                    "name": "type",
                    "query": "label_values(namespace_workload_pod:kube_pod_owner:relabel{cluster=\"$cluster\", namespace=~\"$namespace\", workload=~\"$workload\"}, workload_type)",
                    "refresh": 2,
                    "sort": 1,
                    "type": "query"
                }
            ]
        },
        "time": {
            "from": "now-1h",
            "to": "now"
        },
        "timezone": "UTC",
        "title": "Kubernetes / Networking / Workload",
        "uid": "728bf77cc1166d2f3133bf25846876cc"
    }
