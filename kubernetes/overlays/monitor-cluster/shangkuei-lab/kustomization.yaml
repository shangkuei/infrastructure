---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Monitor Cluster - shangkuei-lab
# See README.md and CLAUDE.md for documentation

resources:
  # Alloy - Log collector
  - helmrelease-alloy.yaml
  - configmap-alloy.yaml

  # Grafana - Visualization (storage: emptyDir, dashboards managed via CRs)
  - grafana-grafana-cluster.yaml

  # GrafanaDatasources - Prometheus and Loki data sources
  - grafanadatasources/grafanadatasource-prometheus.yaml
  - grafanadatasources/grafanadatasource-loki.yaml

  # GrafanaDashboards - Auto-generated by: make build (in _dashboards/ directory)
  # Source: kube-prometheus jsonnet + coredns/loki/openebs/alloy/cilium/cert-manager mixins
  - grafanadashboards/grafanadashboard-alloy.yaml
  - grafanadashboards/grafanadashboard-cert-manager.yaml
  - grafanadashboards/grafanadashboard-cilium.yaml
  - grafanadashboards/grafanadashboard-coredns.yaml
  - grafanadashboards/grafanadashboard-grafana.yaml
  - grafanadashboards/grafanadashboard-kubernetes.yaml
  - grafanadashboards/grafanadashboard-loki.yaml
  - grafanadashboards/grafanadashboard-node-exporter.yaml
  - grafanadashboards/grafanadashboard-openebs.yaml
  - grafanadashboards/grafanadashboard-prometheus.yaml
  # External dashboards - Generated by: ./_dashboards/build-external-dashboards.sh
  - grafanadashboards/grafanadashboard-flux.yaml
  - grafanadashboards/grafanadashboard-seaweedfs.yaml
  # Resource optimization dashboards
  - grafanadashboards/grafanadashboard-vpa.yaml
  - grafanadashboards/grafanadashboard-metrics-server.yaml
  - grafanadashboards/grafanadashboard-kubelet-cert-approver.yaml

  # Prometheus - Metrics collection
  - prometheus-cluster.yaml
  - serviceaccount-prometheus.yaml
  - clusterrole-prometheus.yaml
  - clusterrolebinding-prometheus.yaml
  - service-prometheus.yaml
  - persistentvolumeclaim-prometheus-cluster.yaml

  # Alertmanager - Alert routing
  - alertmanager-cluster.yaml
  - serviceaccount-alertmanager.yaml
  - clusterrole-alertmanager.yaml
  - clusterrolebinding-alertmanager.yaml
  - service-alertmanager.yaml

  # PrometheusRules - Recording and alerting rules
  # Auto-generated by: make build (in _dashboards/ directory)
  # Source: kube-prometheus jsonnet + coredns/loki/openebs/alloy/cilium/cert-manager mixins
  - prometheusrules/prometheusrule-alertmanager.yaml
  - prometheusrules/prometheusrule-alloy.yaml
  - prometheusrules/prometheusrule-cert-manager.yaml
  - prometheusrules/prometheusrule-cilium.yaml
  - prometheusrules/prometheusrule-coredns.yaml
  - prometheusrules/prometheusrule-kube-prometheus.yaml
  - prometheusrules/prometheusrule-kube-state-metrics.yaml
  - prometheusrules/prometheusrule-kubernetes-control-plane.yaml
  - prometheusrules/prometheusrule-loki.yaml
  - prometheusrules/prometheusrule-node-exporter.yaml
  - prometheusrules/prometheusrule-openebs.yaml
  - prometheusrules/prometheusrule-prometheus.yaml
  - prometheusrules/prometheusrule-prometheus-operator.yaml

  # PodMonitors - Scrape configurations for pods without services
  - podmonitors/podmonitor-flux.yaml

  # ServiceMonitors - Scrape configurations
  - servicemonitors/servicemonitor-alertmanager.yaml
  - servicemonitors/servicemonitor-apiserver.yaml
  - servicemonitors/servicemonitor-controller-manager.yaml
  - servicemonitors/servicemonitor-coredns.yaml
  - servicemonitors/servicemonitor-grafana.yaml
  - servicemonitors/servicemonitor-kubelet.yaml
  - servicemonitors/servicemonitor-openebs.yaml
  - servicemonitors/servicemonitor-operator.yaml
  - servicemonitors/servicemonitor-prometheus.yaml
  - servicemonitors/servicemonitor-scheduler.yaml
  - servicemonitors/servicemonitor-seaweedfs.yaml

labels:
  - pairs:
      app.kubernetes.io/instance: shangkuei-lab
      app.kubernetes.io/environment: lab
