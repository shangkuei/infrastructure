---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Grafana Alloy - unified telemetry collector
# Collects logs from Kubernetes pods and sends to Loki
# Note: Loki is deployed via monitor-operator overlay

resources:
  - helmrelease-alloy.yaml
  - configmap-alloy.yaml
  # Grafana instance managed by grafana-operator
  - grafana-instance.yaml
  # Grafana datasources (Prometheus, Loki)
  - grafana-datasource-prometheus.yaml
  - grafana-datasource-loki.yaml
  # Grafana dashboards (managed via grafana-operator CRs)
  # Source: kube-prometheus jsonnet (generated via: cd dashboards && make build)
  - grafana-dashboards-kube-prometheus.yaml
  # Loki mixin recording rules for dashboard compatibility
  # The Loki helm chart generates rules without cluster dimension, but loki-mixin
  # dashboards expect cluster_job:* and cluster_job_route:* rules
  - loki-mixin-recording-rules.yaml

labels:
  - pairs:
      app.kubernetes.io/instance: shangkuei-lab
      app.kubernetes.io/environment: lab
